<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CoinFlip Workshop</title>
    <link href="https://fonts.googleapis.com/css?family=Roboto+Mono:400,700&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Roboto Mono', monospace;
        }

        :root {
            --bg-color: #f0f2f5;
            --text-color: #4a4a4a;
            --card-bg: #ffffff;
            --card-shadow: rgba(0, 0, 0, 0.1);
            --border-color: #e0e0e0;
            --modal-bg: rgba(0, 0, 0, 0.7);
            --dev-menu-bg: #1a1a1a;
            --dev-menu-border: rgba(255, 255, 255, 0.1);
        }

        [data-theme="dark"] {
            --bg-color: #1a1a1a;
            --text-color: #ffffff;
            --card-bg: #2a2a2a;
            --card-shadow: rgba(0, 0, 0, 0.3);
            --border-color: #333333;
            --modal-bg: rgba(0, 0, 0, 0.8);
            --dev-menu-bg: #1a1a1a;
            --dev-menu-border: rgba(255, 255, 255, 0.1);
        }

        body {
            background: var(--bg-color);
            min-height: 100vh;
            display: flex;
            color: var(--text-color);
            transition: background-color 0.3s ease, color 0.3s ease;
        }

        .sidebar {
            width: 60px;
            height: 100vh;
            background: var(--card-bg);
            box-shadow: 2px 0 10px var(--card-shadow);
            transition: width 0.3s ease, background-color 0.3s ease;
            position: fixed;
            left: 0;
            z-index: 100;
            overflow: hidden;
        }

        .sidebar:hover {
            width: 200px;
        }

        .sidebar-content {
            padding: 20px 0 20px 0;
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .sidebar-item {
            display: flex;
            align-items: center;
            gap: 0;
            padding: 10px 10px 10px 10px;
            border-radius: 8px;
            cursor: pointer;
            transition: background-color 0.3s ease;
            position: relative;
        }

        .sidebar-item:hover {
            background-color: #f0f2f5;
        }

        .sidebar-item i {
            font-size: 24px;
            color: var(--text-color);
            min-width: 40px;
            text-align: center;
        }

        .sidebar-item span {
            opacity: 0;
            transform: translateX(-20px);
            transition: opacity 0.3s, transform 0.3s;
            white-space: nowrap;
            color: var(--text-color);
            font-weight: 500;
            pointer-events: none;
        }

        .sidebar:hover .sidebar-item span {
            opacity: 1;
            transform: translateX(0);
            pointer-events: auto;
        }

        .main-content {
            margin-left: 80px;
            flex: 1;
            padding: 20px;
            position: relative;
        }

        .balance-container {
            position: fixed;
            top: 20px;
            right: 20px;
            background: var(--card-bg);
            padding: 15px 25px;
            border-radius: 12px;
            box-shadow: 0 2px 10px var(--card-shadow);
            display: flex;
            align-items: center;
            gap: 10px;
            z-index: 9999;
        }

        .balance-amount {
            font-size: 18px;
            font-weight: 600;
            color: var(--text-color);
            transition: color 0.3s ease;
        }

        .balance-amount.increasing {
            color: #4CAF50;
        }

        .balance-amount.decreasing {
            color: #ff4444;
        }

        .content-tab {
            display: none;
            background: var(--card-bg);
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 2px 10px var(--card-shadow);
            margin-top: 20px;
            position: absolute;
            width: calc(100% - 40px);
            opacity: 0;
            transform: translateX(100%);
            transition: transform 0.4s ease, opacity 0.4s ease;
        }

        .content-tab.active {
            display: block;
            opacity: 1;
            transform: translateX(0);
        }

        .content-tab.leaving {
            transform: translateX(-100%);
            opacity: 0;
        }

        /* Coinflip Game Styles */
        .coinflip-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 20px;
        }

        .coinflip-bet {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 10px;
        }

        .coinflip-bet input {
            width: 80px;
            padding: 8px 10px;
            border-radius: 6px;
            border: 1px solid #ccc;
            font-size: 16px;
        }

        .coin {
            width: 150px;
            height: 150px;
            background: #ffd700;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            font-weight: bold;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.1);
            transition: transform 1s ease;
        }

        .bet-options {
            display: flex;
            gap: 20px;
        }

        .bet-button {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            background: #4a4a4a;
            color: white;
            cursor: pointer;
            transition: background-color 0.3s ease;
        }

        .bet-button:hover {
            background: #333333;
        }

        /* Crates Section Styles */
        .crates-container {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 20px;
            opacity: 0;
            transition: opacity 0.5s ease;
            margin-left: 40px;
        }

        .crate {
            background: #ffffff;
            border-radius: 12px;
            padding: 20px;
            text-align: center;
            cursor: pointer;
            transition: transform 0.3s ease, box-shadow 0.3s, background 0.3s;
            position: relative;
            overflow: hidden;
            border: 2px solid transparent;
        }

        .crate:hover {
            transform: scale(1.07) rotate(-1deg);
            box-shadow: 0 4px 24px rgba(0,0,0,0.12);
        }

        .crate .sheen {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(120deg, rgba(255,255,255,0.18) 0%, rgba(255,255,255,0.45) 50%, rgba(255,255,255,0.18) 100%);
            opacity: 0;
            pointer-events: none;
            border-radius: 12px;
            transition: opacity 0.25s;
            z-index: 2;
        }
        .crate:hover .sheen {
            opacity: 1;
        }

        .crate .rarity {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 8px;
            font-size: 13px;
            font-weight: 600;
            margin-bottom: 8px;
            color: #fff;
        }

        .rarity-common { background: #7be495; color: #234c2e; }
        .rarity-uncommon { background: #3bb273; color: #fff; }
        .rarity-rare { background: #3b82f6; color: #fff; }
        .rarity-epic { background: #a259e6; color: #fff; }
        .rarity-legendary { background: #ffd700; color: #b8860b; }
        .rarity-mythical { background: #ff6ec7; color: #fff; }
        .rarity-divine { background: #7ed6ff; color: #234c4e; }

        /* Inventory Section Styles */
        .inventory-container {
            display: flex;
            flex-direction: column;
            gap: 32px;
        }

        .inventory-section {
            background: var(--card-bg);
            border-radius: 10px;
            padding: 18px 18px 12px 18px;
            box-shadow: 0 2px 10px var(--card-shadow);
        }

        .inventory-section-title {
            font-size: 16px;
            font-weight: 700;
            margin-bottom: 10px;
            color: var(--text-color);
            letter-spacing: 1px;
        }

        .inventory-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(48px, 1fr));
            gap: 16px;
        }

        .modal {
            position: fixed;
            top: 0; left: 0; right: 0; bottom: 0;
            background: var(--modal-bg);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 10000;
        }
        .modal-content {
            background: var(--card-bg);
            border-radius: 18px;
            padding: 36px 36px 28px 36px;
            min-width: 340px;
            min-height: 220px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.18);
            position: relative;
            display: flex;
            flex-direction: column;
            align-items: center;
            border: 1.5px solid var(--border-color);
            color: var(--text-color);
        }
        .modal-close {
            position: absolute;
            top: 12px;
            right: 18px;
            font-size: 22px;
            color: #888;
            cursor: pointer;
        }
        .rolling-strip {
            width: 400px;
            height: 60px;
            background: var(--bg-color);
            border-radius: 10px;
            overflow: hidden;
            margin: 24px 0 16px 0;
            border: 2px solid var(--border-color);
            position: relative;
        }
        .rolling-items {
            display: flex;
            align-items: center;
            height: 100%;
            transition: transform 0.7s cubic-bezier(.22,.68,0,1.71);
        }
        .rolling-item {
            width: 56px;
            height: 56px;
            margin: 0 4px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 13px;
            font-weight: 600;
            color: #fff;
            box-shadow: 0 2px 8px var(--card-shadow);
            border: 2px solid var(--card-bg);
            flex-shrink: 0;
        }
        .rolling-item.common { background: #b0b0b0; color: #222; }
        .rolling-item.uncommon { background: #3bb273; }
        .rolling-item.rare { background: #3b82f6; }
        .rolling-item.epic { background: #a259e6; }
        .rolling-item.legendary { background: #ffd700; color: #b8860b; }
        .rolling-item.mythical { background: #ff6ec7; }
        .rolling-item.divine { background: #7ed6ff; color: #234c4e; }
        .rolling-pointer {
            position: absolute;
            top: 0; bottom: 0;
            left: 50%;
            width: 4px;
            background: #333;
            transform: translateX(-50%);
            border-radius: 2px;
        }
        .inventory-crate {
            width: 48px;
            height: 48px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 22px;
            font-weight: bold;
            cursor: pointer;
            margin: auto;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
            transition: transform 0.2s, box-shadow 0.2s, background 0.2s;
            border: 2px solid transparent;
            position: relative;
            background: linear-gradient(120deg, var(--card-bg) 60%, #b0eacb 100%);
            color: var(--text-color);
        }
        .inventory-crate:hover {
            transform: scale(1.08) rotate(-2deg);
            box-shadow: 0 4px 16px rgba(0,0,0,0.13);
        }
        .inventory-crate.selected {
            outline: 3px solid #3b82f6;
            z-index: 2;
        }
        .inventory-crate.common { background: linear-gradient(120deg, var(--card-bg) 60%, #eafaf1 100%); border-color: #7be495; }
        .inventory-crate.uncommon { background: linear-gradient(120deg, var(--card-bg) 60%, #e6f9ed 100%); border-color: #3bb273; }
        .inventory-crate.rare { background: linear-gradient(120deg, var(--card-bg) 60%, #e6f0fa 100%); border-color: #3b82f6; }
        .inventory-crate.epic { background: linear-gradient(120deg, var(--card-bg) 60%, #f3e6fa 100%); border-color: #a259e6; }
        .inventory-crate.legendary { background: linear-gradient(120deg, var(--card-bg) 60%, #fffbe6 100%); border-color: #ffd700; }
        .inventory-crate.mythical { background: linear-gradient(120deg, var(--card-bg) 60%, #ffe6f7 100%); border-color: #ff6ec7; }
        .inventory-crate.divine { background: linear-gradient(120deg, var(--card-bg) 60%, #e6faff 100%); border-color: #7ed6ff; }
        .inventory-crate .sheen {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(120deg, rgba(255,255,255,0.18) 0%, rgba(255,255,255,0.45) 50%, rgba(255,255,255,0.18) 100%);
        }

        .inventory-item-square {
            width: 36px;
            height: 36px;
            border-radius: 6px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 11px;
            font-weight: 600;
            color: #fff;
            margin: auto;
            cursor: pointer;
            box-shadow: 0 1px 4px rgba(0,0,0,0.08);
            border: 2px solid var(--card-bg);
            transition: transform 0.2s, box-shadow 0.2s;
            background: #b0b0b0;
            color: #222;
        }
        .inventory-item-square.common { background: #b0b0b0; color: #222; }
        .inventory-item-square.uncommon { background: #3bb273; }
        .inventory-item-square.rare { background: #3b82f6; }
        .inventory-item-square.epic { background: #a259e6; }
        .inventory-item-square.legendary { background: #ffd700; color: #b8860b; }
        .inventory-item-square.mythical { background: #ff6ec7; }
        .inventory-item-square.divine { background: #7ed6ff; color: #234c4e; }
        .inventory-item-square:hover {
            transform: scale(1.12) rotate(-2deg);
            box-shadow: 0 4px 16px var(--card-shadow);
        }
        .inventory-item-square.selected {
            outline: 3px solid #3b82f6;
            z-index: 2;
        }
        .inventory-grid {
            transition: all 0.35s cubic-bezier(.22,.68,0,1.01);
        }
        .item-modal-lore {
            font-size: 13px;
            color: #666;
            margin: 10px 0 18px 0;
            text-align: center;
            font-style: italic;
        }
        .item-modal-sell {
            position: absolute;
            bottom: 18px;
            right: 32px;
            background: linear-gradient(90deg, #ff6e7f 0%, #bfe9ff 100%);
            color: #fff;
            border: none;
            border-radius: 8px;
            padding: 10px 22px;
            font-size: 15px;
            font-weight: 600;
            cursor: pointer;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
            transition: background 0.2s;
        }
        .item-modal-sell:hover {
            background: linear-gradient(90deg, #d9363e 0%, #7ed6ff 100%);
        }
        .item-modal-title {
            font-size: 22px;
            font-weight: 700;
            margin-bottom: 6px;
            color: #222;
            letter-spacing: 0.5px;
        }
        .item-modal-rarity {
            font-size: 15px;
            font-weight: 600;
            margin-bottom: 4px;
            text-transform: capitalize;
        }
        .item-modal-worth {
            font-size: 15px;
            font-weight: 500;
            margin-bottom: 8px;
            color: #444;
        }

        /* Dev Menu Styles */
        .dev-menu-button {
            position: fixed;
            bottom: 20px;
            right: 20px;
            width: 50px;
            height: 50px;
            background: #333;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            box-shadow: 0 2px 10px rgba(0,0,0,0.2);
            transition: transform 0.3s ease;
            z-index: 10000;
        }

        .dev-menu-button:hover {
            transform: scale(1.1);
        }

        .dev-menu-button i {
            color: white;
            font-size: 24px;
        }

        .password-modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.7);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 10001;
            backdrop-filter: blur(5px);
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .password-modal.showing {
            opacity: 1;
        }

        .password-modal.hiding {
            opacity: 0;
        }

        .password-content {
            background: #1a1a1a;
            padding: 40px;
            border-radius: 15px;
            width: 350px;
            text-align: center;
            box-shadow: 0 5px 30px rgba(0,0,0,0.3);
            border: 1px solid rgba(255, 255, 255, 0.1);
            transform: scale(0.95);
            transition: transform 0.3s ease;
        }

        .password-modal.showing .password-content {
            transform: scale(1);
        }

        .password-modal.hiding .password-content {
            transform: scale(0.95);
        }

        .password-content h2 {
            color: #fff;
            margin-bottom: 25px;
            font-size: 24px;
        }

        .password-input {
            width: 100%;
            padding: 12px;
            margin: 10px 0 20px;
            border: 2px solid #333;
            border-radius: 8px;
            font-size: 16px;
            background: #2a2a2a;
            color: #fff;
            transition: border-color 0.3s;
        }

        .password-input:focus {
            border-color: #4CAF50;
            outline: none;
        }

        .password-submit {
            background: #4CAF50;
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            transition: background 0.3s, transform 0.2s;
        }

        .password-submit:hover {
            background: #45a049;
            transform: translateY(-2px);
        }

        .dev-menu {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) scale(0.95);
            background: #1a1a1a;
            padding: 30px;
            border-radius: 15px;
            width: 700px;
            max-height: 80vh;
            overflow-y: auto;
            z-index: 10001;
            box-shadow: 0 5px 30px rgba(0,0,0,0.3);
            border: 1px solid rgba(255, 255, 255, 0.1);
            transition: transform 0.3s ease, opacity 0.3s ease;
            opacity: 0;
        }

        .dev-menu-backdrop {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.7);
            backdrop-filter: blur(5px);
            z-index: 10000;
            opacity: 0;
            transition: opacity 0.3s ease;
            display: none;
        }

        .dev-menu-backdrop.showing {
            opacity: 1;
            display: block;
        }

        .dev-menu-backdrop.hiding {
            opacity: 0;
        }

        .dev-menu.opening {
            transform: translate(-50%, -50%) scale(1);
            opacity: 1;
        }

        .dev-menu.closing {
            transform: translate(-50%, -50%) scale(0.95);
            opacity: 0;
        }

        .dev-menu h2 {
            margin-bottom: 25px;
            text-align: center;
            color: #fff;
            font-size: 28px;
        }

        .dev-menu-section {
            margin-bottom: 25px;
            padding: 20px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            background: #2a2a2a;
            position: relative;
        }

        .dev-menu-section h3 {
            margin-bottom: 15px;
            color: #fff;
            font-size: 18px;
        }

        .dev-menu-input {
            width: 100%;
            padding: 10px;
            margin: 8px 0;
            border: 2px solid #333;
            border-radius: 6px;
            background: #1a1a1a;
            color: #fff;
            font-size: 14px;
        }

        .dev-menu-input:focus {
            border-color: #4CAF50;
            outline: none;
        }

        .dev-menu-button {
            background: #4a4a4a;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 6px;
            cursor: pointer;
            margin: 5px;
            font-weight: 600;
            transition: background 0.3s, transform 0.2s;
        }

        .dev-menu-button:hover {
            background: #333;
            transform: translateY(-2px);
        }

        .dev-menu-button.primary {
            background: #4CAF50;
        }

        .dev-menu-button.primary:hover {
            background: #45a049;
        }

        .dev-menu-button.danger {
            background: #ff4444;
        }

        .dev-menu-button.danger:hover {
            background: #cc0000;
        }

        .close-button {
            position: absolute;
            top: 15px;
            right: 15px;
            background: none;
            border: none;
            color: #fff;
            font-size: 24px;
            cursor: pointer;
            padding: 5px;
            transition: transform 0.3s;
        }

        .close-button:hover {
            transform: rotate(90deg);
        }

        .rarity-sort-container {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin: 20px 0;
            padding: 15px;
            background: #1a1a1a;
            border-radius: 8px;
        }

        .rarity-item {
            padding: 12px;
            background: #2a2a2a;
            border-radius: 6px;
            /* cursor: move; */
            display: flex;
            justify-content: space-between;
            align-items: center;
            color: #fff;
            border: 1px solid var(--dev-menu-border);
        }

        .rarity-color-picker {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .color-preview {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            border: 2px solid #333;
        }

        .rainbow-option {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-top: 12px;
            color: #fff;
        }

        .rainbow-option input[type="checkbox"] {
            width: 18px;
            height: 18px;
            cursor: pointer;
        }

        .error-message {
            position: fixed;
            top: 20px;
            left: -300px;
            background: #ff4444;
            color: white;
            padding: 15px 25px;
            border-radius: 8px;
            transition: left 0.3s ease;
            z-index: 10002;
            box-shadow: 0 3px 10px rgba(0,0,0,0.2);
        }

        .error-message.show {
            left: 20px;
        }

        .dev-menu-action-btn {
            position: absolute;
            bottom: 18px;
            right: 18px;
            z-index: 2;
            min-width: 110px;
        }

        .rainbow {
            background: linear-gradient(270deg, #ff6ec7, #ffd700, #7ed6ff, #3bb273, #a259e6, #ff6ec7);
            background-size: 1200% 1200%;
            animation: rainbowBG 3s linear infinite;
            color: #fff !important;
            border-color: #fff;
        }
        @keyframes rainbowBG {
            0% {background-position:0% 50%}
            50% {background-position:100% 50%}
            100% {background-position:0% 50%}
        }

        .theme-toggle {
            position: fixed;
            bottom: 20px;
            left: 20px;
            width: 50px;
            height: 50px;
            background: var(--card-bg);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            box-shadow: 0 2px 10px var(--card-shadow);
            transition: transform 0.3s ease, background-color 0.3s ease;
            z-index: 10000;
        }

        .theme-toggle:hover {
            transform: scale(1.1);
        }

        .theme-toggle i {
            font-size: 24px;
            color: var(--text-color);
            transition: transform 0.3s ease, color 0.3s ease;
        }

        .theme-toggle:hover i {
            transform: rotate(15deg);
        }

        .games-container {
            display: flex;
            gap: 24px;
            justify-content: flex-start;
            align-items: stretch;
            margin-top: 10px;
        }
        .game-card {
            background: linear-gradient(135deg, #6a82fb 0%, #fc5c7d 100%);
            border-radius: 18px;
            width: 180px;
            min-height: 260px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: flex-end;
            box-shadow: 0 4px 18px rgba(0,0,0,0.13);
            padding: 24px 18px 18px 18px;
            position: relative;
            transition: transform 0.2s, box-shadow 0.2s;
            cursor: pointer;
            overflow: hidden;
        }
        .game-card:hover {
            transform: translateY(-8px) scale(1.04);
            box-shadow: 0 8px 32px rgba(0,0,0,0.18);
        }
        .game-card .game-icon {
            font-size: 48px;
            margin-bottom: 18px;
            color: #fff;
        }
        .game-card .game-title {
            font-size: 22px;
            font-weight: 700;
            color: #fff;
            margin-bottom: 6px;
            letter-spacing: 1px;
        }
        .game-card .game-subtitle {
            font-size: 13px;
            color: #fff;
            opacity: 0.8;
            margin-bottom: 18px;
        }
        .game-card .game-playing {
            font-size: 15px;
            color: #fff;
            font-weight: 600;
            margin-bottom: 0;
            display: flex;
            align-items: center;
            gap: 6px;
        }
        .game-card .dot {
            width: 10px;
            height: 10px;
            background: #19e05c;
            border-radius: 50%;
            display: inline-block;
            margin-right: 4px;
        }
        .game-card.mines {
            background: linear-gradient(135deg, #36d1c4 0%, #5b86e5 100%);
        }
        .game-card.dice {
            background: linear-gradient(135deg, #fc5c7d 0%, #6a82fb 100%);
        }
        .game-card.crash {
            background: linear-gradient(135deg, #f7971e 0%, #ffd200 100%);
        }
        .game-card .sheen {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(120deg, rgba(255,255,255,0.18) 0%, rgba(255,255,255,0.45) 50%, rgba(255,255,255,0.18) 100%);
            opacity: 0;
            pointer-events: none;
            border-radius: 18px;
            transition: opacity 0.25s;
            z-index: 2;
        }
        .game-card:hover .sheen {
            opacity: 1;
        }

        /* Game Modal Styles */
        .game-modal-backdrop {
            position: fixed;
            top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(0,0,0,0.7);
            backdrop-filter: blur(5px);
            z-index: 10001;
            opacity: 0;
            transition: opacity 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .game-modal-backdrop.showing {
            opacity: 1;
        }
        .game-modal-content {
            background: #1a1a1a;
            border-radius: 18px;
            width: 320px;
            height: 460px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.18);
            position: relative;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            border: 1.5px solid rgba(255,255,255,0.1);
            color: #fff;
            opacity: 0;
            transform: scale(0.95);
            transition: opacity 0.3s, transform 0.3s;
            padding: 0 24px;
        }
        .game-modal-backdrop.showing .game-modal-content {
            opacity: 1;
            transform: scale(1);
        }
        .game-modal-close {
            position: absolute;
            top: 12px;
            right: 18px;
            font-size: 22px;
            color: #888;
            cursor: pointer;
        }
        .game-modal-icon {
            font-size: 48px;
            margin-bottom: 12px;
        }
        .game-modal-title {
            font-size: 26px;
            font-weight: 700;
            margin-bottom: 10px;
            letter-spacing: 1px;
        }
        .game-modal-desc {
            font-size: 15px;
            color: #ccc;
            margin-bottom: 32px;
            text-align: center;
        }
        .game-modal-play {
            background: #19e05c;
            color: #fff;
            border: none;
            border-radius: 8px;
            padding: 12px 32px;
            font-size: 17px;
            font-weight: 700;
            cursor: pointer;
            margin-top: 10px;
            transition: background 0.2s;
        }
        .game-modal-play:hover {
            background: #13b94a;
        }

        .mines-tab {
            display: none;
            background: var(--card-bg);
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 2px 10px var(--card-shadow);
            margin-top: 20px;
            position: relative;
            width: 100%;
            min-height: 500px;
            flex: 1;
            gap: 32px;
            z-index: 10;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.4s cubic-bezier(.22,.68,0,1.01);
        }
        .mines-tab.active {
            display: flex;
            opacity: 1;
            pointer-events: auto;
        }
        .mines-tab.leaving {
            opacity: 0;
            pointer-events: none;
        }
        .mines-left-panel {
            width: 340px;
            background: var(--mines-left-bg, #23272e);
            border-radius: 18px;
            padding: 36px 28px 28px 28px;
            display: flex;
            flex-direction: column;
            gap: 22px;
            color: var(--mines-left-color, #fff);
            position: relative;
            min-height: 600px;
            box-sizing: border-box;
        }
        .mines-close-btn-box {
            position: absolute;
            right: 18px;
            bottom: 18px;
            width: 38px;
            height: 38px;
            background: #eee;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
            cursor: pointer;
            z-index: 2;
            transition: background 0.2s;
        }
        [data-theme="dark"] .mines-close-btn-box {
            background: #23272e;
        }
        .mines-close-btn-box:hover {
            background: #ff4444;
        }
        .mines-close-btn-x {
            color: #888;
            font-size: 22px;
            font-weight: bold;
            transition: color 0.2s;
        }
        .mines-close-btn-box:hover .mines-close-btn-x {
            color: #fff;
        }
        .mines-toggle-group {
            display: flex;
            gap: 8px;
            margin-bottom: 10px;
        }
        .mines-toggle-btn {
            flex: 1;
            padding: 10px 0;
            border: none;
            border-radius: 8px;
            background: var(--mines-toggle-bg, #2a2d34);
            color: var(--mines-toggle-color, #fff);
            font-weight: 700;
            font-size: 17px;
            cursor: pointer;
            transition: background 0.2s;
        }
        .mines-toggle-btn.active {
            background: #19e05c;
            color: #fff;
        }
        .mines-label {
            font-size: 15px;
            font-weight: 600;
            margin-bottom: 4px;
        }
        .mines-bet-row {
            position: relative;
            display: flex;
            align-items: center;
        }
        .mines-bet-input {
            flex: 1;
            padding: 8px 60px 8px 10px;
            border-radius: 6px;
            border: 1.5px solid var(--mines-input-border, #444);
            font-size: 18px;
            background: var(--mines-input-bg, #181a20);
            color: var(--mines-input-color, #fff);
        }
        .mines-bet-quick-inside {
            position: absolute;
            right: 8px;
            top: 50%;
            transform: translateY(-50%);
            display: flex;
            flex-direction: column;
            gap: 4px;
        }
        .mines-bet-quick-btn {
            background: var(--mines-quick-bg, #e0e0e0);
            color: var(--mines-quick-color, #222);
            border: none;
            border-radius: 6px;
            font-size: 14px;
            font-weight: 700;
            padding: 2px 10px;
            cursor: pointer;
            transition: background 0.2s;
        }
        [data-theme="dark"] .mines-bet-quick-btn {
            background: #23272e;
            color: #fff;
        }
        .mines-bet-quick-btn:hover {
            background: #19e05c;
            color: #fff;
        }
        .mines-select {
            width: 100%;
            padding: 8px 10px;
            border-radius: 6px;
            border: 1.5px solid var(--mines-input-border, #444);
            font-size: 16px;
            background: var(--mines-input-bg, #181a20);
            color: var(--mines-input-color, #fff);
        }
        .mines-bet-btn {
            background: #19e05c;
            color: #fff;
            border: none;
            border-radius: 8px;
            padding: 16px 0;
            font-size: 20px;
            font-weight: 700;
            cursor: pointer;
            margin-top: 18px;
            transition: background 0.2s;
        }
        .mines-bet-btn:hover {
            background: #13b94a;
        }
        .mines-auto-controls {
            margin-top: 8px;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        .mines-auto-row {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .mines-auto-label {
            font-size: 13px;
            color: #bbb;
            min-width: 90px;
        }
        .mines-right-panel {
            flex: 1;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .mines-grid {
            display: grid;
            grid-template-columns: repeat(5, 80px);
            grid-template-rows: repeat(5, 80px);
            gap: 18px;
        }
        .mines-tile {
            width: 80px;
            height: 80px;
            background: var(--mines-tile-bg, #23272e);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 38px;
            color: var(--mines-tile-color, #19e05c);
            cursor: pointer;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
            transition: background 0.2s, color 0.2s, transform 0.2s, box-shadow 0.2s;
            user-select: none;
        }

        @keyframes mineClickAnimation {
            0% { transform: scale(1); }
            20% { transform: scale(0.9); background: #666; }
            40% { transform: scale(1.1); }
            60% { transform: scale(0.95); }
            100% { transform: scale(1); }
        }

        .mines-tile.clicking {
            animation: mineClickAnimation 0.4s cubic-bezier(.22,.68,0,1.71);
            pointer-events: none;
        }

        .mines-tile.revealed {
            background: var(--mines-tile-revealed-bg, #181a20);
            color: var(--mines-tile-revealed-color, #fff);
            cursor: default;
            transform: scale(1);
        }

        .mines-tile.revealed i {
            display: inline-block;
        }

        .mines-tile:not(.revealed):hover {
            transform: scale(1.05);
            box-shadow: 0 4px 15px rgba(0,0,0,0.15);
        }
        .mines-tile.dev-mine {
            box-shadow: 0 0 0 4px rgba(255,0,0,0.18) inset !important;
        }
        .mines-tile.dev-safe {
            box-shadow: 0 0 0 4px rgba(0,255,0,0.13) inset !important;
        }
        [data-theme="dark"] {
            --mines-left-bg: #23272e;
            --mines-left-color: #fff;
            --mines-toggle-bg: #2a2d34;
            --mines-toggle-color: #fff;
            --mines-input-bg: #181a20;
            --mines-input-color: #fff;
            --mines-input-border: #444;
            --mines-quick-bg: #23272e;
            --mines-quick-color: #fff;
            --mines-tile-bg: #23272e;
            --mines-tile-color: #19e05c;
            --mines-tile-revealed-bg: #181a20;
            --mines-tile-revealed-color: #fff;
        }
        [data-theme="light"], :root:not([data-theme="dark"]) {
            --mines-left-bg: #f7f7fa;
            --mines-left-color: #222;
            --mines-toggle-bg: #e0e0e0;
            --mines-toggle-color: #222;
            --mines-input-bg: #fff;
            --mines-input-color: #222;
            --mines-input-border: #bbb;
            --mines-quick-bg: #e0e0e0;
            --mines-quick-color: #222;
            --mines-tile-bg: #e0e0e0;
            --mines-tile-color: #3bb273;
            --mines-tile-revealed-bg: #fff;
            --mines-tile-revealed-color: #222;
        }
        .notification {
            min-width: 320px;
            max-width: 90vw;
            background: #23272e;
            color: #fff;
            padding: 22px 36px 18px 36px;
            border-radius: 14px;
            box-shadow: 0 4px 24px rgba(0,0,0,0.18);
            font-size: 18px;
            font-weight: 600;
            opacity: 0;
            transition: transform 0.4s cubic-bezier(.22,.68,0,1.01), opacity 0.3s;
            display: flex;
            flex-direction: column;
            align-items: center;
            margin-bottom: 12px;
        }
        .notification.show {
            opacity: 1;
            transform: none;
        }
        .notification-timer {
            width: 100%;
            height: 5px;
            background: #444;
            border-radius: 3px;
            margin-top: 14px;
            overflow: hidden;
            position: relative;
        }
        .notification-timer-bar {
            height: 100%;
            background: #19e05c;
            border-radius: 3px;
            position: absolute;
            left: 0;
            top: 0;
            width: 100%;
            transition: width linear;
        }
        #notification-root {
            position: fixed;
            left: 50%;
            bottom: 32px;
            transform: translateX(-50%);
            z-index: 20000;
            display: flex;
            flex-direction: column-reverse;
            align-items: center;
            pointer-events: none;
        }

        .dice-tab {
            display: none;
            background: var(--card-bg);
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 2px 10px var(--card-shadow);
            margin-top: 20px;
            position: relative;
            width: 100%;
            min-height: 500px;
            flex: 1;
            gap: 32px;
            z-index: 10;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.4s cubic-bezier(.22,.68,0,1.01);
        }

        .dice-tab.active {
            display: flex;
            opacity: 1;
            pointer-events: auto;
        }

        .dice-tab.leaving {
            opacity: 0;
            pointer-events: none;
        }

        .dice-container {
            width: 100%;
            max-width: 600px;
            margin: 0 auto;
            padding: 20px;
            display: flex;
            flex-direction: column;
            gap: 24px;
        }

        .dice-bet-section {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .dice-bet-label {
            font-size: 16px;
            font-weight: 600;
            color: var(--text-color);
        }

        .dice-bet-input {
            width: 100%;
            padding: 12px;
            border: 2px solid var(--border-color);
            border-radius: 8px;
            font-size: 18px;
            background: var(--card-bg);
            color: var(--text-color);
            transition: border-color 0.3s;
        }

        .dice-bet-input:focus {
            border-color: #3b82f6;
            outline: none;
        }

        .dice-slider-section {
            display: flex;
            flex-direction: column;
            gap: 8px;
            margin-bottom: 12px;
        }

        .dice-slider-container {
            width: 100%;
            height: 120px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 12px;
        }

        .dice-slider-track {
            width: 100%;
            height: 10px;
            background: #23272e;
            border-radius: 12px;
            position: relative;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .dice-slider-bar {
            position: absolute;
            left: 0;
            top: 0;
            height: 100%;
            background: linear-gradient(90deg, #19e05c 0%, #19e05c 50%, #ff4444 50%, #ff4444 100%);
            border-radius: 12px;
            width: 100%;
            z-index: 1;
        }

        .dice-slider-handle {
            position: absolute;
            top: 50%;
            left: 50%;
            width: 32px;
            height: 32px;
            background: #3b82f6;
            border-radius: 50%;
            border: 3px solid #fff;
            box-shadow: 0 2px 8px rgba(0,0,0,0.2);
            transform: translate(-50%, -50%);
            z-index: 2;
            transition: box-shadow 0.2s;
            pointer-events: none;
        }
        .dice-slider-blocker {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 3;
            background: transparent;
        }
        .dice-slider-input {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            opacity: 0;
            z-index: 4;
            cursor: pointer;
        }

        .dice-slider-triangle {
            position: absolute;
            top: -21px;
            left: 50%;
            width: 16px;
            height: 16px;
            background: #4b5563;
            transform: translateX(-50%) rotate(45deg);
            z-index: 2;
            transition: left 0.3s cubic-bezier(.22,.68,0,1.01);
            filter: drop-shadow(0 2px 4px rgba(0,0,0,0.2));
            opacity: 0;
            pointer-events: none;
            border-radius: 3px;
        }

        .dice-slider-triangle::after {
            content: '';
            position: absolute;
            top: 2px;
            left: 2px;
            width: 12px;
            height: 12px;
            background: #9ca3af;
            border-radius: 2px;
        }

        .dice-slider-triangle.show {
            opacity: 1;
        }

        .dice-stats {
            display: flex;
            justify-content: space-between;
            width: 100%;
            padding: 0 12px;
            font-size: 16px;
            color: var(--text-color);
        }

        .dice-stat {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 4px;
        }

        .dice-stat-label {
            font-size: 14px;
            color: #666;
        }

        .dice-stat-value {
            font-size: 18px;
            font-weight: 600;
            border: 2px solid var(--border-color);
            border-radius: 8px;
            background: var(--card-bg);
            color: var(--text-color);
            padding: 8px 0;
            transition: border-color 0.3s;
            outline: none;
        }
        .dice-stat-value:focus {
            border-color: #3b82f6;
        }

        .dice-roll-button {
            background: #22c55e;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            width: 100%;
            margin-bottom: 8px;
        }

        .dice-roll-button:hover {
            background: #16a34a;
            transform: translateY(-1px);
        }

        .dice-roll-button:disabled {
            background: #9ca3af;
            cursor: not-allowed;
            transform: none;
        }

        .dice-auto-bet-button {
            background: #3b82f6;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            width: 100%;
            margin-bottom: 8px;
        }

        .dice-auto-bet-button:hover {
            background: #2563eb;
            transform: translateY(-1px);
        }

        .dice-auto-bet-button.active {
            background: #dc2626;
        }

        .dice-auto-bet-button.active:hover {
            background: #b91c1c;
        }

        .dice-profit-target {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            width: 100%;
            margin-top: 12px;
        }

        .dice-profit-target label {
            color: var(--text-color);
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 6px;
            align-self: flex-start;
        }

        .dice-profit-target input {
            width: 100%;
            padding: 12px;
            border: 2px solid var(--border-color);
            border-radius: 8px;
            font-size: 18px;
            background: var(--card-bg);
            color: var(--text-color);
            transition: border-color 0.3s;
            text-align: center;
        }

        .dice-profit-target input:focus {
            border-color: #3b82f6;
            outline: none;
        }

        .dice-flip-toggle {
            margin: -5px auto 18px auto;
            display: block;
            background: #e5e7eb;
            color: #222;
            border: none;
            border-radius: 8px;
            padding: 8px 18px;
            font-size: 15px;
            font-weight: 600;
            cursor: pointer;
            transition: background 0.2s;
        }
        .dice-flip-toggle:hover {
            background: #d1d5db;
        }

        .dice-result {
            position: relative;
            display: flex;
            justify-content: center;
            align-items: center;
            margin: 12px 0 0 0;
            font-size: 48px;
            font-weight: 700;
            opacity: 0;
            transition: opacity 0.3s;
            color: inherit;
        }

        .dice-result.show {
            opacity: 1;
        }

        .dice-result.win {
            color: #19e05c !important;
        }

        .dice-result.lose {
            color: #ff4444 !important;
        }

        .dice-close-btn {
            position: absolute;
            top: 20px;
            right: 20px;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: var(--card-bg);
            border: 2px solid var(--border-color);
            color: var(--text-color);
            font-size: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.2s;
        }

        .dice-close-btn:hover {
            background: #ff4444;
            border-color: #ff4444;
            color: white;
        }

        /* Remove number input arrows for Win Chance and Multiplier */
        input.dice-stat-value::-webkit-outer-spin-button,
        input.dice-stat-value::-webkit-inner-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }
        input.dice-stat-value[type=number] {
            -moz-appearance: textfield;
        }

        .theme-toggle:hover i {
            transform: rotate(15deg);
        }

        .account-setup-modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.8);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 20000;
            backdrop-filter: blur(5px);
        }

        .account-setup-content {
            background: var(--card-bg);
            border-radius: 15px;
            width: 400px;
            box-shadow: 0 5px 30px rgba(0,0,0,0.3);
            overflow: hidden;
        }

        .account-setup-tabs {
            display: flex;
            border-bottom: 1px solid var(--border-color);
        }

        .account-setup-tab {
            padding: 15px 25px;
            font-weight: 600;
            cursor: pointer;
            opacity: 0.7;
            transition: opacity 0.3s;
            color: var(--text-color);
        }

        .account-setup-tab.active {
            opacity: 1;
            border-bottom: 2px solid #3b82f6;
        }

        .account-setup-body {
            padding: 25px;
        }

        .account-setup-section {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .account-setup-input-group {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }

        .account-setup-input-group label {
            font-weight: 600;
            color: var(--text-color);
        }

        .account-setup-input-group input {
            padding: 10px;
            border-radius: 8px;
            border: 1.5px solid var(--border-color);
            background: var(--card-bg);
            color: var(--text-color);
            font-size: 15px;
        }

        .account-setup-submit {
            background: #3b82f6;
            color: white;
            border: none;
            padding: 12px;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            margin-top: 10px;
            transition: background 0.3s;
        }

        .account-setup-submit:hover {
            background: #2563eb;
        }

        .notification-container {
            position: fixed;
            top: 20px;
            left: 20px;
            z-index: 30000;
        }

        .account-notification {
            background: #4CAF50;
            color: white;
            padding: 12px 20px;
            border-radius: 8px;
            margin-bottom: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            transform: translateX(-120%);
            transition: transform 0.3s cubic-bezier(.22,.68,0,1.01);
        }

        .account-notification.show {
            transform: translateX(0);
        }

        .upload-box {
            border: 2px dashed var(--border-color);
            border-radius: 12px;
            padding: 40px 20px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
            margin-bottom: 20px;
        }

        .upload-box.dragover {
            border-color: #3b82f6;
            background: rgba(59, 130, 246, 0.1);
        }

        .upload-icon {
            font-size: 40px;
            color: var(--text-color);
            margin-bottom: 15px;
            opacity: 0.7;
        }

        .upload-text {
            color: var(--text-color);
            font-weight: 600;
            opacity: 0.8;
        }

        #verifySection {
            animation: slideDown 0.3s ease;
        }

        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Add styles for centered welcome notification */
        .welcome-notification {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) scale(0.9);
            background: var(--card-bg);
            color: var(--text-color);
            padding: 25px 40px;
            border-radius: 12px;
            box-shadow: 0 5px 30px rgba(0,0,0,0.3);
            font-size: 24px;
            font-weight: 600;
            opacity: 0;
            z-index: 30000;
            transition: all 0.3s cubic-bezier(.22,.68,0,1.01);
        }

        .welcome-notification.show {
            opacity: 1;
            transform: translate(-50%, -50%) scale(1);
        }

        .keno-btn {
            width: 64px;
            height: 64px;
            border-radius: 8px;
            background: #e0e0e0;
            color: #333;
            font-size: 22px;
            font-weight: 700;
            border: 2px solid #bbb;
            cursor: pointer;
            transition: background 0.18s, color 0.18s, transform 0.13s, box-shadow 0.18s;
            box-shadow: 0 1px 4px rgba(0,0,0,0.08);
            outline: none;
            user-select: none;
        }
        [data-theme="dark"] .keno-btn {
            background: #23272e;
            color: #fff;
            border-color: #444;
        }
        .keno-btn.selected {
            background: #a259e6;
            color: #fff;
            transform: scale(1.13);
            box-shadow: 0 2px 8px #a259e6aa;
            z-index: 2;
        }
        .keno-btn:active {
            transform: scale(0.93);
        }
        .keno-btn.hit {
            background: #19e05c !important;
            color: #fff !important;
            border-color: #19e05c !important;
            box-shadow: 0 2px 8px #19e05c88;
        }
        .keno-btn.miss {
            background: #bbb !important;
            color: #fff !important;
            border-color: #bbb !important;
            opacity: 0.7;
            transition: background 0.3s, color 0.3s, border-color 0.3s, opacity 0.3s, transform 0.18s;
        }
        .keno-btn.unmiss-anim {
            animation: kenoUnmissAnim 0.32s cubic-bezier(.22,.68,0,1.01);
        }
        @keyframes kenoUnmissAnim {
            0% { transform: scale(1); opacity: 0.7; }
            40% { transform: scale(0.7); opacity: 0.7; }
            70% { transform: scale(1.15); opacity: 1; }
            100% { transform: scale(1); opacity: 1; }
        }
        .keno-btn.disabled {
            pointer-events: none;
            opacity: 0.7;
        }
        .keno-payout-table {
            font-size: 20px;
            color: var(--text-color);
            background: var(--card-bg);
            border-radius: 12px;
            box-shadow: 0 1px 4px rgba(0,0,0,0.08);
            padding: 18px 24px;
            margin-top: 10px;
            min-width: 180px;
        }
        .keno-payout-table th, .keno-payout-table td {
            padding: 6px 14px;
            text-align: right;
        }
        .keno-payout-table th {
            color: #a259e6;
            font-weight: 700;
            font-size: 22px;
        }
        .keno-payout-float {
            position: absolute;
            left: 80px;
            top: 50%;
            transform: translateY(-50%);
            z-index: 10;
            display: flex;
            align-items: flex-start;
        }
        @media (max-width: 1100px) {
            .keno-payout-float {
                position: static;
                transform: none;
                margin-bottom: 24px;
                justify-content: center;
                width: 100%;
            }
        }
        .keno-payout-outer {
            background: #fff;
            border-radius: 14px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.08);
            padding: 18px 10px 10px 10px;
            min-width: 180px;
            margin: 0 24px 0 0;
        }

        .game-card.coinflip {
            background: linear-gradient(135deg, #f9d423 0%, #ff4e50 100%);
        }
        .game-card.dragon-tower {
            background: linear-gradient(135deg, #43cea2 0%, #185a9d 100%);
        }
        .game-card.blackjack {
            background: linear-gradient(135deg, #f7971e 0%, #ffd200 100%);
        }
        .game-card.keno {
            background: linear-gradient(135deg, #f953c6 0%, #b91d73 100%);
        }
        .game-card.slide {
            background: linear-gradient(135deg, #43cea2 0%, #185a9d 100%);
        }

        /* First, add the CSS for the disabled button state */
        .suggestions-submit-btn:disabled {
            background: #9ca3af !important;
            cursor: not-allowed !important;
            transform: none !important;
        }

        .stats-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px var(--card-shadow);
        }

        .stats-button:active {
            transform: translateY(0);
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: scale(0.8); }
            to { opacity: 1; transform: scale(1); }
        }

        .game-card.slide {
            background: linear-gradient(135deg, #43cea2 0%, #185a9d 100%);
        }

        .slide-roll-strip {
            width: 100%;
            height: 60px;
            background: var(--bg-color);
            border-radius: 10px;
            overflow: hidden;
            position: relative;
            border: 2px solid var(--border-color);
        }

        .slide-roll-items {
            display: flex;
            align-items: center;
            height: 100%;
            transition: transform 8s cubic-bezier(.22,.68,0,1.01);
            will-change: transform;
        }

        .slide-multiplier {
            width: 80px;
            height: 56px;
            margin: 0 4px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 15px;
            font-weight: 600;
            color: #fff;
            flex-shrink: 0;
            background: #23272e;
            position: relative;
            overflow: hidden;
        }

        .slide-multiplier.low { background: #3bb273; }
        .slide-multiplier.medium { background: #3b82f6; }
        .slide-multiplier.high { background: #a259e6; }
        .slide-multiplier.epic { background: #ffd700; color: #b8860b; }
        .slide-multiplier.legendary { background: #ff6ec7; }

        .slide-roll-pointer {
            position: absolute;
            top: 0;
            bottom: 0;
            left: 50%;
            width: 4px;
            background: #19e05c;
            transform: translateX(-50%);
            border-radius: 2px;
            z-index: 2;
        }

        .slide-bet-item {
            background: var(--bg-color);
            border-radius: 8px;
            padding: 12px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
            border: 1.5px solid var(--border-color);
        }

        .slide-bet-item .amount {
            font-weight: 600;
            color: var(--text-color);
        }

        .slide-bet-item .target {
            color: #19e05c;
            font-weight: 700;
        }

        /* First, add the CSS for the disabled button state */
    </style>
    </style>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body>
    <div class="sidebar">
        <div class="sidebar-content">
            <div class="sidebar-item" onclick="showTab('games')">
                <i class="fas fa-gamepad"></i>
                <span>Games</span>
            </div>
            <div class="sidebar-item" onclick="showTab('withdraw')">
                <i class="fas fa-wallet"></i>
                <span>Withdraw</span>
            </div>
            <div class="sidebar-item" onclick="showTab('statistics')">
                <i class="fas fa-chart-line"></i>
                <span>Statistics</span>
            </div>
            <div class="sidebar-item" onclick="showTab('updateLog')">
                <i class="fas fa-clipboard-list"></i>
                <span>Update Log</span>
            </div>
            <div class="sidebar-item" onclick="showTab('settings')">
                <i class="fas fa-cog"></i>
                <span>Settings</span>
            </div>
            <div class="sidebar-item" onclick="showTab('suggestions')">
                <i class="fas fa-lightbulb"></i>
                <span>Suggestions</span>
            </div>
        </div>
    </div>

    <div class="main-content">
        <div class="balance-container">
            <i class="fas fa-coins"></i>
            <span class="balance-amount">$1000.00</span>
        </div>

        <div id="games" class="content-tab active">
            <div class="games-container">
                <div class="game-card mines" onclick="showGameModal('mines')">
                    <div class="game-icon"><i class="fas fa-gem"></i></div>
                    <div class="game-title">MINES</div>
                    <div class="game-subtitle">STAKE ORIGINALS</div>
                    <div class="game-playing"><span class="dot"></span>252 playing</div>
                    <div class="sheen"></div>
                </div>
                <div class="game-card dice" onclick="showGameModal('dice')">
                    <div class="game-icon"><i class="fas fa-dice"></i></div>
                    <div class="game-title">DICE</div>
                    <div class="game-subtitle">STAKE ORIGINALS</div>
                    <div class="game-playing"><span class="dot"></span>389 playing</div>
                    <div class="sheen"></div>
                </div>
                <div class="game-card crash" onclick="showGameModal('crash')">
                    <div class="game-icon"><i class="fas fa-rocket"></i></div>
                    <div class="game-title">CRASH</div>
                    <div class="game-subtitle">STAKE ORIGINALS</div>
                    <div class="game-playing"><span class="dot"></span>151 playing</div>
                    <div class="sheen"></div>
                </div>
                <div class="game-card coinflip" onclick="showGameModal('coinflip')">
                    <div class="game-icon"><i class="fas fa-coins"></i></div>
                    <div class="game-title">COINFLIP</div>
                    <div class="game-subtitle">50/50 CHANCE</div>
                    <div class="game-playing"><span class="dot"></span>120 playing</div>
                    <div class="sheen"></div>
                </div>
                <div class="game-card dragon-tower" onclick="showGameModal('dragonTower')">
                    <div class="game-icon"><i class="fas fa-dragon"></i></div>
                    <div class="game-title">DRAGON TOWER</div>
                    <div class="game-subtitle">CLIMB &amp; CASHOUT</div>
                    <div class="game-playing"><span class="dot"></span>99 playing</div>
                    <div class="sheen"></div>
                </div>
                <div class="game-card blackjack" onclick="showGameModal('blackjack')">
                    <div class="game-icon"><i class="fas fa-clone"></i></div>
                    <div class="game-title">BLACKJACK</div>
                    <div class="game-subtitle">21 VS DEALER</div>
                    <div class="game-playing"><span class="dot"></span>77 playing</div>
                    <div class="sheen"></div>
                </div>
                <div class="game-card keno" onclick="showGameModal('keno')">
                    <div class="game-icon"><i class="fas fa-th"></i></div>
                    <div class="game-title">KENO</div>
                    <div class="game-subtitle">STAKE ORIGINALS</div>
                    <div class="game-playing"><span class="dot"></span>88 playing</div>
                    <div class="sheen"></div>
                </div>
                <div class="game-card slide" onclick="showGameModal('slide')">
                    <div class="game-icon"><i class="fas fa-sliders-h"></i></div>
                    <div class="game-title">SLIDE
                    (BROKEN)</div>
                    <div class="game-subtitle">PLACE UP TO FIVE BETS</div>
                    <div class="game-playing"><span class="dot"></span>0 playing</div>
                    <div class="sheen"></div>
                </div>
            </div>
        </div>

        <div id="coinflipTab" class="content-tab">
            <div style="max-width:500px;margin:40px auto 0 auto;background:var(--card-bg);padding:32px 28px 24px 28px;border-radius:14px;box-shadow:0 2px 10px var(--card-shadow);display:flex;flex-direction:column;align-items:center;">
                <h2 style="font-size:22px;font-weight:700;margin-bottom:18px;text-align:center;">Coinflip</h2>
                <div style="display:flex;gap:12px;margin-bottom:18px;width:100%;justify-content:center;">
                    <input type="number" id="coinflipBetAmount" min="1" max="100000" value="100" style="padding:10px;border-radius:8px;border:1.5px solid var(--border-color);font-size:16px;width:120px;">
                </div>
                <div class="coin" id="coinflipCoin" style="margin:18px auto 10px auto;font-size:48px;width:80px;height:80px;display:flex;align-items:center;justify-content:center;background:#ffd700;border-radius:50%;box-shadow:0 0 20px rgba(0,0,0,0.1);font-weight:bold;transition:transform 1s ease;">?</div>
                <div style="display:flex;gap:18px;justify-content:center;width:100%;">
                    <button class="bet-button" id="coinflipHeadsBtn">Heads</button>
                    <button class="bet-button" id="coinflipTailsBtn">Tails</button>
                </div>
            </div>
        </div>

        <div id="dragonTowerTab" class="content-tab">
            <div style="max-width:500px;margin:40px auto 0 auto;background:var(--card-bg);padding:32px 28px 24px 28px;border-radius:14px;box-shadow:0 2px 10px var(--card-shadow);display:flex;flex-direction:column;align-items:center;">
                <h2 style="font-size:22px;font-weight:700;margin-bottom:18px;text-align:center;">Dragon Tower</h2>
                <div style="margin:12px 0 8px 0;width:100%;">
                    <label style="font-weight:600;">Difficulty:</label>
                    <select id="dragonTowerDifficulty" style="width:100%;padding:8px;border-radius:7px;margin-top:4px;">
                        <option value="easy">Easy (2 safe, 1 dragon)</option>
                        <option value="medium" selected>Medium (1 safe, 2 dragons)</option>
                        <option value="hard">Hard (1 safe, 3 dragons)</option>
                    </select>
                </div>
                <div style="display:flex;gap:10px;width:100%;margin-bottom:10px;">
                    <input type="number" id="dragonTowerBetAmount" min="1" step="0.01" value="10" style="flex:1;padding:10px;border-radius:8px;border:1.5px solid var(--border-color);font-size:16px;">
                    <button id="dragonTowerBetBtn" style="padding:10px 18px;font-size:16px;font-weight:700;background:#3b82f6;color:#fff;border:none;border-radius:8px;cursor:pointer;">Bet</button>
                    <button id="dragonTowerCashoutBtn" style="padding:10px 24px;font-size:16px;font-weight:700;background:#19e05c;color:#fff;border:none;border-radius:8px;cursor:pointer;display:none;">Cash Out</button>
                </div>
                <div id="dragonTowerMultiplier" style="font-size:22px;font-weight:700;margin-bottom:8px;color:#19e05c;">1.00x</div>
                <div id="dragonTowerStatus" style="font-size:15px;color:#888;margin-bottom:8px;min-height:24px;"></div>
                <div id="dragonTowerGrid" style="display:flex;flex-direction:column;gap:8px;width:100%;align-items:center;"></div>
            </div>
        </div>

        <div id="updateLog" class="content-tab">
            <div style="max-width:600px;margin:40px auto 0 auto;background:var(--card-bg);padding:32px 28px 24px 28px;border-radius:14px;box-shadow:0 2px 10px var(--card-shadow);">
                <h2 style="font-size:22px;font-weight:700;margin-bottom:18px;text-align:center;">Update Log</h2>
                
                <div style="margin-bottom:30px;">
                    <h3 style="font-size:18px;font-weight:600;margin-bottom:12px;color:var(--text-color);">Latest updates:</h3>
                    <ul style="font-size:16px;line-height:1.7;color:var(--text-color);">
                        <li>Added an account system and encryption to prevent account stealing and stat altering.</li>
                        <li>Settings menu where you can save your account details.</li>
                        <li>Blackjack, Coinflip and Dragon Tower now have "Play" menus so you dont accidentally open a game.</li>
                        <li>Fixed Blackjack not allowing you to press the "Play Again" button after playing.</li>
                </ul>
                </div>

                <div>
                    <h3 style="font-size:18px;font-weight:600;margin-bottom:12px;color:var(--text-color);">To Do:</h3>
                    <ul style="font-size:16px;line-height:1.7;color:var(--text-color);">
                        <li>Fix menu vanishing when rapidly changing tabs</li>
                        <li>Add Keno to the latest build.</li>
                        <li>Add banking system to access your banking info.</li>
                        <li>Freshen up the visuals on the website as a whole.</li>
                    </ul>
                </div>
            </div>
        </div>

        <div id="settings" class="content-tab">
            <div style="max-width:600px;margin:40px auto 0 auto;background:var(--card-bg);padding:32px 28px 24px 28px;border-radius:14px;box-shadow:0 2px 10px var(--card-shadow);">
                <h2 style="font-size:22px;font-weight:700;margin-bottom:18px;text-align:center;">Settings</h2>
                <button onclick="downloadUserData()" style="width:100%;padding:12px;background:#3b82f6;color:white;border:none;border-radius:8px;font-weight:600;cursor:pointer;margin-top:10px;">Download User Data</button>
            </div>
        </div>

        <div id="minesTab" class="mines-tab">
            <div class="mines-left-panel">
                <div class="mines-toggle-group">
                    <button class="mines-toggle-btn active" id="minesManualBtn" onclick="setMinesMode('manual')">Manual</button>
                    <button class="mines-toggle-btn" id="minesAutoBtn" onclick="setMinesMode('auto')">Auto</button>
                </div>
                <div class="mines-label">Bet Amount</div>
                <div class="mines-bet-row">
                    <input type="number" id="minesBetAmount" class="mines-bet-input" min="0.01" value="1.00" />
                    <div class="mines-bet-quick-inside">
                        <button class="mines-bet-quick-btn" onclick="quickBet('half')"></button>
                        <button class="mines-bet-quick-btn" onclick="quickBet('double')">2</button>
                    </div>
                </div>
                <div class="mines-label">Mines</div>
                <select id="minesCount" class="mines-select">
                    <!-- Options will be populated by JS -->
                </select>
                <div id="minesAutoControls" class="mines-auto-controls" style="display:none;">
                    <div class="mines-auto-row">
                        <span class="mines-auto-label">Auto Tiles</span>
                        <input type="number" id="minesAutoTiles" class="mines-bet-input" min="1" max="24" value="1" style="width:80px;" />
                    </div>
                    <div class="mines-auto-row">
                        <span class="mines-auto-label">Auto Cashout</span>
                        <input type="checkbox" id="minesAutoCashout" style="width:18px;height:18px;" />
                        <span style="font-size:13px;color:#bbb;">Auto cash out after tiles</span>
                    </div>
                </div>
                <button class="mines-bet-btn" id="minesBetBtn" onclick="startMinesGame()">Bet</button>
                <div class="mines-close-btn-box" onclick="closeMinesTab()">
                    <span class="mines-close-btn-x">&times;</span>
                </div>
            </div>
            <div class="mines-right-panel">
                <div class="mines-grid" id="minesGrid">
                    <!-- 5x5 grid will be generated by JS -->
                </div>
            </div>
        </div>

        <div id="diceTab" class="dice-tab">
            <div class="dice-container">
                <div class="dice-bet-section">
                    <div class="dice-bet-label">Bet Amount</div>
                    <input type="number" class="dice-bet-input" id="diceBetAmount" min="0.01" step="0.01" value="1.00">
                </div>
                
                <div class="dice-slider-section">
                    <div class="dice-slider-container">
                        <div class="dice-slider-track">
                            <div class="dice-slider-bar" id="diceSliderBar"></div>
                            <div class="dice-slider-handle" id="diceSliderHandle"></div>
                            <div class="dice-slider-blocker"></div>
                            <input type="range" min="0" max="100" step="0.01" id="diceSliderInput" class="dice-slider-input" />
                            <div class="dice-slider-triangle"></div>
                        </div>
                        <div class="dice-stats">
                            <div class="dice-stat">
                                <span class="dice-stat-label">Win Chance</span>
                                <input class="dice-stat-value" id="diceWinChanceInput" type="number" min="0.01" max="99.99" step="0.01" value="50.00" style="width:80px;text-align:center;">%
                            </div>
                            <div class="dice-stat">
                                <span class="dice-stat-label">Multiplier</span>
                                <input class="dice-stat-value" id="diceMultiplierInput" type="number" min="1.01" max="100.00" step="0.01" value="2.00" style="width:80px;text-align:center;">x
                            </div>
                        </div>
                    </div>
                </div>

                <div class="dice-controls">
                    <button class="dice-roll-button" id="diceRollButton">Bet</button>
                    <button class="dice-auto-bet-button" id="diceAutoBetButton">Auto-Bet</button>
                    <div class="dice-profit-target">
                        <label>Profit Target</label>
                        <input type="number" id="diceProfitTarget" value="100" min="1" step="1">
                    </div>
                </div>

                <div class="dice-result" id="diceResult"></div>
            </div>
            <button class="dice-close-btn" onclick="closeDiceTab()">&times;</button>
        </div>

        <div id="withdraw" class="content-tab">
            <div style="max-width:400px;margin:40px auto 0 auto;background:var(--card-bg);padding:32px 28px 24px 28px;border-radius:14px;box-shadow:0 2px 10px var(--card-shadow);">
                <h2 style="font-size:22px;font-weight:700;margin-bottom:18px;text-align:center;">Withdraw</h2>
                <div style="margin-bottom:16px;">
                    <label for="withdrawCrypto" style="font-weight:600;">Cryptocurrency</label>
                    <select id="withdrawCrypto" style="width:100%;padding:10px;margin-top:6px;border-radius:8px;border:1.5px solid var(--border-color);font-size:16px;">
                        <option value="BTC">Bitcoin (BTC)</option>
                        <option value="ETH">Ethereum (ETH)</option>
                        <option value="USDT">Tether (USDT)</option>
                        <option value="LTC">Litecoin (LTC)</option>
                        <option value="DOGE">Dogecoin (DOGE)</option>
                    </select>
                </div>
                <div style="margin-bottom:16px;">
                    <label for="withdrawAddress" style="font-weight:600;">Wallet Address</label>
                    <input type="text" id="withdrawAddress" style="width:100%;padding:10px;margin-top:6px;border-radius:8px;border:1.5px solid var(--border-color);font-size:16px;" placeholder="Paste your wallet address here">
                </div>
                <div style="margin-bottom:24px;">
                    <label for="withdrawAmount" style="font-weight:600;">Amount</label>
                    <input type="number" id="withdrawAmount" min="1" step="0.01" style="width:100%;padding:10px;margin-top:6px;border-radius:8px;border:1.5px solid var(--border-color);font-size:16px;" placeholder="Enter amount to withdraw">
                </div>
                <button onclick="submitWithdrawal()" style="width:100%;padding:14px 0;font-size:17px;font-weight:700;background:#3b82f6;color:#fff;border:none;border-radius:8px;cursor:pointer;">Withdraw</button>
            </div>
        </div>

        <div id="crashTab" class="content-tab">
            <div style="max-width:500px;margin:40px auto 0 auto;background:var(--card-bg);padding:32px 28px 24px 28px;border-radius:14px;box-shadow:0 2px 10px var(--card-shadow);display:flex;flex-direction:column;align-items:center;">
                <h2 style="font-size:22px;font-weight:700;margin-bottom:18px;text-align:center;">Crash</h2>
                <div id="crashMultiplier" style="font-size:48px;font-weight:700;margin-bottom:18px;color:#19e05c;">1.00x</div>
                <div style="display:flex;gap:12px;margin-bottom:18px;width:100%;justify-content:center;">
                    <input type="number" id="crashBetAmount" min="1" step="0.01" value="10" style="padding:10px;border-radius:8px;border:1.5px solid var(--border-color);font-size:16px;width:120px;">
                    <button id="crashBetBtn" style="padding:12px 28px;font-size:16px;font-weight:700;background:#3b82f6;color:#fff;border:none;border-radius:8px;cursor:pointer;">Bet</button>
                    <button id="crashCashoutBtn" style="padding:12px 28px;font-size:16px;font-weight:700;background:#19e05c;color:#fff;border:none;border-radius:8px;cursor:pointer;display:none;">Cash Out</button>
                </div>
                <div style="display:flex;gap:10px;align-items:center;margin-bottom:10px;">
                    <label for="crashAutoCashout" style="font-size:15px;">Auto Cashout at</label>
                    <input type="number" id="crashAutoCashout" min="1.01" step="0.01" value="" placeholder="e.g. 2.00" style="width:90px;padding:6px 8px;border-radius:7px;border:1.5px solid var(--border-color);font-size:15px;">
                    <span style="font-size:15px;">x</span>
                </div>
                <div id="crashStatus" style="font-size:16px;color:#888;margin-bottom:8px;min-height:24px;"></div>
            </div>
        </div>

        <div id="blackjackTab" class="content-tab">
            <div style="max-width:500px;margin:40px auto 0 auto;background:var(--card-bg);padding:32px 28px 24px 28px;border-radius:14px;box-shadow:0 2px 10px var(--card-shadow);display:flex;flex-direction:column;align-items:center;">
                <h2 style="font-size:22px;font-weight:700;margin-bottom:18px;text-align:center;">Blackjack</h2>
                <div style="display:flex;gap:10px;width:100%;margin-bottom:10px;">
                    <input type="number" id="blackjackBetAmount" min="1" step="1" value="10" style="flex:1;padding:10px;border-radius:8px;border:1.5px solid var(--border-color);font-size:16px;">
                    <button id="blackjackBetBtn" style="padding:10px 18px;font-size:16px;font-weight:700;background:#3b82f6;color:#fff;border:none;border-radius:8px;cursor:pointer;">Bet</button>
                </div>
                <div id="blackjackGameArea" style="width:100%;margin-top:18px;"></div>
            </div>
        </div>

        <div id="kenoTab" class="content-tab" style="position:relative;">
            <div class="keno-payout-float">
                <div class="keno-payout-outer">
                    <div id="kenoPayoutTable" style="margin:0;width:100%;display:flex;justify-content:center;"></div>
                </div>
            </div>
            <div style="max-width:900px;margin:40px auto 0 auto;background:var(--card-bg);padding:32px 28px 24px 28px;border-radius:14px;box-shadow:0 2px 10px var(--card-shadow);display:flex;flex-direction:column;align-items:center;">
                <h2 style="font-size:22px;font-weight:700;margin-bottom:18px;text-align:center;">Keno</h2>
                <div style="margin-bottom:18px;text-align:center;color:var(--text-color);max-width:600px;">
                    You choose between 1 and 10 numbers on a grid of 40. After your selection, 10 numbers are randomly drawn. The more of your picks that match the drawn numbers, the higher your payout. Choosing fewer numbers offers safer, lower payouts, while more picks give riskier, high-reward potential.
                </div>
                <div style="display:flex;gap:0;width:100%;justify-content:center;align-items:flex-start;flex-wrap:wrap;">
                    <div id="kenoGrid" style="display:grid;grid-template-columns:repeat(8,64px);grid-template-rows:repeat(5,64px);gap:14px;"></div>
                    <div style="min-width:240px;max-width:340px;display:flex;flex-direction:column;align-items:center;margin-top:10px;">
                        <div style="margin-bottom:10px;font-weight:600;width:100%;">Bet Amount</div>
                        <input type="number" id="kenoBetAmount" min="0.01" step="0.01" value="1.00" style="width:100%;padding:10px;border-radius:8px;border:1.5px solid var(--border-color);font-size:16px;margin-bottom:16px;">
                        <button id="kenoDrawBtn" style="width:100%;padding:12px 0;font-size:17px;font-weight:700;background:#3b82f6;color:#fff;border:none;border-radius:8px;cursor:pointer;">Draw</button>
                        <div id="kenoResult" style="margin-top:18px;font-size:16px;font-weight:600;text-align:center;"></div>
                    </div>
                </div>
            </div>
        </div>

        <div id="slideTab" class="content-tab">
            <div style="max-width:1200px;margin:40px auto 0 auto;background:var(--card-bg);padding:32px 28px 24px 28px;border-radius:14px;box-shadow:0 2px 10px var(--card-shadow);display:flex;gap:32px;">
                <!-- Left Column: Betting -->
                <div style="flex:0 0 340px;">
                    <h2 style="font-size:22px;font-weight:700;margin-bottom:18px;">Place Your Bet</h2>
                    <div style="margin-bottom:18px;color:var(--text-color);">
                        Add up to 5 bets with different target multipliers.
                    </div>
                    <div style="display:flex;flex-direction:column;gap:16px;">
                        <div>
                            <div style="margin-bottom:8px;font-weight:600;">Bet Amount</div>
                            <input type="number" id="slideBetAmount" min="0.01" step="0.01" value="1.00" style="width:100%;padding:10px;border-radius:8px;border:1.5px solid var(--border-color);font-size:16px;">
                        </div>
                        <div>
                            <div style="margin-bottom:8px;font-weight:600;">Target Multiplier</div>
                            <input type="number" id="slideTargetMultiplier" min="1.01" step="0.01" value="2.00" style="width:100%;padding:10px;border-radius:8px;border:1.5px solid var(--border-color);font-size:16px;">
                        </div>
                        <button id="slideAddBetBtn" style="width:100%;padding:12px 0;font-size:17px;font-weight:700;background:#3b82f6;color:#fff;border:none;border-radius:8px;cursor:pointer;">Add Bet</button>
                        <div id="slideBetsList" style="margin-top:10px;">
                            <!-- Active bets will be listed here -->
                        </div>
                    </div>
                </div>

                <!-- Right Column: Rolling -->
                <div style="flex:1;position:relative;">
                    <h2 style="font-size:22px;font-weight:700;margin-bottom:18px;">Roll Results</h2>
                    <div id="slideRollsContainer" style="display:flex;flex-direction:column;gap:16px;">
                        <!-- Roll strips will be added here -->
                    </div>
                    <button id="slidePlayBtn" style="width:100%;padding:12px 0;font-size:17px;font-weight:700;background:#19e05c;color:#fff;border:none;border-radius:8px;cursor:pointer;margin-top:24px;">Start Rolling</button>
                </div>
            </div>
        </div>

        <div id="suggestions" class="content-tab">
            <div style="max-width:500px;margin:40px auto 0 auto;background:var(--card-bg);padding:32px 28px 24px 28px;border-radius:14px;box-shadow:0 2px 10px var(--card-shadow);display:flex;flex-direction:column;align-items:center;">
                <h2 style="font-size:22px;font-weight:700;margin-bottom:18px;text-align:center;">Suggestions</h2>
                <textarea id="suggestionInput" style="width:100%;min-height:120px;resize:vertical;padding:12px;border-radius:8px;border:1.5px solid var(--border-color);font-size:16px;margin-bottom:18px;" placeholder="Enter your suggestion here..."></textarea>
                <button id="submitSuggestionBtn" style="width:100%;padding:12px 0;font-size:17px;font-weight:700;background:#3b82f6;color:#fff;border:none;border-radius:8px;cursor:pointer;" class="suggestions-submit-btn">Submit</button>
                <div id="suggestionStatus" style="margin-top:16px;font-size:15px;text-align:center;"></div>
            </div>
        </div>

        <div id="statistics" class="content-tab">
            <div style="max-width:800px;margin:40px auto 0 auto;">
                <div style="display:flex;flex-direction:column;gap:20px;">
                    <!-- Games Statistics Button -->
                    <div class="stats-button" onclick="showGameStats()" style="background:var(--card-bg);padding:24px;border-radius:14px;box-shadow:0 2px 10px var(--card-shadow);cursor:pointer;transition:transform 0.2s,box-shadow 0.2s;">
                        <div style="display:flex;align-items:center;gap:15px;">
                            <i class="fas fa-dice" style="font-size:24px;color:var(--text-color);"></i>
                            <div style="flex:1;">
                                <div style="font-size:18px;font-weight:700;color:var(--text-color);margin-bottom:4px;">Games Statistics</div>
                                <div style="font-size:14px;color:#666;">View detailed statistics for each game</div>
                            </div>
                            <i class="fas fa-chevron-right" style="color:#666;"></i>
                        </div>
                    </div>

                    <!-- Profit Statistics Button -->
                    <div class="stats-button" onclick="showProfitStats()" style="background:var(--card-bg);padding:24px;border-radius:14px;box-shadow:0 2px 10px var(--card-shadow);cursor:pointer;transition:transform 0.2s,box-shadow 0.2s;">
                        <div style="display:flex;align-items:center;gap:15px;">
                            <i class="fas fa-chart-bar" style="font-size:24px;color:var(--text-color);"></i>
                            <div style="flex:1;">
                                <div style="font-size:18px;font-weight:700;color:var(--text-color);margin-bottom:4px;">Profit Statistics</div>
                                <div style="font-size:14px;color:#666;">Track your wins, losses, and overall profit</div>
                            </div>
                            <i class="fas fa-chevron-right" style="color:#666;"></i>
                        </div>
                    </div>

                    <!-- Time On Website Button -->
                    <div class="stats-button" onclick="showTimeStats()" style="background:var(--card-bg);padding:24px;border-radius:14px;box-shadow:0 2px 10px var(--card-shadow);cursor:pointer;transition:transform 0.2s,box-shadow 0.2s;">
                        <div style="display:flex;align-items:center;gap:15px;">
                            <i class="fas fa-clock" style="font-size:24px;color:var(--text-color);"></i>
                            <div style="flex:1;">
                                <div style="font-size:18px;font-weight:700;color:var(--text-color);margin-bottom:4px;">Time On Website</div>
                                <div style="font-size:14px;color:#666;">View your session and total time statistics</div>
                            </div>
                            <i class="fas fa-chevron-right" style="color:#666;"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div id="modal-root"></div>
    <div id="notification-root"></div>
    <div id="gameModalRoot"></div>
    <div id="inventory-actions" style="position:fixed;bottom:32px;left:50%;transform:translateX(-50%);z-index:10001;display:none;"></div>

    <div id="passwordModal" class="password-modal" style="display: none;">
        <div class="password-content">
            <h2>Enter Dev Password</h2>
            <input type="password" class="password-input" id="passwordInput">
            <button class="password-submit" onclick="checkPassword()">Submit</button>
        </div>
    </div>

    <div id="errorMessage" class="error-message">
        Incorrect password!
    </div>

    <div id="devMenu" class="dev-menu" style="display: none;">
        <button class="close-button" onclick="closeDevMenu()">&times;</button>
        <h2>Dev Menu</h2>

        <div class="dev-menu-section">
            <h3>Balance Tools</h3>
            <input type="number" id="setBalanceInput" class="dev-menu-input" placeholder="Set balance">
            <button class="dev-menu-button" onclick="setBalance()">Set Balance</button>
            <button class="dev-menu-button" onclick="addMoney(1000)">Add $1000</button>
            <button class="dev-menu-button" onclick="resetBalance()">Reset Balance</button>
        </div>

        <div class="dev-menu-section">
            <h3>Blackjack Tools</h3>
            <button class="dev-menu-button" onclick="blackjackInstantWin()">Instant 21 (Player)</button>
        </div>

        <div class="dev-menu-section">
            <h3>Dragon Tower Tools</h3>
            <button class="dev-menu-button" onclick="dragonTowerAutoSafe()">Auto Pick Safe Tile</button>
        </div>

        <div class="dev-menu-section">
            <h3>Debug Tools</h3>
            <button class="dev-menu-button" id="showMinesDevBtn" onclick="toggleShowMinesDev()">Show Mines (Dev)</button>
            <div style="margin-top:10px;">
                <label style="color:#fff;">
                    <input type="checkbox" id="showDragonTowerSafeTile" onchange="toggleShowDragonTowerSafeTile()" style="margin-right:6px;">
                    Show Safe Tile in Dragon Tower
                </label>
            </div>
            <div style="margin-top:10px;">
                <label style="color:#fff;">
                    <input type="checkbox" id="showBlackjackDealerCard" onchange="toggleShowBlackjackDealerCard()" style="margin-right:6px;">
                    Show Dealer's Hidden Card in Blackjack
                </label>
            </div>
        </div>

        <div class="dev-menu-section">
            <h3>Keno Tools</h3>
            <div style="margin-bottom:12px;">
                <label style="color:#fff;display:block;margin-bottom:6px;">Luck Multiplier</label>
                <input type="range" id="kenoLuckSlider" min="1" max="100" value="1" style="width:100%;">
                <div style="display:flex;justify-content:space-between;margin-top:4px;">
                    <span style="color:#666;font-size:13px;">Normal (1x)</span>
                    <span id="kenoLuckValue" style="color:#19e05c;font-weight:600;">1x</span>
                    <span style="color:#666;font-size:13px;">Max (100x)</span>
                </div>
            </div>
        </div>
    </div>

    <div id="devMenuBackdrop" class="dev-menu-backdrop"></div>

    <div class="theme-toggle" onclick="toggleTheme()">
        <i class="fas fa-moon"></i>
    </div>

    <div id="accountSetupModal" class="account-setup-modal">
        <div class="account-setup-content">
            <div class="account-setup-tabs">
                <div class="account-setup-tab active" data-tab="setup" onclick="switchSetupTab('setup')">Setup Account</div>
                <div class="account-setup-tab" data-tab="upload" onclick="switchSetupTab('upload')">Upload Account</div>
            </div>
            <div class="account-setup-body">
                <div class="account-setup-section" id="setupSection">
                    <div class="account-setup-input-group">
                        <label>Name</label>
                        <input type="text" id="accountName" placeholder="Enter your name">
                    </div>
                    <div class="account-setup-input-group">
                        <label>Secret Number</label>
                        <input type="password" id="secretNumber" placeholder="Enter a secret number">
                    </div>
                    <button class="account-setup-submit" onclick="setupAccount()">Setup Account</button>
                </div>
                <div class="account-setup-section" id="uploadSection" style="display:none;">
                    <div class="upload-box" id="uploadBox">
                        <div class="upload-icon"><i class="fas fa-file-upload"></i></div>
                        <div class="upload-text">Drop .json file here</div>
                    </div>
                    <div id="verifySection" style="display:none;">
                        <div class="account-setup-input-group">
                            <label>Verify Name</label>
                            <input type="text" id="verifyName" placeholder="Enter account name">
                        </div>
                        <div class="account-setup-input-group">
                            <label>Verify Secret Number</label>
                            <input type="password" id="verifySecret" placeholder="Enter secret number">
                        </div>
                        <button class="account-setup-submit" onclick="verifyAndLoadAccount()">Verify & Load</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="notification-container" id="notificationContainer"></div>

    <script>
        // Account Management
        let userData = {
            name: '',
            secretNumber: '',
            balance: 1000
        };

        let balance = 1000; // Always start at 1000

        // Caesar cipher functions
        function caesarEncrypt(text, shift = 4) {
            return text.split('').map(char => {
                if (char.match(/[a-z]/i)) {
                    const code = char.charCodeAt(0);
                    const isUpperCase = code >= 65 && code <= 90;
                    const base = isUpperCase ? 65 : 97;
                    return String.fromCharCode((code - base + shift) % 26 + base);
                }
                return char;
            }).join('');
        }

        function caesarDecrypt(text, shift = 4) {
            return caesarEncrypt(text, 26 - shift);
        }

        // Generate random data for obfuscation
        function generateRandomData() {
            const randomData = {
                metadata: {
                    lastAccess: new Date().toISOString(),
                    deviceId: Math.random().toString(36).substring(7),
                    sessionKey: Math.random().toString(36).substring(7)
                },
                statistics: {
                    gamesPlayed: Math.floor(Math.random() * 1000),
                    totalWagered: Math.floor(Math.random() * 10000),
                    maxWin: Math.floor(Math.random() * 1000)
                },
                security: {
                    accessLevel: Math.floor(Math.random() * 5),
                    verificationStatus: Math.random() > 0.5 ? 'verified' : 'pending',
                    lastPasswordChange: new Date(Date.now() - Math.random() * 10000000000).toISOString()
                }
            };
            return randomData;
        }

        // Generate random gibberish line
        function generateGibberishLine() {
            const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789!@#$%^&*()_+-=[]{}|;:,.<>?';
            let line = '';
            const length = 30 + Math.floor(Math.random() * 50); // Random length between 30-80 chars
            for (let i = 0; i < length; i++) {
                line += chars.charAt(Math.floor(Math.random() * chars.length));
            }
            return line;
        }

        // Function to insert random characters between each character
        function insertRandomChars(str) {
            const chars = '!@#$%^&*()_+-=[]{}|;:,.<>?abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ';
            let result = '';
            for (let i = 0; i < str.length; i++) {
                result += str[i];
                if (i < str.length - 1) {
                    result += chars.charAt(Math.floor(Math.random() * chars.length));
                }
            }
            return result;
        }

        // Function to generate trailing gibberish
        function generateTrailingGibberish() {
            const chars = '!@#$%^&()_+-=[]{}|;:,.<>?abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789';
            let result = '*'; // Start with separator
            const length = 10 + Math.floor(Math.random() * 6); // 10-15 characters
            for (let i = 0; i < length; i++) {
                result += chars.charAt(Math.floor(Math.random() * chars.length));
            }
            return result;
        }

        // Function to extract real characters from obfuscated string
        function extractRealChars(str) {
            // Split at * and take first part
            str = str.split('*')[0];
            let result = '';
            for (let i = 0; i < str.length; i += 2) {
                result += str[i];
            }
            return result;
        }

        // Encrypt user data for saving
        function encryptUserData(data) {
            let fileContent = '';
            // Add 10 lines of gibberish at the start
            for (let i = 0; i < 10; i++) {
                fileContent += generateGibberishLine() + '\n';
            }
            // Add the validation lines with obfuscated identifiers and trailing gibberish
            const encryptedName = caesarEncrypt(data.name);
            const encryptedSpecialNum = caesarEncrypt(data.secretNumber);
            const balanceStr = data.balance.toFixed(2);

            fileContent += `l5JXTIzNV+t3zeF$3AP&:${insertRandomChars(encryptedName)}${generateTrailingGibberish()}\n`;
            fileContent += `LI8rS7Hf&Q}mq42:${insertRandomChars(encryptedSpecialNum)}${generateTrailingGibberish()}\n`;
            fileContent += `(<s{Xo|!rnfyeBUe:${insertRandomChars(balanceStr)}${generateTrailingGibberish()}\n`;
            
            // Add 43 more lines of gibberish at the end
            for (let i = 0; i < 43; i++) {
                fileContent += generateGibberishLine() + '\n';
            }
            return fileContent;
        }

        // Decrypt user data from file
        function decryptUserData(data) {
            try {
                // Split into lines
                const lines = data.split('\n');
                if (lines.length < 13) return null;

                // Get the validation lines (11, 12, 13)
                const usernameLine = lines[10];
                const specialNumLine = lines[11];
                const balanceLine = lines[12];

                // Extract values using the obfuscated identifiers
                const obfuscatedUsername = usernameLine.split('l5JXTIzNV+t3zeF$3AP&:')[1];
                const obfuscatedSpecialNum = specialNumLine.split('LI8rS7Hf&Q}mq42:')[1];
                const obfuscatedBalance = balanceLine.split('(<s{Xo|!rnfyeBUe:')[1];

                // Extract real characters and remove trailing gibberish
                const username = extractRealChars(obfuscatedUsername);
                const specialNum = extractRealChars(obfuscatedSpecialNum);
                const balanceStr = extractRealChars(obfuscatedBalance);
                const balance = parseFloat(balanceStr);

                if (!username || !specialNum || isNaN(balance)) return null;

                return {
                    name: caesarDecrypt(username),
                    secretNumber: caesarDecrypt(specialNum),
                    balance: parseFloat(balance.toFixed(2))
                };
            } catch (e) {
                return null;
            }
        }

        // Switch setup tabs
        function switchSetupTab(tab) {
            document.querySelectorAll('.account-setup-tab').forEach(t => {
                t.classList.toggle('active', t.getAttribute('data-tab') === tab);
            });
            document.getElementById('setupSection').style.display = tab === 'setup' ? 'block' : 'none';
            document.getElementById('uploadSection').style.display = tab === 'upload' ? 'block' : 'none';
            document.getElementById('verifySection').style.display = 'none';
        }

        // Handle file upload
        let uploadedData = null;
        function setupFileUpload() {
            const uploadBox = document.getElementById('uploadBox');
            
            uploadBox.addEventListener('dragover', (e) => {
                e.preventDefault();
                uploadBox.classList.add('dragover');
            });

            uploadBox.addEventListener('dragleave', () => {
                uploadBox.classList.remove('dragover');
            });

            uploadBox.addEventListener('drop', (e) => {
                e.preventDefault();
                uploadBox.classList.remove('dragover');
                
                const file = e.dataTransfer.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = (e) => {
                        try {
                            uploadedData = e.target.result;
                            document.getElementById('verifySection').style.display = 'block';
                            showAccountNotification('File uploaded successfully. Please verify your details.');
                        } catch (error) {
                            showAccountNotification('Invalid file format', 'error');
                        }
                    };
                    reader.readAsText(file);
                } else {
                    showAccountNotification('Please upload a valid file', 'error');
                }
            });
        }

        // Verify and load account
        function verifyAndLoadAccount() {
            if (!uploadedData) {
                showAccountNotification('No file uploaded', 'error');
                return;
            }

            const verifyName = document.getElementById('verifyName').value.trim();
            const verifySecret = document.getElementById('verifySecret').value.trim();
            
            const decryptedData = decryptUserData(uploadedData);
            if (!decryptedData) {
                showAccountNotification('Invalid file format', 'error');
                return;
            }

            if (verifyName === decryptedData.name && verifySecret === decryptedData.secretNumber) {
                userData = decryptedData;
                balance = userData.balance;
                updateBalance();
                localStorage.setItem('userData', JSON.stringify(userData));
                document.getElementById('accountSetupModal').style.display = 'none';
                showWelcomeMessage(decryptedData.name);
                showAccountNotification('Account loaded successfully');
            } else {
                showAccountNotification('Invalid credentials', 'error');
            }
        }

        // Modify the download function to handle text content
        function downloadUserData() {
            const content = encryptUserData(userData);
            const blob = new Blob([content], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'user_data.txt';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }

        // Initialize on page load
        document.addEventListener('DOMContentLoaded', () => {
            balance = 1000; // Ensure balance starts at 1000
            updateBalance();
            checkUserData();
            setupFileUpload();
            // ... existing DOMContentLoaded code ...
        });

        let inventory = [];
        let selectedCrates = [];
        let selectedItems = [];
        let ctrlDown = false;
        let lastItemSelected = null;
        let gameActive = false; // Global state for tracking active games
        let crates = [
            // Car-themed crates, each with car items (name, image, value)
            {
                id: 1,
                name: "Economy Crate",
                price: 50,
                cars: [
                    { name: "Toyota Corolla", img: "https://cdn.pixabay.com/photo/2012/05/29/00/43/car-49278_1280.jpg", value: 100 },
                    { name: "Honda Civic", img: "https://cdn.pixabay.com/photo/2016/11/29/09/32/auto-1868726_1280.jpg", value: 120 },
                    { name: "Ford Fiesta", img: "https://cdn.pixabay.com/photo/2017/01/06/19/15/auto-1957037_1280.jpg", value: 110 }
                ]
            },
            {
                id: 2,
                name: "SUV Crate",
                price: 200,
                cars: [
                    { name: "Jeep Wrangler", img: "https://cdn.pixabay.com/photo/2016/11/29/09/32/auto-1868726_1280.jpg", value: 250 },
                    { name: "Toyota RAV4", img: "https://cdn.pixabay.com/photo/2017/01/06/19/15/auto-1957037_1280.jpg", value: 220 },
                    { name: "Honda CR-V", img: "https://cdn.pixabay.com/photo/2012/05/29/00/43/car-49278_1280.jpg", value: 230 }
                ]
            },
            {
                id: 3,
                name: "Luxury Crate",
                price: 1000,
                cars: [
                    { name: "BMW 7 Series", img: "https://cdn.pixabay.com/photo/2015/01/19/13/51/car-604019_1280.jpg", value: 1200 },
                    { name: "Mercedes S-Class", img: "https://cdn.pixabay.com/photo/2016/11/29/09/32/auto-1868726_1280.jpg", value: 1300 },
                    { name: "Audi A8", img: "https://cdn.pixabay.com/photo/2015/01/19/13/51/car-604019_1280.jpg", value: 1250 }
                ]
            },
            {
                id: 4,
                name: "Supercar Crate",
                price: 5000,
                cars: [
                    { name: "Ferrari 488", img: "https://cdn.pixabay.com/photo/2017/01/06/19/15/auto-1957037_1280.jpg", value: 6000 },
                    { name: "Lamborghini Aventador", img: "https://cdn.pixabay.com/photo/2015/01/19/13/51/car-604019_1280.jpg", value: 7000 },
                    { name: "McLaren 720S", img: "https://cdn.pixabay.com/photo/2012/05/29/00/43/car-49278_1280.jpg", value: 6500 }
                ]
            }
        ];

        // Item database for names, worth, and lore
        const itemDB = {};
        function getItemData(name, rarity) {
            if (!itemDB[name]) {
                // Generate random worth and lore
                let worth = 0;
                switch (rarity) {
                    case 'common': worth = Math.floor(Math.random() * 5) + 1; break;
                    case 'uncommon': worth = Math.floor(Math.random() * 10) + 6; break;
                    case 'rare': worth = Math.floor(Math.random() * 40) + 32; break;
                    case 'epic': worth = Math.floor(Math.random() * 80) + 72; break;
                    case 'legendary': worth = Math.floor(Math.random() * 200) + 180; break;
                    case 'mythical': worth = Math.floor(Math.random() * 400) + 370; break;
                    case 'divine': worth = Math.floor(Math.random() * 800) + 760; break;
                }
                const lores = [
                    "A mysterious artifact from a forgotten era.",
                    "Legends say this item brings fortune.",
                    "Once owned by a hero of old.",
                    "It shimmers with untold power.",
                    "A rare find for the lucky few.",
                    "Sought after by collectors everywhere.",
                    "Its true value is known only to a select few.",
                    "A symbol of prestige and luck."
                ];
                itemDB[name] = {
                    name,
                    rarity,
                    worth,
                    lore: lores[Math.floor(Math.random() * lores.length)]
                };
            }
            return itemDB[name];
        }

        let isTabTransitioning = false;
        let currentActiveTab = 'games'; // Start with games tab as default

        function showTab(tabId) {
            // If we're transitioning OR trying to switch to the current tab, do nothing
            if (isTabTransitioning || tabId === currentActiveTab) {
                return;
            }

            isTabTransitioning = true;

            // Close any active games first
            if (typeof minesGameActive !== 'undefined' && minesGameActive) {
                if (typeof endMinesGame === 'function') endMinesGame(false);
                if (typeof resetMinesUI === 'function') resetMinesUI();
            }
            if (document.getElementById('diceTab') && document.getElementById('diceTab').classList.contains('active')) {
                if (typeof closeDiceTab === 'function') closeDiceTab();
            }
            if (typeof crashGameActive !== 'undefined' && crashGameActive) {
                crashGameActive = false;
                if (typeof resetCrashUI === 'function') resetCrashUI();
            }
            if (typeof dragonTowerActive !== 'undefined' && dragonTowerActive) {
                dragonTowerActive = false;
                if (typeof resetDragonTowerUI === 'function') resetDragonTowerUI();
            }

            // Get all tabs
            const allTabs = document.querySelectorAll('.content-tab, .mines-tab, .dice-tab');
            
            // Handle current active tab
            const currentTab = document.getElementById(currentActiveTab);
            if (currentTab) {
                currentTab.classList.remove('active');
                currentTab.classList.add('leaving');
            }

            // Handle new tab
            const newTab = document.getElementById(tabId);
            if (newTab) {
                // Make sure it's displayed before we start animation
                newTab.style.display = 'block';
                // Force a reflow
                newTab.offsetHeight;
                newTab.classList.add('active');
            }

            // Wait for transition to complete before cleaning up
            setTimeout(() => {
                allTabs.forEach(tab => {
                    if (tab.id !== tabId) {
                        tab.style.display = 'none';
                        tab.classList.remove('leaving');
                    }
                });

                // Update current tab only after transition
                currentActiveTab = tabId;

                // Reset transition state
                isTabTransitioning = false;

                // Initialize specific tab content if needed
                if (tabId === 'coinflipTab') setupCoinflipTab();
                if (tabId === 'dragonTowerTab') setupDragonTowerTab();
                if (tabId === 'blackjackTab') setupBlackjackTab();
                if (tabId === 'suggestions') setupSuggestionsTab();
                if (tabId === 'kenoTab') {
                    renderKenoGrid();
                    updateKenoPayoutTable();
                    document.getElementById('kenoDrawBtn').onclick = kenoDraw;
                }
                if (tabId === 'slideTab') setupSlideTab();
            }, 400); // Match this to your CSS transition duration
        }

        function placeBet(side) {
            const betInput = document.getElementById('betAmount');
            let betAmount = parseInt(betInput.value, 10);
            if (isNaN(betAmount) || betAmount < 1) betAmount = 1;
            if (balance < betAmount) {
                alert('Not enough balance!');
                return;
            }
            const coin = document.getElementById('coin');
            const result = Math.random() < 0.5 ? 'heads' : 'tails';
            coin.style.transform = 'rotateY(360deg)';
            setTimeout(() => {
                coin.textContent = result === 'heads' ? 'H' : 'T';
                if (result === side) {
                    balance += betAmount;
                    alert('You won!');
                } else {
                    balance -= betAmount;
                    alert('You lost!');
                }
                updateBalance();
                coin.style.transform = 'rotateY(0deg)';
            }, 1000);
        }

        function updateBalance() {
            const balanceElement = document.querySelector('.balance-amount');
            const currentBalance = parseFloat(balanceElement.textContent.replace('$', ''));
            const targetBalance = Math.round(balance * 100) / 100;
            if (currentBalance === targetBalance) return;
            balanceElement.classList.remove('increasing', 'decreasing');
            balanceElement.classList.add(targetBalance > currentBalance ? 'increasing' : 'decreasing');
            const duration = 1500;
            const startTime = performance.now();
            const difference = targetBalance - currentBalance;
            function animate(currentTime) {
                const elapsed = currentTime - startTime;
                const progress = Math.min(elapsed / duration, 1);
                const easedProgress = 1 - Math.pow(1 - progress, 3);
                const currentValue = Math.floor((currentBalance + (difference * easedProgress)) * 100) / 100;
                balanceElement.textContent = `$${currentValue.toFixed(2)}`;
                if (progress < 1) {
                    requestAnimationFrame(animate);
                } else {
                    balanceElement.textContent = `$${targetBalance.toFixed(2)}`;
                    balanceElement.classList.remove('increasing', 'decreasing');
                }
            }
            requestAnimationFrame(animate);
        }

        function openCrate(crateId) {
            const crate = crates.find(c => c.id === crateId);
            if (!crate) return;
            if (balance < crate.price) {
                alert('Not enough balance!');
                return;
            }
            balance -= crate.price;
            updateBalance();
            // Add crate to inventory as unopened
            inventory.push({ type: 'crate', crateId: crate.id });
            updateInventory();
        }

        function updateInventory() {
            const container = document.getElementById('inventoryContainer');
            container.innerHTML = '';
            selectedCrates = selectedCrates.filter(idx => inventory[idx] && inventory[idx].type === 'crate');
            selectedItems = selectedItems.filter(idx => inventory[idx] && inventory[idx].type === 'item');
            // Inventory actions
            const actions = document.getElementById('inventory-actions');
            actions.innerHTML = '';
            actions.style.display = 'none';
            if (selectedCrates.length > 1) {
                const btn = document.createElement('button');
                btn.textContent = `Open Selected (${selectedCrates.length})`;
                btn.style.padding = '12px 32px';
                btn.style.fontSize = '16px';
                btn.style.background = '#3b82f6';
                btn.style.color = '#fff';
                btn.style.border = 'none';
                btn.style.borderRadius = '8px';
                btn.style.fontWeight = '700';
                btn.style.cursor = 'pointer';
                btn.onclick = () => openMultipleCrates();
                actions.appendChild(btn);
                actions.style.display = 'block';
            } else if (selectedItems.length > 0) {
                const btn = document.createElement('button');
                btn.textContent = `Sell Selected (${selectedItems.length})`;
                btn.style.padding = '12px 32px';
                btn.style.fontSize = '16px';
                btn.style.background = '#ff4d4f';
                btn.style.color = '#fff';
                btn.style.border = 'none';
                btn.style.borderRadius = '8px';
                btn.style.fontWeight = '700';
                btn.style.cursor = 'pointer';
                btn.onclick = () => sellMultipleItems();
                actions.appendChild(btn);
                actions.style.display = 'block';
            }
            // Split inventory into crates and items
            const cratesSection = document.createElement('div');
            cratesSection.className = 'inventory-section';
            const cratesTitle = document.createElement('div');
            cratesTitle.className = 'inventory-section-title';
            cratesTitle.textContent = 'Unopened Crates';
            cratesSection.appendChild(cratesTitle);
            const cratesGrid = document.createElement('div');
            cratesGrid.className = 'inventory-grid';
            inventory.forEach((inv, idx) => {
                if (inv.type === 'crate') {
                    const crate = crates.find(c => c.id === inv.crateId);
                    const crateDiv = document.createElement('div');
                    crateDiv.className = `inventory-crate`;
                    crateDiv.title = crate.name;
                    crateDiv.innerHTML = `<img src="${crate.cars[0].img}" alt="crate car" style="width:32px;height:32px;object-fit:cover;border-radius:6px;">`;
                    if (selectedCrates.includes(idx)) crateDiv.classList.add('selected');
                    crateDiv.onclick = (e) => {
                        if (ctrlDown) {
                            if (selectedCrates.includes(idx)) {
                                selectedCrates = selectedCrates.filter(i => i !== idx);
                            } else if (selectedCrates.length < maxCratesToOpen) {
                                selectedCrates.push(idx);
                            }
                            updateInventory();
                            e.stopPropagation();
                            return;
                        }
                        openInventoryCrate(idx);
                    };
                    cratesGrid.appendChild(crateDiv);
                }
            });
            if (cratesGrid.children.length === 0) {
                const empty = document.createElement('div');
                empty.style.color = '#aaa';
                empty.style.fontSize = '13px';
                empty.textContent = 'No unopened crates.';
                cratesGrid.appendChild(empty);
            }
            cratesSection.appendChild(cratesGrid);
            container.appendChild(cratesSection);

            const itemsSection = document.createElement('div');
            itemsSection.className = 'inventory-section';
            const itemsTitle = document.createElement('div');
            itemsTitle.className = 'inventory-section-title';
            itemsTitle.textContent = 'Cars';
            itemsSection.appendChild(itemsTitle);
            const itemsGrid = document.createElement('div');
            itemsGrid.className = 'inventory-grid';
            inventory.forEach((inv, idx) => {
                if (inv.type === 'item') {
                    const itemDiv = document.createElement('div');
                    itemDiv.className = `inventory-item-square`;
                    itemDiv.title = inv.name;
                    itemDiv.innerHTML = `<img src="${inv.img}" alt="car" style="width:28px;height:28px;object-fit:cover;border-radius:4px;">`;
                    if (selectedItems.includes(idx)) itemDiv.classList.add('selected');
                    itemDiv.onclick = (e) => {
                        if (e.shiftKey && lastItemSelected !== null) {
                            // Range select
                            let [start, end] = [lastItemSelected, idx].sort((a, b) => a - b);
                            selectedItems = [];
                            for (let i = start; i <= end; i++) {
                                if (inventory[i] && inventory[i].type === 'item') selectedItems.push(i);
                            }
                            updateInventory();
                            e.stopPropagation();
                            return;
                        } else if (ctrlDown) {
                            if (selectedItems.includes(idx)) {
                                selectedItems = selectedItems.filter(i => i !== idx);
                            } else {
                                selectedItems.push(idx);
                            }
                            lastItemSelected = idx;
                            updateInventory();
                            e.stopPropagation();
                            return;
                        }
                        lastItemSelected = idx;
                        showItemModal(idx);
                    };
                    itemsGrid.appendChild(itemDiv);
                }
            });
            if (itemsGrid.children.length === 0) {
                const empty = document.createElement('div');
                empty.style.color = '#aaa';
                empty.style.fontSize = '13px';
                empty.textContent = 'No cars yet.';
                itemsGrid.appendChild(empty);
            }
            itemsSection.appendChild(itemsGrid);
            container.appendChild(itemsSection);
        }

        // CSGO-style crate opening
        function openInventoryCrate(idx) {
            if (selectedCrates.length > 1) return; // Don't open single if multi-select
            const inv = inventory[idx];
            if (!inv || inv.type !== 'crate') return;
            const crate = crates.find(c => c.id === inv.crateId);
            if (!crate) return;

            // Build a pool of cars
            let pool = [];
            crate.cars.forEach(car => {
                for (let i = 0; i < 40; ++i) pool.push(car);
            });
            // Shuffle pool
            pool = pool.sort(() => Math.random() - 0.5);
            // Pick 40 items for the roll
            const rollItems = [];
            for (let i = 0; i < 40; ++i) {
                const it = pool[Math.floor(Math.random() * pool.length)];
                rollItems.push(it);
            }
            // Pick the winning car
            const winning = pool[Math.floor(Math.random() * pool.length)];
            rollItems[20] = winning;

            // Modal HTML
            const modal = document.createElement('div');
            modal.className = 'modal';
            modal.innerHTML = `
                <div class="modal-content">
                    <span class="modal-close" id="modalClose">&times;</span>
                    <div style="font-size:18px;font-weight:600;">Opening ${crate.name}</div>
                    <div class="rolling-strip">
                        <div class="rolling-items" id="rollingItems" style="will-change: transform;">
                            ${rollItems.map(it => `<div class='rolling-item' style='background:#222;'><img src='${it.img}' alt='car' style='width:32px;height:32px;object-fit:cover;border-radius:4px;'></div>`).join('')}
                        </div>
                        <div class="rolling-pointer"></div>
                    </div>
                    <div id="rollResult" style="font-size:16px;font-weight:500;margin-top:10px;"></div>
                </div>
            `;
            document.getElementById('modal-root').appendChild(modal);
            document.getElementById('modalClose').onclick = () => modal.remove();

            // Animate roll (smoother)
            setTimeout(() => {
                const rolling = modal.querySelector('#rollingItems');
                rolling.style.transition = 'transform 2.2s cubic-bezier(.22,.68,0,1.01)';
                rolling.style.transform = `translateX(-${(20-2)*60}px)`;
            }, 200);
            setTimeout(() => {
                // Show result
                modal.querySelector('#rollResult').innerHTML = `You got <img src='${winning.img}' alt='car' style='width:24px;height:24px;object-fit:cover;border-radius:3px;vertical-align:middle;margin-right:6px;'><b>${winning.name}</b>!`;
                // Replace crate in inventory with car item
                inventory.splice(idx, 1);
                inventory.splice(idx, 0, { type: 'item', name: winning.name, img: winning.img, value: winning.value });
                updateInventory();
                setTimeout(() => modal.remove(), 1800);
            }, 2400);
        }

        // Item modal
        function showItemModal(idx) {
            if (selectedItems.length > 0) return; // Don't open single if multi-select
            const inv = inventory[idx];
            if (!inv || inv.type !== 'item') return;
            let confirmSell = false;
            const modal = document.createElement('div');
            modal.className = 'modal';
            modal.innerHTML = `
                <div class="modal-content">
                    <span class="modal-close" id="modalClose">&times;</span>
                    <div class="item-modal-title">${inv.name}</div>
                    <div style="margin-bottom:10px;"><img src="${inv.img}" alt="car" style="width:120px;height:70px;object-fit:cover;border-radius:10px;"></div>
                    <div class="item-modal-worth">Worth: $${inv.value}</div>
                    <button class="item-modal-sell" id="sellBtn">Sell</button>
                </div>
            `;
            document.getElementById('modal-root').appendChild(modal);
            document.getElementById('modalClose').onclick = () => modal.remove();
            document.getElementById('sellBtn').onclick = () => {
                // Sell car
                balance += inv.value;
                inventory.splice(idx, 1);
                updateBalance();
                updateInventory();
                modal.remove();
            };
        }

        // Multi-open crates
        function openMultipleCrates() {
            if (selectedCrates.length < 2) return;
            if (selectedCrates.length > maxCratesToOpen) {
                alert(`You can only open up to ${maxCratesToOpen} crates at once.`);
                return;
            }
            // Show modal with multiple rolling strips
            const modal = document.createElement('div');
            modal.className = 'modal';
            let html = `<div class="modal-content" style="min-width:600px;min-height:320px;">
                <span class="modal-close" id="modalClose">&times;</span>
                <div style="font-size:18px;font-weight:600;margin-bottom:10px;">Opening ${selectedCrates.length} Crates</div>`;
            let rollData = [];
            // Layout: 2-2-1 for 5 crates, else flex
            if (selectedCrates.length === 5) {
                html += `<div style='display:flex;flex-direction:column;align-items:center;gap:10px;'>`;
                for (let row = 0; row < 2; row++) {
                    html += `<div style='display:flex;gap:18px;justify-content:center;'>`;
                    for (let i = row * 2; i < row * 2 + 2; i++) {
                        const idx = selectedCrates[i];
                        const inv = inventory[idx];
                        const crate = crates.find(c => c.id === inv.crateId);
                        const rarityOdds = {
                            common:    { common: 0.80, uncommon: 0.13, rare: 0.05, epic: 0.015, legendary: 0.004, mythical: 0.0008, divine: 0.0002 },
                            uncommon:  { common: 0.60, uncommon: 0.25, rare: 0.10, epic: 0.03, legendary: 0.015, mythical: 0.004, divine: 0.001 },
                            rare:      { common: 0.40, uncommon: 0.25, rare: 0.20, epic: 0.08, legendary: 0.04, mythical: 0.02, divine: 0.01 },
                            epic:      { common: 0.20, uncommon: 0.20, rare: 0.25, epic: 0.18, legendary: 0.10, mythical: 0.05, divine: 0.02 },
                            legendary: { common: 0.10, uncommon: 0.10, rare: 0.20, epic: 0.20, legendary: 0.20, mythical: 0.12, divine: 0.08 },
                            mythical:  { common: 0.05, uncommon: 0.08, rare: 0.15, epic: 0.20, legendary: 0.22, mythical: 0.18, divine: 0.12 },
                            divine:    { common: 0.01, uncommon: 0.04, rare: 0.10, epic: 0.15, legendary: 0.20, mythical: 0.25, divine: 0.25 }
                        };
                        const odds = rarityOdds[crate.rarity];
                        let pool = [];
                        Object.keys(odds).forEach(rar => {
                            const c = crates.find(c => c.rarity === rar);
                            if (c) {
                                c.items.forEach(name => {
                                    for (let i = 0; i < Math.floor(odds[rar]*100); ++i) pool.push({ name, rarity: rar });
                                });
                            }
                        });
                        pool = pool.sort(() => Math.random() - 0.5);
                        const rollItems = [];
                        for (let j = 0; j < 40; ++j) {
                            const it = pool[Math.floor(Math.random() * pool.length)];
                            rollItems.push(it);
                        }
                        const winning = pool[Math.floor(Math.random() * pool.length)];
                        rollItems[20] = winning;
                        rollData.push({rollItems, winning, crate, idx});
                        html += `<div style='display:flex;flex-direction:column;align-items:center;'><div style='font-size:13px;font-weight:600;margin-bottom:2px;'>${crate.name}</div><div class="rolling-strip"><div class="rolling-items" id="rollingItems${idx}" style="will-change: transform;">${rollItems.map(it => `<div class='rolling-item ${it.rarity}'>${it.name[0]}</div>`).join('')}</div><div class="rolling-pointer"></div></div><div id="rollResult${idx}" style="font-size:13px;font-weight:500;margin-top:4px;"></div></div>`;
                    }
                    html += `</div>`;
                }
                // Last row (centered)
                html += `<div style='display:flex;justify-content:center;'><div>`;
                const idx = selectedCrates[4];
                const inv = inventory[idx];
                const crate = crates.find(c => c.id === inv.crateId);
                const rarityOdds = {
                    common:    { common: 0.80, uncommon: 0.13, rare: 0.05, epic: 0.015, legendary: 0.004, mythical: 0.0008, divine: 0.0002 },
                    uncommon:  { common: 0.60, uncommon: 0.25, rare: 0.10, epic: 0.03, legendary: 0.015, mythical: 0.004, divine: 0.001 },
                    rare:      { common: 0.40, uncommon: 0.25, rare: 0.20, epic: 0.08, legendary: 0.04, mythical: 0.02, divine: 0.01 },
                    epic:      { common: 0.20, uncommon: 0.20, rare: 0.25, epic: 0.18, legendary: 0.10, mythical: 0.05, divine: 0.02 },
                    legendary: { common: 0.10, uncommon: 0.10, rare: 0.20, epic: 0.20, legendary: 0.20, mythical: 0.12, divine: 0.08 },
                    mythical:  { common: 0.05, uncommon: 0.08, rare: 0.15, epic: 0.20, legendary: 0.22, mythical: 0.18, divine: 0.12 },
                    divine:    { common: 0.01, uncommon: 0.04, rare: 0.10, epic: 0.15, legendary: 0.20, mythical: 0.25, divine: 0.25 }
                };
                const odds = rarityOdds[crate.rarity];
                let pool = [];
                Object.keys(odds).forEach(rar => {
                    const c = crates.find(c => c.rarity === rar);
                    if (c) {
                        c.items.forEach(name => {
                            for (let i = 0; i < Math.floor(odds[rar]*100); ++i) pool.push({ name, rarity: rar });
                        });
                    }
                });
                pool = pool.sort(() => Math.random() - 0.5);
                const rollItems = [];
                for (let j = 0; j < 40; ++j) {
                    const it = pool[Math.floor(Math.random() * pool.length)];
                    rollItems.push(it);
                }
                const winning = pool[Math.floor(Math.random() * pool.length)];
                rollItems[20] = winning;
                rollData.push({rollItems, winning, crate, idx});
                html += `<div style='display:flex;flex-direction:column;align-items:center;'><div style='font-size:13px;font-weight:600;margin-bottom:2px;'>${crate.name}</div><div class="rolling-strip"><div class="rolling-items" id="rollingItems${idx}" style="will-change: transform;">${rollItems.map(it => `<div class='rolling-item ${it.rarity}'>${it.name[0]}</div>`).join('')}</div><div class="rolling-pointer"></div></div><div id="rollResult${idx}" style="font-size:13px;font-weight:500;margin-top:4px;"></div></div>`;
                html += `</div></div></div>`;
            } else {
                html += `<div style='display:flex;gap:18px;justify-content:center;align-items:flex-end;'>`;
                selectedCrates.forEach(idx => {
                    const inv = inventory[idx];
                    const crate = crates.find(c => c.id === inv.crateId);
                    const rarityOdds = {
                        common:    { common: 0.80, uncommon: 0.13, rare: 0.05, epic: 0.015, legendary: 0.004, mythical: 0.0008, divine: 0.0002 },
                        uncommon:  { common: 0.60, uncommon: 0.25, rare: 0.10, epic: 0.03, legendary: 0.015, mythical: 0.004, divine: 0.001 },
                        rare:      { common: 0.40, uncommon: 0.25, rare: 0.20, epic: 0.08, legendary: 0.04, mythical: 0.02, divine: 0.01 },
                        epic:      { common: 0.20, uncommon: 0.20, rare: 0.25, epic: 0.18, legendary: 0.10, mythical: 0.05, divine: 0.02 },
                        legendary: { common: 0.10, uncommon: 0.10, rare: 0.20, epic: 0.20, legendary: 0.20, mythical: 0.12, divine: 0.08 },
                        mythical:  { common: 0.05, uncommon: 0.08, rare: 0.15, epic: 0.20, legendary: 0.22, mythical: 0.18, divine: 0.12 },
                        divine:    { common: 0.01, uncommon: 0.04, rare: 0.10, epic: 0.15, legendary: 0.20, mythical: 0.25, divine: 0.25 }
                    };
                    const odds = rarityOdds[crate.rarity];
                    let pool = [];
                    Object.keys(odds).forEach(rar => {
                        const c = crates.find(c => c.rarity === rar);
                        if (c) {
                            c.items.forEach(name => {
                                for (let i = 0; i < Math.floor(odds[rar]*100); ++i) pool.push({ name, rarity: rar });
                            });
                        }
                    });
                    pool = pool.sort(() => Math.random() - 0.5);
                    const rollItems = [];
                    for (let j = 0; j < 40; ++j) {
                        const it = pool[Math.floor(Math.random() * pool.length)];
                        rollItems.push(it);
                    }
                    const winning = pool[Math.floor(Math.random() * pool.length)];
                    rollItems[20] = winning;
                    rollData.push({rollItems, winning, crate, idx});
                    html += `<div style='display:flex;flex-direction:column;align-items:center;'><div style='font-size:13px;font-weight:600;margin-bottom:2px;'>${crate.name}</div><div class="rolling-strip"><div class="rolling-items" id="rollingItems${idx}" style="will-change: transform;">${rollItems.map(it => `<div class='rolling-item ${it.rarity}'>${it.name[0]}</div>`).join('')}</div><div class="rolling-pointer"></div></div><div id="rollResult${idx}" style="font-size:13px;font-weight:500;margin-top:4px;"></div></div>`;
                });
                html += '</div>';
            }
            html += '</div>';
            modal.innerHTML = html;
            document.getElementById('modal-root').appendChild(modal);
            document.getElementById('modalClose').onclick = () => modal.remove();
            // Animate all rolls
            setTimeout(() => {
                rollData.forEach((data, i) => {
                    const rolling = modal.querySelector(`#rollingItems${data.idx}`);
                    rolling.style.transition = 'transform 2.2s cubic-bezier(.22,.68,0,1.01)';
                    rolling.style.transform = `translateX(-${(20-2)*60}px)`;
                });
            }, 200);
            setTimeout(() => {
                rollData.forEach((data, i) => {
                    const d = getItemData(data.winning.name, data.winning.rarity);
                    modal.querySelector(`#rollResult${data.idx}`).innerHTML = `<span class='rolling-item ${data.winning.rarity}' style='width:24px;height:24px;font-size:13px;'>${data.winning.name[0]}</span> <b>${data.winning.name}</b>`;
                    inventory.splice(data.idx, 1, { type: 'item', name: d.name, rarity: d.rarity });
                });
                updateInventory();
                setTimeout(() => modal.remove(), 1800);
            }, 2400);
            selectedCrates = [];
        }

        // Multi-sell items
        function sellMultipleItems() {
            if (selectedItems.length === 0) return;
            // Gather items
            const items = selectedItems.map(idx => ({...inventory[idx], idx}));
            const hasHighValueItems = items.some(it => {
                const data = getItemData(it.name, it.rarity);
                return data.worth >= 1000;
            });
            if (hasHighValueItems) {
                // Show confirmation modal with 3 highest value items
                const sorted = items.sort((a,b) => {
                    const dataA = getItemData(a.name, a.rarity);
                    const dataB = getItemData(b.name, b.rarity);
                    return dataB.worth - dataA.worth;
                });
                const modal = document.createElement('div');
                modal.className = 'modal';
                modal.innerHTML = `<div class='modal-content' style='min-width:400px;'><span class='modal-close' id='modalClose'>&times;</span><div style='font-size:17px;font-weight:600;margin-bottom:10px;'>Confirm Sell</div><div style='font-size:14px;margin-bottom:8px;'>You are about to sell <b>${items.length}</b> items, including:</div><div style='display:flex;gap:10px;justify-content:center;margin-bottom:12px;'>${sorted.slice(0,3).map(it => `<div class='inventory-item-square ${it.rarity}' title='${it.name}'>${it.name[0]}</div>`).join('')}</div><div style='font-size:13px;color:#b00;margin-bottom:12px;'>Some items are worth $1000 or more. Are you sure?</div><button id='confirmSellBtn' style='padding:10px 24px;font-size:15px;background:#ff4d4f;color:#fff;border:none;border-radius:8px;font-weight:700;cursor:pointer;'>Sell All</button></div>`;
                document.getElementById('modal-root').appendChild(modal);
                document.getElementById('modalClose').onclick = () => modal.remove();
                document.getElementById('confirmSellBtn').onclick = () => {
                    doSellSelectedItems(items);
                    modal.remove();
                };
            } else {
                doSellSelectedItems(items);
            }
        }
        function doSellSelectedItems(items) {
            let total = 0;
            items.forEach(it => {
                const data = getItemData(it.name, it.rarity);
                total += data.worth;
            });
            // Remove from inventory
            items.sort((a,b) => b.idx - a.idx).forEach(it => inventory.splice(it.idx, 1));
            balance += total;
            updateBalance();
            selectedItems = [];
            updateInventory();
        }
        function rarityValue(r) {
            return ["common","uncommon","rare","epic","legendary","mythical","divine"].indexOf(r);
        }

        // Keyboard events for CTRL
        document.addEventListener('keydown', e => {
            if (e.key === 'Control') ctrlDown = true;
        });
        document.addEventListener('keyup', e => {
            if (e.key === 'Control') ctrlDown = false;
            updateInventory();
        });

        // Initialize crates
        document.addEventListener('DOMContentLoaded', () => {
            renderCrateShop();
            updateInventory();
        });

        // Dev menu functionality
        const DEV_PASSWORD = "hBqjahKwnwh_1";
        let maxCratesToOpen = 5;
        let isDevMenuUnlocked = false;

        function showPasswordModal() {
            if (isDevMenuUnlocked) {
                showDevMenu();
            } else {
                const modal = document.getElementById('passwordModal');
                modal.style.display = 'flex';
                // Trigger reflow
                modal.offsetHeight;
                modal.classList.add('showing');
            }
        }

        function hidePasswordModal() {
            const modal = document.getElementById('passwordModal');
            modal.classList.remove('showing');
            modal.classList.add('hiding');
            setTimeout(() => {
                modal.style.display = 'none';
                modal.classList.remove('hiding');
            }, 300);
        }

        function checkPassword() {
            const input = document.getElementById('passwordInput').value;
            if (input === DEV_PASSWORD) {
                isDevMenuUnlocked = true;
                hidePasswordModal();
                showDevMenu();
            } else {
                const error = document.getElementById('errorMessage');
                error.classList.add('show');
                setTimeout(() => error.classList.remove('show'), 3000);
            }
        }

        // Add click handler to close modal when clicking outside
        document.getElementById('passwordModal').addEventListener('click', (e) => {
            if (e.target === document.getElementById('passwordModal')) {
                hidePasswordModal();
            }
        });

        function showDevMenu() {
            const menu = document.getElementById('devMenu');
            const backdrop = document.getElementById('devMenuBackdrop');
            menu.style.display = 'block';
            backdrop.style.display = 'block';
            // Trigger reflow
            menu.offsetHeight;
            backdrop.offsetHeight;
            menu.classList.add('opening');
            backdrop.classList.add('showing');
            initializeDevMenu();
        }

        function closeDevMenu() {
            const menu = document.getElementById('devMenu');
            const backdrop = document.getElementById('devMenuBackdrop');
            menu.classList.remove('opening');
            menu.classList.add('closing');
            backdrop.classList.remove('showing');
            backdrop.classList.add('hiding');
            setTimeout(() => {
                menu.style.display = 'none';
                backdrop.style.display = 'none';
                menu.classList.remove('closing');
                backdrop.classList.remove('hiding');
            }, 300);
        }

        function initializeDevMenu() {
            // Initialize crate select
            const crateSelect = document.getElementById('crateSelect');
            crates.forEach(crate => {
                const option = document.createElement('option');
                option.value = crate.id;
                option.textContent = crate.name;
                crateSelect.appendChild(option);
            });

            // Initialize rarity select
            const raritySelect = document.getElementById('itemRarity');
            const crateRaritySelect = document.getElementById('crateRarity');
            const rarities = ['common', 'uncommon', 'rare', 'epic', 'legendary', 'mythical', 'divine'];
            rarities.forEach(rarity => {
                const option = document.createElement('option');
                option.value = rarity;
                option.textContent = rarity.charAt(0).toUpperCase() + rarity.slice(1);
                raritySelect.appendChild(option.cloneNode(true));
                crateRaritySelect.appendChild(option.cloneNode(true));
            });

            // Initialize inventory select
            updateInventorySelect();
        }

        function updateInventorySelect() {
            const select = document.getElementById('inventorySelect');
            select.innerHTML = '<option value="">Select an item</option>';
            inventory.forEach((item, index) => {
                if (item.type === 'item') {
                    const option = document.createElement('option');
                    option.value = index;
                    option.textContent = item.name;
                    select.appendChild(option);
                }
            });
        }

        function giveMoney() {
            const amount = parseInt(document.getElementById('moneyAmount').value);
            if (!isNaN(amount) && amount > 0) {
                balance += amount;
                updateBalance();
                document.getElementById('moneyAmount').value = '';
            }
        }

        function giveCrate() {
            const crateId = parseInt(document.getElementById('crateSelect').value);
            if (!isNaN(crateId)) {
                inventory.push({ type: 'crate', crateId });
                updateInventory();
                document.getElementById('crateSelect').value = '';
            }
        }

        function editItem() {
            const index = parseInt(document.getElementById('inventorySelect').value);
            const newName = document.getElementById('itemName').value;
            const newRarity = document.getElementById('itemRarity').value;
            const newWorth = parseInt(document.getElementById('itemWorth').value);

            if (!isNaN(index) && inventory[index] && inventory[index].type === 'item') {
                if (newName) inventory[index].name = newName;
                if (newRarity) inventory[index].rarity = newRarity;
                if (!isNaN(newWorth)) {
                    const data = getItemData(inventory[index].name, inventory[index].rarity);
                    data.worth = newWorth;
                }
                updateInventory();
                updateInventorySelect();
                // Clear inputs
                document.getElementById('itemName').value = '';
                document.getElementById('itemRarity').value = '';
                document.getElementById('itemWorth').value = '';
            }
        }

        function setCrateLimit() {
            const limit = parseInt(document.getElementById('crateLimit').value);
            if (!isNaN(limit) && limit > 0) {
                maxCratesToOpen = limit;
                document.getElementById('crateLimit').value = '';
            }
        }

        function addRarity() {
            const name = document.getElementById('newRarity').value.toLowerCase();
            const color = document.getElementById('rarityColor').value;
            const isRainbow = document.getElementById('rainbowRarity').checked;

            if (name && !['common', 'uncommon', 'rare', 'epic', 'legendary', 'mythical', 'divine'].includes(name)) {
                // Add to rarity list
                const container = document.getElementById('raritySortContainer');
                const item = document.createElement('div');
                item.className = 'rarity-item';
                item.draggable = true;
                if (isRainbow) {
                    item.classList.add('rainbow');
                } else {
                    item.style.backgroundColor = color;
                }
                item.textContent = name;
                container.appendChild(item);

                // Add to select options
                const option = document.createElement('option');
                option.value = name;
                option.textContent = name.charAt(0).toUpperCase() + name.slice(1);
                document.getElementById('itemRarity').appendChild(option.cloneNode(true));
                document.getElementById('crateRarity').appendChild(option.cloneNode(true));

                // Store custom rarity
                customRarities[name] = { color, rainbow: isRainbow };

                // Clear inputs
                document.getElementById('newRarity').value = '';
                document.getElementById('rarityColor').value = '#000000';
                document.getElementById('rainbowRarity').checked = false;
            }
        }

        function addCustomCrate() {
            const name = document.getElementById('crateName').value;
            const price = parseInt(document.getElementById('cratePrice').value);
            const rarity = document.getElementById('crateRarity').value;

            if (name && !isNaN(price) && rarity) {
                // Get all items of the selected rarity
                const items = [];
                crates.forEach(crate => {
                    if (crate.rarity === rarity) {
                        items.push(...crate.items);
                    }
                });

                if (items.length > 0) {
                    const newCrate = {
                        id: crates.length + 1,
                        name,
                        price,
                        rarity,
                        items: items.slice(0, 3) // Take first 3 items of that rarity
                    };
                    crates.push(newCrate);
                    // Sort crates by price
                    crates.sort((a, b) => a.price - b.price);

                    // Add to crate select
                    const option = document.createElement('option');
                    option.value = newCrate.id;
                    option.textContent = newCrate.name;
                    document.getElementById('crateSelect').appendChild(option);

                    // Add to crate shop (refresh the crate shop UI)
                    renderCrateShop();

                    // Clear inputs
                    document.getElementById('crateName').value = '';
                    document.getElementById('cratePrice').value = '';
                    document.getElementById('crateRarity').value = '';
                }
            }
        }

        // Helper to re-render the crate shop
        function renderCrateShop() {
            const cratesContainer = document.getElementById('cratesContainer');
            cratesContainer.innerHTML = '';
            // Sort crates by price
            const sortedCrates = [...crates].sort((a, b) => a.price - b.price);
            sortedCrates.forEach(crate => {
                const crateElement = document.createElement('div');
                crateElement.className = `crate`;
                crateElement.innerHTML = `
                    <div style="margin-bottom:10px;"><img src="${crate.cars[0].img}" alt="crate car" style="width:80px;height:48px;object-fit:cover;border-radius:8px;"></div>
                    <div class="rarity" style="background:#333;color:#fff;">${crate.name}</div>
                    <h3>${crate.name}</h3>
                    <p>${crate.price === 0 ? 'FREE' : `$${crate.price}`}</p>
                    <div class="sheen"></div>
                `;
                crateElement.addEventListener('click', () => openCrate(crate.id));
                cratesContainer.appendChild(crateElement);
            });
        }

        // Make rarity items sortable
        document.addEventListener('DOMContentLoaded', () => {
            const container = document.getElementById('raritySortContainer');
            if (container) {
                container.addEventListener('dragover', e => {
                    e.preventDefault();
                    const dragging = document.querySelector('.dragging');
                    const afterElement = getDragAfterElement(container, e.clientY);
                    if (afterElement) {
                        container.insertBefore(dragging, afterElement);
                    } else {
                        container.appendChild(dragging);
                    }
                });
            }
        });

        function getDragAfterElement(container, y) {
            const draggableElements = [...container.querySelectorAll('.rarity-item:not(.dragging)')];
            return draggableElements.reduce((closest, child) => {
                const box = child.getBoundingClientRect();
                const offset = y - box.top - box.height / 2;
                if (offset < 0 && offset > closest.offset) {
                    return { offset: offset, element: child };
                } else {
                    return closest;
                }
            }, { offset: Number.NEGATIVE_INFINITY }).element;
        }

        // Store custom rarities
        let customRarities = {};

        // Add click handler to close modal when clicking outside
        document.getElementById('devMenuBackdrop').addEventListener('click', (e) => {
            if (e.target === document.getElementById('devMenuBackdrop')) {
                closeDevMenu();
            }
        });

        // Theme toggle functionality
        function toggleTheme() {
            const body = document.body;
            const isDark = body.getAttribute('data-theme') === 'dark';
            const icon = document.querySelector('.theme-toggle i');
            
            if (isDark) {
                body.removeAttribute('data-theme');
                icon.classList.remove('fa-sun');
                icon.classList.add('fa-moon');
            } else {
                body.setAttribute('data-theme', 'dark');
                icon.classList.remove('fa-moon');
                icon.classList.add('fa-sun');
            }
        }

        // Game modal logic
        const gameData = {
            mines: {
                icon: '<i class="fas fa-gem"></i>',
                name: 'Mines',
                desc: 'A grid-based game where you click tiles to reveal gems while avoiding hidden mines. The more gems you uncover without hitting a mine, the higher your payout.'
            },
            dice: {
                icon: '<i class="fas fa-dice"></i>',
                name: 'Dice',
                desc: 'Roll the dice and win if your number is higher or lower than the target. Choose your risk level for bigger potential payouts.'
            },
            crash: {
                icon: '<i class="fas fa-rocket"></i>',
                name: 'Crash',
                desc: 'A multiplier increases over time, and you must cash out before it "crashes." The longer you wait, the higher the potential rewardbut if it crashes first, you lose.'
            },
            coinflip: {
                icon: '<i class="fas fa-coins"></i>',
                name: 'Coinflip',
                desc: 'A simple 50/50 game where you bet on either heads or tails. Win if your chosen side lands face up.'
            },
            dragonTower: {
                icon: '<i class="fas fa-dragon"></i>',
                name: 'Dragon Tower',
                desc: 'A level-based game where you choose between safe tiles to climb a tower. Each correct pick increases your payout, but hitting a trap ends the game.'
            },
            blackjack: {
                icon: '<i class="fas fa-clone"></i>',
                name: 'Blackjack',
                desc: 'A card game where you try to get as close to 21 as possible without going over, while beating the dealer\'s hand.'
            },
            keno: {
                icon: '<i class="fas fa-th"></i>',
                name: 'Keno',
                desc: 'You choose between 1 and 10 numbers on a grid of 40. After your selection, 10 numbers are randomly drawn. The more of your picks that match the drawn numbers, the higher your payout. Choosing fewer numbers offers safer, lower payouts, while more picks give riskier, high-reward potential.'
            },
            slide: {
                icon: '<i class="fas fa-sliders-h"></i>',
                name: 'Slide',
                desc: 'Place up to five bets with their own target multipliers, wait for the slide to roll and watch as prosperity passes by, tile by tile until you land on the big win.'
            }
        };

        function showGameModal(game) {
            const data = gameData[game];
            if (!data) return;
            const modalRoot = document.getElementById('gameModalRoot');
            modalRoot.innerHTML = '';
            const backdrop = document.createElement('div');
            backdrop.className = 'game-modal-backdrop';
            backdrop.innerHTML = `
                <div class="game-modal-content">
                    <span class="game-modal-close" id="gameModalClose">&times;</span>
                    <div class="game-modal-icon">${data.icon}</div>
                    <div class="game-modal-title">${data.name}</div>
                    <div class="game-modal-desc">${data.desc}</div>
                    <button class="game-modal-play" id="gameModalPlayBtn">Play</button>
                </div>
            `;
            modalRoot.appendChild(backdrop);
            setTimeout(() => backdrop.classList.add('showing'), 10);
            backdrop.querySelector('#gameModalClose').onclick = () => {
                backdrop.classList.remove('showing');
                setTimeout(() => modalRoot.innerHTML = '', 300);
            };
            backdrop.onclick = (e) => {
                if (e.target === backdrop) {
                    backdrop.classList.remove('showing');
                    setTimeout(() => modalRoot.innerHTML = '', 300);
                }
            };
            // Play button logic
            if (game === 'mines') {
                backdrop.querySelector('#gameModalPlayBtn').onclick = () => {
                    backdrop.classList.remove('showing');
                    setTimeout(() => {
                        modalRoot.innerHTML = '';
                        showMinesTab();
                    }, 300);
                };
            } else if (game === 'dice') {
                backdrop.querySelector('#gameModalPlayBtn').onclick = () => {
                    backdrop.classList.remove('showing');
                    setTimeout(() => {
                        modalRoot.innerHTML = '';
                        showDiceTab();
                    }, 300);
                };
            } else if (game === 'crash') {
                backdrop.querySelector('#gameModalPlayBtn').onclick = () => {
                    backdrop.classList.remove('showing');
                    setTimeout(() => {
                        modalRoot.innerHTML = '';
                        showCrashTab();
                    }, 300);
                };
            } else if (game === 'dragonTower') {
                backdrop.querySelector('#gameModalPlayBtn').onclick = () => {
                    backdrop.classList.remove('showing');
                    setTimeout(() => {
                        modalRoot.innerHTML = '';
                        showTab('dragonTowerTab');
                    }, 300);
                };
            } else if (game === 'coinflip') {
                backdrop.querySelector('#gameModalPlayBtn').onclick = () => {
                    backdrop.classList.remove('showing');
                    setTimeout(() => {
                        modalRoot.innerHTML = '';
                        showTab('coinflipTab');
                    }, 300);
                };
            } else if (game === 'blackjack') {
                backdrop.querySelector('#gameModalPlayBtn').onclick = () => {
                    backdrop.classList.remove('showing');
                    setTimeout(() => {
                        modalRoot.innerHTML = '';
                        showTab('blackjackTab');
                    }, 300);
                };
            } else if (game === 'keno') {
                backdrop.querySelector('#gameModalPlayBtn').onclick = () => {
                    backdrop.classList.remove('showing');
                    setTimeout(() => {
                        modalRoot.innerHTML = '';
                        showTab('kenoTab');
                    }, 300);
                };
            } else if (game === 'slide') {
                backdrop.querySelector('#gameModalPlayBtn').onclick = () => {
                    backdrop.classList.remove('showing');
                    setTimeout(() => {
                        modalRoot.innerHTML = '';
                        showTab('slideTab');
                    }, 300);
                };
            }
        }

        // --- MINES GAME LOGIC ---
        let minesMode = 'manual';
        let minesGameActive = false;
        let minesTiles = [];
        let minesMineIndexes = [];
        let minesRevealed = [];
        let minesCount = 3;
        let minesBet = 1.00;
        let minesAutoTiles = 1;
        let minesAutoCashout = false;
        function setMinesMode(mode) {
            if (minesGameActive) return;
            minesMode = mode;
            document.getElementById('minesManualBtn').classList.toggle('active', mode === 'manual');
            document.getElementById('minesAutoBtn').classList.toggle('active', mode === 'auto');
            document.getElementById('minesAutoControls').style.display = mode === 'auto' ? '' : 'none';
            document.getElementById('minesBetBtn').textContent = mode === 'auto' ? 'Auto Bet' : 'Bet';
        }
        function quickBet(type) {
            if (minesGameActive) return;
            const input = document.getElementById('minesBetAmount');
            let val = parseFloat(input.value) || 0;
            if (type === 'half') val = Math.max(0.01, val / 2);
            if (type === 'double') val = val * 2;
            input.value = val.toFixed(2);
        }
        function populateMinesCount() {
            const select = document.getElementById('minesCount');
            select.innerHTML = '';
            for (let i = 1; i <= 24; i++) {
                const opt = document.createElement('option');
                opt.value = i;
                opt.textContent = i;
                select.appendChild(opt);
            }
        }
        function renderMinesGrid() {
            const grid = document.getElementById('minesGrid');
            grid.innerHTML = '';
            minesTiles = [];
            for (let i = 0; i < 25; i++) {
                const tile = document.createElement('div');
                tile.className = 'mines-tile';
                tile.textContent = '';
                tile.onclick = () => onMinesTileClick(i);
                minesTiles.push(tile);
                grid.appendChild(tile);
            }
        }
        function showMinesTab() {
            // Hide all tabs
            document.querySelectorAll('.content-tab, .mines-tab').forEach(tab => {
                tab.classList.remove('active');
                tab.classList.remove('leaving');
                tab.style.display = 'none';
            });
            const minesTab = document.getElementById('minesTab');
            minesTab.style.display = 'flex';
            // Trigger reflow
            minesTab.offsetHeight;
            minesTab.classList.add('active');
            resetMinesUI();
        }
        function closeMinesTab() {
            const minesTab = document.getElementById('minesTab');
            minesTab.classList.remove('active');
            minesTab.classList.add('leaving');
            
            // Show games tab with transition
            const gamesTab = document.getElementById('games');
            gamesTab.style.display = 'block';
            // Trigger reflow
            gamesTab.offsetHeight;
            gamesTab.classList.add('active');
            
            setTimeout(() => {
                minesTab.classList.remove('leaving');
                minesTab.style.display = 'none';
                currentActiveTab = 'games';
            }, 400);
        }
        function startMinesGame() {
            if (minesGameActive) return;
            // Get values
            minesCount = parseInt(document.getElementById('minesCount').value);
            minesBet = parseFloat(document.getElementById('minesBetAmount').value);
            minesAutoTiles = parseInt(document.getElementById('minesAutoTiles')?.value || 1);
            minesAutoCashout = document.getElementById('minesAutoCashout')?.checked;
            if (isNaN(minesCount) || isNaN(minesBet) || minesBet <= 0) return;
            if (balance < minesBet) {
                showNotification('Not enough balance!');
                return;
            }
            balance -= minesBet;
            updateBalance();
            minesGameActive = true;
            gameActive = true; // Set global game active state
            minesRevealed = [];
            // Place mines
            minesMineIndexes = [];
            let pool = Array.from({length: 25}, (_, i) => i);
            for (let i = 0; i < minesCount; i++) {
                const idx = Math.floor(Math.random() * pool.length);
                minesMineIndexes.push(pool[idx]);
                pool.splice(idx, 1);
            }
            // Reset grid
            minesTiles.forEach(tile => {
                tile.className = 'mines-tile';
                tile.textContent = '';
                tile.style.pointerEvents = '';
            });
            updateMinesDevHighlights();
            // Disable controls
            document.getElementById('minesBetAmount').disabled = true;
            document.getElementById('minesCount').disabled = true;
            document.getElementById('minesManualBtn').disabled = true;
            document.getElementById('minesAutoBtn').disabled = true;
            document.getElementById('minesBetBtn').textContent = 'Cashout';
            document.getElementById('minesBetBtn').onclick = cashoutMinesGame;
            if (minesMode === 'auto') {
                autoMinesPlay();
            }
            // Add bet tracking
            gameStats.mines.played++;
            gameStats.mines.totalBet += minesBet;
            localStorage.setItem('gameStats', JSON.stringify(gameStats));
        }
        function onMinesTileClick(idx) {
            if (!minesGameActive) return;
            if (minesRevealed.includes(idx)) return;
            
            const tile = minesTiles[idx];
            tile.classList.add('clicking');
            
            // Wait for animation before revealing
            setTimeout(() => {
                if (minesMineIndexes.includes(idx)) {
                    // Hit a mine
                    tile.className = 'mines-tile revealed';
                    tile.innerHTML = '<i class="fas fa-bomb" style="animation: fadeIn 0.2s;"></i>';
                    endMinesGame(false);
                } else {
                    tile.className = 'mines-tile revealed';
                    tile.innerHTML = '<i class="fas fa-gem" style="animation: fadeIn 0.2s;"></i>';
                    minesRevealed.push(idx);
                }
            }, 200); // Half of the animation duration
        }
        function cashoutMinesGame() {
            if (!minesGameActive) return;
            // Multiplier: use combinatorial formula for fair payout
            let safeTiles = minesRevealed.length;
            let m = minesCount;
            let multiplier = 1;
            for (let i = 0; i < safeTiles; i++) {
                multiplier *= (25 - m - i) / (25 - i);
            }
            multiplier = multiplier > 0 ? (1 / multiplier) : 0;
            let payout = minesBet * multiplier;
            payout = Math.round(payout * 100) / 100;
            if (safeTiles === 0) payout = 0;
            showNotification(`You cashed out! Payout: $${payout}`);
            balance += payout;
            updateBalance();
            endMinesGame(true);
            // Add win tracking
            gameStats.mines.won++;
            gameStats.mines.totalWon += Math.round(minesBet * multiplier * 100) / 100;
            localStorage.setItem('gameStats', JSON.stringify(gameStats));
        }
        function endMinesGame(won) {
            minesGameActive = false;
            gameActive = false; // Reset global game active state
            // Reveal all mines
            minesMineIndexes.forEach(idx => {
                if (!minesRevealed.includes(idx)) {
                    minesTiles[idx].className = 'mines-tile revealed';
                    minesTiles[idx].innerHTML = '<i class="fas fa-bomb" style="animation: fadeIn 0.2s;"></i>';
                }
            });
            // Enable controls
            document.getElementById('minesBetAmount').disabled = false;
            document.getElementById('minesCount').disabled = false;
            document.getElementById('minesManualBtn').disabled = false;
            document.getElementById('minesAutoBtn').disabled = false;
            document.getElementById('minesBetBtn').textContent = minesMode === 'auto' ? 'Auto Bet' : 'Bet';
            document.getElementById('minesBetBtn').onclick = startMinesGame;
            if (!won) showNotification('You hit a mine!');
            updateMinesDevHighlights();
        }
        function resetMinesUI() {
            minesGameActive = false;
            minesRevealed = [];
            minesMineIndexes = [];
            document.getElementById('minesBetAmount').disabled = false;
            document.getElementById('minesCount').disabled = false;
            document.getElementById('minesManualBtn').disabled = false;
            document.getElementById('minesAutoBtn').disabled = false;
            document.getElementById('minesBetBtn').textContent = minesMode === 'auto' ? 'Auto Bet' : 'Bet';
            document.getElementById('minesBetBtn').onclick = startMinesGame;
            renderMinesGrid();
        }
        // Auto mode logic (basic random tile picks)
        function autoMinesPlay() {
            let picks = Math.min(minesAutoTiles, 25 - minesCount);
            let available = Array.from({length: 25}, (_, i) => i).filter(i => !minesRevealed.includes(i));
            let autoStep = 0;
            function pickNext() {
                if (!minesGameActive || autoStep >= picks) {
                    if (minesAutoCashout) {
                        cashoutMinesGame();
                    }
                    return;
                }
                let idx = available[Math.floor(Math.random() * available.length)];
                available = available.filter(i => i !== idx);
                setTimeout(() => {
                    if (!minesGameActive) return;
                    onMinesTileClick(idx);
                    autoStep++;
                    if (minesGameActive && autoStep < picks) pickNext();
                    else if (minesGameActive && minesAutoCashout) cashoutMinesGame();
                }, 400);
            }
            pickNext();
        }
        function showGameModal(game) {
            const data = gameData[game];
            if (!data) return;
            const modalRoot = document.getElementById('gameModalRoot');
            modalRoot.innerHTML = '';
            const backdrop = document.createElement('div');
            backdrop.className = 'game-modal-backdrop';
            backdrop.innerHTML = `
                <div class="game-modal-content">
                    <span class="game-modal-close" id="gameModalClose">&times;</span>
                    <div class="game-modal-icon">${data.icon}</div>
                    <div class="game-modal-title">${data.name}</div>
                    <div class="game-modal-desc">${data.desc}</div>
                    <button class="game-modal-play" id="gameModalPlayBtn">Play</button>
                </div>
            `;
            modalRoot.appendChild(backdrop);
            setTimeout(() => backdrop.classList.add('showing'), 10);
            backdrop.querySelector('#gameModalClose').onclick = () => {
                backdrop.classList.remove('showing');
                setTimeout(() => modalRoot.innerHTML = '', 300);
            };
            backdrop.onclick = (e) => {
                if (e.target === backdrop) {
                    backdrop.classList.remove('showing');
                    setTimeout(() => modalRoot.innerHTML = '', 300);
                }
            };
            // Play button logic
            if (game === 'mines') {
                backdrop.querySelector('#gameModalPlayBtn').onclick = () => {
                    backdrop.classList.remove('showing');
                    setTimeout(() => {
                        modalRoot.innerHTML = '';
                        showMinesTab();
                    }, 300);
                };
            } else if (game === 'dice') {
                backdrop.querySelector('#gameModalPlayBtn').onclick = () => {
                    backdrop.classList.remove('showing');
                    setTimeout(() => {
                        modalRoot.innerHTML = '';
                        showDiceTab();
                    }, 300);
                };
            } else if (game === 'crash') {
                backdrop.querySelector('#gameModalPlayBtn').onclick = () => {
                    backdrop.classList.remove('showing');
                    setTimeout(() => {
                        modalRoot.innerHTML = '';
                        showCrashTab();
                    }, 300);
                };
            } else if (game === 'dragonTower') {
                backdrop.querySelector('#gameModalPlayBtn').onclick = () => {
                    backdrop.classList.remove('showing');
                    setTimeout(() => {
                        modalRoot.innerHTML = '';
                        showTab('dragonTowerTab');
                    }, 300);
                };
            } else if (game === 'coinflip') {
                backdrop.querySelector('#gameModalPlayBtn').onclick = () => {
                    backdrop.classList.remove('showing');
                    setTimeout(() => {
                        modalRoot.innerHTML = '';
                        showTab('coinflipTab');
                    }, 300);
                };
            } else if (game === 'blackjack') {
                backdrop.querySelector('#gameModalPlayBtn').onclick = () => {
                    backdrop.classList.remove('showing');
                    setTimeout(() => {
                        modalRoot.innerHTML = '';
                        showTab('blackjackTab');
                    }, 300);
                };
            } else if (game === 'keno') {
                backdrop.querySelector('#gameModalPlayBtn').onclick = () => {
                    backdrop.classList.remove('showing');
                    setTimeout(() => {
                        modalRoot.innerHTML = '';
                        showTab('kenoTab');
                    }, 300);
                };
            } else if (game === 'slide') {
                backdrop.querySelector('#gameModalPlayBtn').onclick = () => {
                    backdrop.classList.remove('showing');
                    setTimeout(() => {
                        modalRoot.innerHTML = '';
                        showTab('slideTab');
                    }, 300);
                };
            }
        }
        document.addEventListener('DOMContentLoaded', () => {
            populateMinesCount();
            renderMinesGrid();
        });

        // --- Notification System ---
        let notificationId = 0;
        function showNotification(message, duration = 3500) {
            let root = document.getElementById('notification-root');
            if (!root) {
                root = document.createElement('div');
                root.id = 'notification-root';
                document.body.appendChild(root);
            }
            const notif = document.createElement('div');
            notif.className = 'notification';
            const thisId = ++notificationId;
            notif.dataset.id = thisId;
            notif.innerHTML = `<span>${message}</span><div class='notification-timer'><div class='notification-timer-bar'></div></div>`;
            root.appendChild(notif);
            setTimeout(() => notif.classList.add('show'), 10);
            // Animate timer bar
            const bar = notif.querySelector('.notification-timer-bar');
            bar.style.width = '100%';
            setTimeout(() => {
                bar.style.transition = `width ${duration}ms linear`;
                bar.style.width = '0%';
            }, 50);
            // Hide after duration
            setTimeout(() => {
                notif.classList.remove('show');
                setTimeout(() => {
                    if (notif.parentNode) notif.parentNode.removeChild(notif);
                }, 400);
            }, duration);
        }

        // --- Dev Show Mines Toggle ---
        let showMinesDev = false;
        function toggleShowMinesDev() {
            showMinesDev = !showMinesDev;
            const btn = document.getElementById('showMinesDevBtn');
            btn.textContent = showMinesDev ? 'Hide Mines (Dev)' : 'Show Mines (Dev)';
            updateMinesDevHighlights();
        }
        function updateMinesDevHighlights() {
            if (!minesGameActive || !showMinesDev) {
                if (minesTiles && minesTiles.length) {
                    minesTiles.forEach(tile => {
                        tile.classList.remove('dev-mine', 'dev-safe');
                    });
                }
                return;
            }
            for (let i = 0; i < 25; i++) {
                if (minesMineIndexes.includes(i)) {
                    minesTiles[i].classList.add('dev-mine');
                    minesTiles[i].classList.remove('dev-safe');
                } else {
                    minesTiles[i].classList.add('dev-safe');
                    minesTiles[i].classList.remove('dev-mine');
                }
            }
        }

        function showDiceTab() {
            // Hide all tabs
            document.querySelectorAll('.content-tab, .mines-tab, .dice-tab').forEach(tab => {
                tab.classList.remove('active');
                tab.classList.remove('leaving');
                tab.style.display = 'none';
            });
            const diceTab = document.getElementById('diceTab');
            diceTab.style.display = 'flex';
            // Trigger reflow
            diceTab.offsetHeight;
            diceTab.classList.add('active');
            currentActiveTab = 'diceTab';
            initializeDiceGame();
        }

        function closeDiceTab() {
            const diceTab = document.getElementById('diceTab');
            diceTab.classList.remove('active');
            diceTab.classList.add('leaving');
            
            // Show games tab with transition
            const gamesTab = document.getElementById('games');
            gamesTab.style.display = 'block';
            // Trigger reflow
            gamesTab.offsetHeight;
            gamesTab.classList.add('active');
            
            setTimeout(() => {
                diceTab.classList.remove('leaving');
                diceTab.style.display = 'none';
                currentActiveTab = 'games';
            }, 400);
        }

        let isAutoBetting = false;
        let profitTarget = 100;
        let initialBalance = 0;
        let hasPlacedFirstBet = false;
        let isFlipped = false;

        function initializeDiceGame() {
            const sliderHandle = document.getElementById('diceSliderHandle');
            const sliderTrack = document.querySelector('.dice-slider-track');
            const sliderBar = document.getElementById('diceSliderBar');
            const sliderInput = document.getElementById('diceSliderInput');
            const betInput = document.getElementById('diceBetAmount');
            const rollBtn = document.getElementById('diceRollButton');
            const resultDisplay = document.getElementById('diceResult');
            const winChanceInput = document.getElementById('diceWinChanceInput');
            const multiplierInput = document.getElementById('diceMultiplierInput');

            function updateSlider(value) {
                winChance = Math.max(0, Math.min(100, value));
                const percent = winChance;
                sliderHandle.style.left = `${percent}%`;
                sliderInput.value = percent;
                // Smooth fade between green and red, and flip if needed
                let grad;
                grad = `linear-gradient(90deg, #19e05c 0%, #19e05c ${percent}%, #ff4444 ${percent}%, #ff4444 100%)`;
                // Add smooth fade at the split
                let fadeWidth = 4; // percent width for fade
                let fadeStart = Math.max(0, percent - fadeWidth/2);
                let fadeEnd = Math.min(100, percent + fadeWidth/2);
                grad = `linear-gradient(90deg, #19e05c 0%, #19e05c ${fadeStart}%, #19e05c00 ${fadeStart}%, #ff444400 ${fadeEnd}%, #ff4444 ${fadeEnd}%, #ff4444 100%)`;
                sliderBar.style.background = grad;
                // Update triangle position
                const triangle = document.querySelector('.dice-slider-triangle');
                if (triangle) {
                    triangle.style.left = `${percent}%`;
                }
                // Update editable fields
                winChanceInput.value = winChance.toFixed(2);
                multiplierInput.value = (winChance > 0 ? (100 / winChance) : 0).toFixed(2);
            }
            // Editable Win Chance/Multiplier logic
            winChanceInput.addEventListener('input', (e) => {
                let val = parseFloat(e.target.value);
                if (isNaN(val) || val <= 0) val = 0.01;
                if (val > 99.99) val = 99.99;
                updateSlider(val);
            });
            multiplierInput.addEventListener('input', (e) => {
                let val = parseFloat(e.target.value);
                if (isNaN(val) || val <= 0) val = 1.01;
                if (val > 100) val = 100;
                let newWinChance = 100 / val;
                if (newWinChance > 99.99) newWinChance = 99.99;
                if (newWinChance < 0.01) newWinChance = 0.01;
                updateSlider(newWinChance);
            });
            
            rollBtn.addEventListener('click', () => {
                if (diceRollButton.disabled) return;
                const betAmount = parseFloat(betInput.value);
                if (isNaN(betAmount) || betAmount <= 0) {
                    showNotification('Please enter a valid bet amount', 'error');
                    return;
                }
                if (betAmount > balance) {
                    showNotification('Insufficient balance', 'error');
                    return;
                }
                rollDice();
                hasPlacedFirstBet = true;
                diceSliderTriangle.style.opacity = '1';
            });
            
            updateSlider(50);

            const diceRollButton = document.getElementById('diceRollButton');
            const diceAutoBetButton = document.getElementById('diceAutoBetButton');
            const diceProfitTarget = document.getElementById('diceProfitTarget');
            const diceSliderTriangle = document.querySelector('.dice-slider-triangle');

            diceProfitTarget.addEventListener('change', (e) => {
                profitTarget = Math.max(1, parseInt(e.target.value) || 100);
            });

            diceAutoBetButton.addEventListener('click', () => {
                if (!isAutoBetting) {
                    isAutoBetting = true;
                    diceAutoBetButton.textContent = 'Stop Auto-Bet';
                    diceAutoBetButton.classList.add('active');
                    initialBalance = balance;
                    performAutoBet();
                } else {
                    isAutoBetting = false;
                    diceAutoBetButton.textContent = 'Auto-Bet';
                    diceAutoBetButton.classList.remove('active');
                }
            });

            function performAutoBet() {
                if (!isAutoBetting) return;
                
                const currentProfit = balance - initialBalance;
                if (currentProfit >= profitTarget) {
                    isAutoBetting = false;
                    diceAutoBetButton.textContent = 'Auto-Bet';
                    diceAutoBetButton.classList.remove('active');
                    showNotification('Profit target reached!', 'success');
                    return;
                }

                if (balance <= 0) {
                    isAutoBetting = false;
                    diceAutoBetButton.textContent = 'Auto-Bet';
                    diceAutoBetButton.classList.remove('active');
                    showNotification('Insufficient balance for auto-betting', 'error');
                    return;
                }

                // Emulate clicking the Bet button
                if (!diceRollButton.disabled) {
                    diceRollButton.click();
                }

                // Schedule next bet after downtime
                setTimeout(performAutoBet, 500);
            }

            diceRollButton.addEventListener('click', () => {
                if (diceRollButton.disabled) return;
                
                const betAmount = parseInt(diceBetInput.value);
                if (isNaN(betAmount) || betAmount <= 0) {
                    showNotification('Please enter a valid bet amount', 'error');
                    return;
                }

                if (betAmount > balance) {
                    showNotification('Insufficient balance', 'error');
                    return;
                }

                rollDice();
                hasPlacedFirstBet = true;
                diceSliderTriangle.style.opacity = '1';
            });

            function rollDice() {
                // Deduct bet amount from balance before rolling
                const bet = parseFloat(betInput.value) || 0;
                balance -= bet;
                updateBalance();

                // Roll logic
                const rollResult = Math.random() * 100;
                const trianglePosition = (rollResult / 100) * (sliderTrack.offsetWidth - 16);
                diceSliderTriangle.style.left = `${trianglePosition}px`;
                if (hasPlacedFirstBet) {
                    diceSliderTriangle.style.opacity = '1';
                }
                // Win if rollResult <= winChance (green area)
                let isWin = rollResult <= winChance;
                const multiplier = winChance > 0 ? (100 / winChance) : 0;
                const payout = isWin ? bet * multiplier : 0;
                setTimeout(() => {
                    resultDisplay.textContent = rollResult.toFixed(2);
                    resultDisplay.classList.remove('win', 'lose');
                    resultDisplay.classList.add('show');
                    if (isWin) {
                        resultDisplay.classList.add('win');
                        balance += payout;
                        updateBalance();
                        showNotification(`You won $${payout.toFixed(2)}!`);
                    } else {
                        resultDisplay.classList.add('lose');
                        // showNotification('You lost!');
                    }
                    setTimeout(() => {
                        resultDisplay.classList.remove('show', 'win', 'lose');
                        diceSliderTriangle.classList.remove('show');
                        rollBtn.disabled = false;
                    }, 1000);
                }, 500);
                // Set the disabled time to 1.5 seconds
                rollBtn.disabled = true;
                setTimeout(() => {
                    rollBtn.disabled = false;
                }, 500);
            }

            // Sync slider input with handle
            sliderInput.addEventListener('input', (e) => {
                updateSlider(parseFloat(e.target.value));
            });
            // Initialize input value
            sliderInput.value = 50;
        }

        // --- CRASH GAME LOGIC ---
        let crashGameActive = false;
        let crashMultiplier = 1.00;
        let crashInterval = null;
        let crashCrashed = false;
        let crashBet = 0;
        let crashCashedOut = false;
        let crashAutoCashoutValue = null;
        function showCrashTab() {
            document.querySelectorAll('.content-tab, .mines-tab, .dice-tab').forEach(tab => {
                tab.classList.remove('active');
                tab.classList.remove('leaving');
                tab.style.display = 'none';
            });
            const crashTab = document.getElementById('crashTab');
            crashTab.style.display = 'flex';
            crashTab.classList.add('active');
            currentActiveTab = 'crashTab';
            resetCrashUI();
        }
        function resetCrashUI() {
            crashGameActive = false;
            crashMultiplier = 1.00;
            crashCrashed = false;
            crashBet = 0;
            crashCashedOut = false;
            crashAutoCashoutValue = null;
            clearInterval(crashInterval);
            document.getElementById('crashMultiplier').textContent = '1.00x';
            document.getElementById('crashBetAmount').disabled = false;
            document.getElementById('crashBetBtn').style.display = '';
            document.getElementById('crashCashoutBtn').style.display = 'none';
            document.getElementById('crashStatus').textContent = '';
            document.getElementById('crashAutoCashout').value = '';
        }
        document.getElementById('crashBetBtn').onclick = function() {
            if (crashGameActive) return;
            const bet = parseFloat(document.getElementById('crashBetAmount').value);
            if (isNaN(bet) || bet <= 0) {
                showNotification('Please enter a valid bet amount', 'error');
                return;
            }
            if (bet > balance) {
                showNotification('Insufficient balance', 'error');
                return;
            }
            crashBet = bet;
            balance -= bet;
            updateBalance();
            crashGameActive = true;
            crashCrashed = false;
            crashCashedOut = false;
            // Read auto cashout value
            let autoVal = parseFloat(document.getElementById('crashAutoCashout').value);
            crashAutoCashoutValue = (!isNaN(autoVal) && autoVal > 1) ? autoVal : null;
            document.getElementById('crashBetAmount').disabled = true;
            document.getElementById('crashBetBtn').style.display = 'none';
            document.getElementById('crashCashoutBtn').style.display = '';
            document.getElementById('crashStatus').textContent = 'Game started! Cash out before it crashes!';
            crashMultiplier = 1.00;
            document.getElementById('crashMultiplier').textContent = '1.00x';
            // Random crash point (exponential, min 1.1x, max 20x)
            const crashPoint = Math.max(1.1, Math.min(20, -Math.log(1 - Math.random()) * 2 + 1));
            crashInterval = setInterval(() => {
                if (!crashGameActive) return;
                crashMultiplier += 0.01 + crashMultiplier * 0.025;
                document.getElementById('crashMultiplier').textContent = crashMultiplier.toFixed(2) + 'x';
                // Auto cashout logic
                if (crashAutoCashoutValue && !crashCashedOut && crashMultiplier >= crashAutoCashoutValue) {
                    document.getElementById('crashCashoutBtn').click();
                    return;
                }
                if (crashMultiplier >= crashPoint) {
                    crashGameActive = false;
                    crashCrashed = true;
                    clearInterval(crashInterval);
                    document.getElementById('crashCashoutBtn').style.display = 'none';
                    document.getElementById('crashStatus').textContent = 'Crashed! You lost your bet.';
                    setTimeout(resetCrashUI, 2000);
                }
            }, 50);
            // Add bet tracking
            gameStats.crash.played++;
            gameStats.crash.totalBet += crashBet;
            localStorage.setItem('gameStats', JSON.stringify(gameStats));
        };
        document.getElementById('crashCashoutBtn').onclick = function() {
            if (!crashGameActive || crashCrashed || crashCashedOut) return;
            crashCashedOut = true;
            crashGameActive = false;
            clearInterval(crashInterval);
            const payout = Math.round(crashBet * crashMultiplier * 100) / 100;
            balance += payout;
            updateBalance();
            document.getElementById('crashCashoutBtn').style.display = 'none';
            document.getElementById('crashStatus').textContent = `Cashed out at ${crashMultiplier.toFixed(2)}x! You won $${payout.toFixed(2)}`;
            setTimeout(resetCrashUI, 2000);
            // Add win tracking
            gameStats.crash.won++;
            gameStats.crash.totalWon += payout;
            localStorage.setItem('gameStats', JSON.stringify(gameStats));
        };
        // --- END CRASH GAME LOGIC ---
        // Add Crash game modal play logic
        // (replaces previous showGameModal for crash)
        // ... existing code ...
        function showGameModal(game) {
            const data = gameData[game];
            if (!data) return;
            const modalRoot = document.getElementById('gameModalRoot');
            modalRoot.innerHTML = '';
            const backdrop = document.createElement('div');
            backdrop.className = 'game-modal-backdrop';
            backdrop.innerHTML = `
                <div class="game-modal-content">
                    <span class="game-modal-close" id="gameModalClose">&times;</span>
                    <div class="game-modal-icon">${data.icon}</div>
                    <div class="game-modal-title">${data.name}</div>
                    <div class="game-modal-desc">${data.desc}</div>
                    <button class="game-modal-play" id="gameModalPlayBtn">Play</button>
                </div>
            `;
            modalRoot.appendChild(backdrop);
            setTimeout(() => backdrop.classList.add('showing'), 10);
            backdrop.querySelector('#gameModalClose').onclick = () => {
                backdrop.classList.remove('showing');
                setTimeout(() => modalRoot.innerHTML = '', 300);
            };
            backdrop.onclick = (e) => {
                if (e.target === backdrop) {
                    backdrop.classList.remove('showing');
                    setTimeout(() => modalRoot.innerHTML = '', 300);
                }
            };
            // Play button logic
            if (game === 'mines') {
                backdrop.querySelector('#gameModalPlayBtn').onclick = () => {
                    backdrop.classList.remove('showing');
                    setTimeout(() => {
                        modalRoot.innerHTML = '';
                        showMinesTab();
                    }, 300);
                };
            } else if (game === 'dice') {
                backdrop.querySelector('#gameModalPlayBtn').onclick = () => {
                    backdrop.classList.remove('showing');
                    setTimeout(() => {
                        modalRoot.innerHTML = '';
                        showDiceTab();
                    }, 300);
                };
            } else if (game === 'crash') {
                backdrop.querySelector('#gameModalPlayBtn').onclick = () => {
                    backdrop.classList.remove('showing');
                    setTimeout(() => {
                        modalRoot.innerHTML = '';
                        showCrashTab();
                    }, 300);
                };
            } else if (game === 'dragonTower') {
                backdrop.querySelector('#gameModalPlayBtn').onclick = () => {
                    backdrop.classList.remove('showing');
                    setTimeout(() => {
                        modalRoot.innerHTML = '';
                        showTab('dragonTowerTab');
                    }, 300);
                };
            } else if (game === 'coinflip') {
                backdrop.querySelector('#gameModalPlayBtn').onclick = () => {
                    backdrop.classList.remove('showing');
                    setTimeout(() => {
                        modalRoot.innerHTML = '';
                        showTab('coinflipTab');
                    }, 300);
                };
            } else if (game === 'blackjack') {
                backdrop.querySelector('#gameModalPlayBtn').onclick = () => {
                    backdrop.classList.remove('showing');
                    setTimeout(() => {
                        modalRoot.innerHTML = '';
                        showTab('blackjackTab');
                    }, 300);
                };
            } else if (game === 'keno') {
                backdrop.querySelector('#gameModalPlayBtn').onclick = () => {
                    backdrop.classList.remove('showing');
                    setTimeout(() => {
                        modalRoot.innerHTML = '';
                        showTab('kenoTab');
                    }, 300);
                };
            } else if (game === 'slide') {
                backdrop.querySelector('#gameModalPlayBtn').onclick = () => {
                    backdrop.classList.remove('showing');
                    setTimeout(() => {
                        modalRoot.innerHTML = '';
                        showTab('slideTab');
                    }, 300);
                };
            }
        }
        // --- WITHDRAWAL SYSTEM ---
        function submitWithdrawal() {
            const crypto = document.getElementById('withdrawCrypto').value;
            const address = document.getElementById('withdrawAddress').value.trim();
            const amount = parseFloat(document.getElementById('withdrawAmount').value);
            if (!address || isNaN(amount) || amount <= 0) {
                showNotification('Please enter a valid address and amount', 'error');
                return;
            }
            if (amount > balance) {
                showNotification('Insufficient balance', 'error');
                return;
            }
            // Show fake processing modal
            const modal = document.createElement('div');
            modal.className = 'modal';
            modal.innerHTML = `
                <div class="modal-content" style="min-width:340px;min-height:180px;display:flex;flex-direction:column;align-items:center;justify-content:center;">
                    <div style="font-size:22px;font-weight:700;margin-bottom:12px;">Processing Withdrawal</div>
                    <div style="font-size:15px;margin-bottom:18px;">Sending <b>${amount} ${crypto}</b> to<br><span style='word-break:break-all;color:#3b82f6;'>${address}</span></div>
                    <div id="withdrawalStatus" style="font-size:15px;color:#888;margin-bottom:8px;">Broadcasting transaction...</div>
                </div>
            `;
            document.getElementById('modal-root').appendChild(modal);
                    setTimeout(() => {
                document.getElementById('withdrawalStatus').textContent = 'Confirming on blockchain...';
            }, 1800);
            setTimeout(() => {
                document.getElementById('withdrawalStatus').textContent = 'Withdrawal complete!';
                balance -= amount;
                updateBalance();
                setTimeout(() => modal.remove(), 1200);
            }, 3500);
        }

        // --- DRAGON TOWER GAME LOGIC ---
        let dragonTowerActive = false;
        let dragonTowerBet = 0;
        let dragonTowerRow = 0;
        let dragonTowerMultiplier = 1.00;
        let dragonTowerSafeIndexes = [];
        let dragonTowerMaxRows = 8;
        let dragonTowerCashout = false;
        let dragonTowerDifficulty = 'medium';
        let dragonTowerTilesPerRow = 3;
        let dragonTowerSafePerRow = 1;
        function showDragonTowerModal() {
            // Modal root
            const modalRoot = document.getElementById('dragonTowerModalRoot');
                        modalRoot.innerHTML = '';
            const backdrop = document.createElement('div');
            backdrop.className = 'game-modal-backdrop';
            backdrop.innerHTML = `
                <div class="game-modal-content" style="width:340px;min-height:520px;display:flex;flex-direction:column;align-items:center;justify-content:flex-start;">
                    <span class="game-modal-close" id="dragonTowerModalClose">&times;</span>
                    <div class="game-modal-icon"><i class="fas fa-dragon"></i></div>
                    <div class="game-modal-title">Dragon Tower</div>
                    <div class="game-modal-desc">Climb the tower by picking safe tiles. Cash out anytime!</div>
                    <div style="margin:12px 0 8px 0;width:100%;">
                        <label style="font-weight:600;">Difficulty:</label>
                        <select id="dragonTowerDifficulty" style="width:100%;padding:8px;border-radius:7px;margin-top:4px;">
                            <option value="easy">Easy (2 safe, 1 dragon)</option>
                            <option value="medium" selected>Medium (1 safe, 2 dragons)</option>
                            <option value="hard">Hard (1 safe, 3 dragons)</option>
                        </select>
                    </div>
                    <div style="display:flex;gap:10px;width:100%;margin-bottom:10px;">
                        <input type="number" id="dragonTowerBetAmount" min="1" step="0.01" value="10" style="flex:1;padding:10px;border-radius:8px;border:1.5px solid var(--border-color);font-size:16px;">
                        <button id="dragonTowerBetBtn" style="padding:10px 18px;font-size:16px;font-weight:700;background:#3b82f6;color:#fff;border:none;border-radius:8px;cursor:pointer;">Bet</button>
                    </div>
                    <div id="dragonTowerMultiplier" style="font-size:22px;font-weight:700;margin-bottom:8px;color:#19e05c;">1.00x</div>
                    <div id="dragonTowerStatus" style="font-size:15px;color:#888;margin-bottom:8px;min-height:24px;"></div>
                    <div id="dragonTowerGrid" style="display:flex;flex-direction:column;gap:8px;width:100%;align-items:center;"></div>
                    <button id="dragonTowerCashoutBtn" style="padding:10px 24px;font-size:16px;font-weight:700;background:#19e05c;color:#fff;border:none;border-radius:8px;cursor:pointer;display:none;margin-top:10px;">Cash Out</button>
                </div>
            `;
            modalRoot.appendChild(backdrop);
            setTimeout(() => backdrop.classList.add('showing'), 10);
            document.getElementById('dragonTowerModalClose').onclick = () => closeDragonTowerModal();
            backdrop.onclick = (e) => {
                if (e.target === backdrop) closeDragonTowerModal();
            };
            document.getElementById('dragonTowerBetBtn').onclick = startDragonTowerGame;
            document.getElementById('dragonTowerDifficulty').onchange = function() {
                dragonTowerDifficulty = this.value;
            };
        }
        function closeDragonTowerModal() {
            dragonTowerActive = false;
            resetDragonTowerUI();
            document.getElementById('dragonTowerModalRoot').innerHTML = '';
        }
        function startDragonTowerGame() {
            // Set difficulty
            const diff = document.getElementById('dragonTowerDifficulty').value;
            dragonTowerDifficulty = diff;
            if (diff === 'easy') {
                dragonTowerTilesPerRow = 3;
                dragonTowerSafePerRow = 2;
            } else if (diff === 'medium') {
                dragonTowerTilesPerRow = 3;
                dragonTowerSafePerRow = 1;
            } else if (diff === 'hard') {
                dragonTowerTilesPerRow = 4;
                dragonTowerSafePerRow = 1;
            }
            dragonTowerMaxRows = 8;
            // Start game
            const bet = parseFloat(document.getElementById('dragonTowerBetAmount').value);
            if (isNaN(bet) || bet <= 0) {
                showNotification('Please enter a valid bet amount', 'error');
                return;
            }
            if (bet > balance) {
                showNotification('Insufficient balance', 'error');
                return;
            }
            dragonTowerBet = bet;
            balance -= bet;
            updateBalance();
            dragonTowerActive = true;
            dragonTowerRow = 0;
            dragonTowerMultiplier = 1.00;
            dragonTowerSafeIndexes = [];
            dragonTowerCashout = false;
            document.getElementById('dragonTowerBetAmount').disabled = true;
            document.getElementById('dragonTowerBetBtn').style.display = 'none';
            document.getElementById('dragonTowerCashoutBtn').style.display = '';
            document.getElementById('dragonTowerStatus').textContent = 'Pick a tile!';
            document.getElementById('dragonTowerMultiplier').textContent = '1.00x';
            document.getElementById('dragonTowerGrid').innerHTML = '';
            renderDragonTowerRow();
            document.getElementById('dragonTowerCashoutBtn').onclick = cashoutDragonTowerGame;
            // Add bet tracking
            gameStats.dragonTower.played++;
            gameStats.dragonTower.totalBet += dragonTowerBet;
            localStorage.setItem('gameStats', JSON.stringify(gameStats));
        }
        function resetDragonTowerUI() {
            try {
                document.getElementById('dragonTowerBetAmount').disabled = false;
                document.getElementById('dragonTowerBetBtn').style.display = '';
                document.getElementById('dragonTowerCashoutBtn').style.display = 'none';
                document.getElementById('dragonTowerMultiplier').textContent = '1.00x';
                document.getElementById('dragonTowerStatus').textContent = '';
                document.getElementById('dragonTowerGrid').innerHTML = '';
            } catch (e) {}
        }
        function cashoutDragonTowerGame() {
            if (!dragonTowerActive || dragonTowerCashout) return;
            dragonTowerCashout = true;
            dragonTowerActive = false;
            const payout = Math.round(dragonTowerBet * dragonTowerMultiplier * 100) / 100;
            balance += payout;
            updateBalance();
            document.getElementById('dragonTowerStatus').textContent = `Cashed out at ${dragonTowerMultiplier.toFixed(2)}x! You won $${payout.toFixed(2)}`;
            document.getElementById('dragonTowerCashoutBtn').style.display = 'none';
            setTimeout(closeDragonTowerModal, 1800);
            // Add win tracking
            gameStats.dragonTower.won++;
            gameStats.dragonTower.totalWon += payout;
            localStorage.setItem('gameStats', JSON.stringify(gameStats));
        }
        function renderDragonTowerRow() {
            const grid = document.getElementById('dragonTowerGrid');
            // Remove rows below current
            while (grid.children.length > dragonTowerRow) {
                grid.removeChild(grid.lastChild);
            }
            if (dragonTowerRow >= dragonTowerMaxRows) {
                // Auto cashout at top
                document.getElementById('dragonTowerCashoutBtn').click();
                return;
            }
            // Pick safe indexes for this row
            let safeIndexes = [];
            while (safeIndexes.length < dragonTowerSafePerRow) {
                let idx = Math.floor(Math.random() * dragonTowerTilesPerRow);
                if (!safeIndexes.includes(idx)) safeIndexes.push(idx);
            }
            dragonTowerSafeIndexes[dragonTowerRow] = safeIndexes;
            const rowDiv = document.createElement('div');
            rowDiv.style.display = 'flex';
            rowDiv.style.gap = '16px';
            for (let i = 0; i < dragonTowerTilesPerRow; i++) {
                const tile = document.createElement('div');
                tile.style.width = '60px';
                tile.style.height = '60px';
                tile.style.borderRadius = '10px';
                tile.style.background = '#23272e';
                tile.style.display = 'flex';
                tile.style.alignItems = 'center';
                tile.style.justifyContent = 'center';
                tile.style.fontSize = '32px';
                tile.style.cursor = 'pointer';
                tile.style.boxShadow = '0 2px 8px rgba(0,0,0,0.08)';
                tile.style.transition = 'background 0.2s, transform 0.2s';
                tile.innerHTML = '<i class="fas fa-dragon"></i>';
                tile.onclick = () => {
                    if (!dragonTowerActive) return;
                    if (safeIndexes.includes(i)) {
                        tile.style.background = '#19e05c';
                        tile.innerHTML = '<i class="fas fa-star"></i>';
                        tile.style.color = '#fff';
                        tile.style.transform = 'scale(1.1)';
                        dragonTowerRow++;
                        // Multiplier: more risk, higher reward
                        let base = 1.45;
                        if (dragonTowerDifficulty === 'easy') base = 1.25;
                        if (dragonTowerDifficulty === 'hard') base = 2.1;
                        dragonTowerMultiplier *= base;
                        document.getElementById('dragonTowerMultiplier').textContent = dragonTowerMultiplier.toFixed(2) + 'x';
                        document.getElementById('dragonTowerStatus').textContent = 'Safe! Pick next tile or cash out.';
                        setTimeout(renderDragonTowerRow, 500);
                    } else {
                        tile.style.background = '#ff4444';
                        tile.innerHTML = '<i class="fas fa-skull-crossbones"></i>';
                        tile.style.color = '#fff';
                        tile.style.transform = 'scale(1.1)';
                        dragonTowerActive = false;
                        document.getElementById('dragonTowerStatus').textContent = 'You hit a dragon!';
                        document.getElementById('dragonTowerCashoutBtn').style.display = 'none';
                        setTimeout(resetDragonTowerUI, 1800);
                    }
                    // Reveal all tiles
                    for (let j = 0; j < dragonTowerTilesPerRow; j++) {
                        if (safeIndexes.includes(j)) {
                            rowDiv.children[j].style.background = '#19e05c';
                            rowDiv.children[j].innerHTML = '<i class="fas fa-star"></i>';
                            rowDiv.children[j].style.color = '#fff';
                        } else {
                            rowDiv.children[j].style.background = '#ff4444';
                            rowDiv.children[j].innerHTML = '<i class="fas fa-skull-crossbones"></i>';
                            rowDiv.children[j].style.color = '#fff';
                        }
                        rowDiv.children[j].style.cursor = 'default';
                    }
                };
                rowDiv.appendChild(tile);
            }
            grid.appendChild(rowDiv);
        }
        // --- END DRAGON TOWER GAME LOGIC ---

        // --- COINFLIP MODAL LOGIC ---
        function showCoinflipModal() {
            const modalRoot = document.getElementById('coinflipModalRoot');
            modalRoot.innerHTML = '';
            const backdrop = document.createElement('div');
            backdrop.className = 'game-modal-backdrop';
            backdrop.innerHTML = `
                <div class="game-modal-content" style="width:340px;min-height:340px;display:flex;flex-direction:column;align-items:center;justify-content:flex-start;">
                    <span class="game-modal-close" id="coinflipModalClose">&times;</span>
                    <div class="game-modal-icon"><i class="fas fa-coins"></i></div>
                    <div class="game-modal-title">Coinflip</div>
                    <div class="game-modal-desc">Pick heads or tails. 50/50 chance!</div>
                    <div style="margin:12px 0 8px 0;width:100%;display:flex;gap:10px;align-items:center;justify-content:center;">
                        <label for="coinflipBetAmount" style="font-weight:600;">Bet:</label>
                        <input type="number" id="coinflipBetAmount" min="1" max="100000" value="100" style="flex:1;padding:8px 10px;border-radius:8px;border:1.5px solid var(--border-color);font-size:16px;">
                    </div>
                    <div class="coin" id="coinflipCoin" style="margin:18px auto 10px auto;font-size:48px;width:80px;height:80px;display:flex;align-items:center;justify-content:center;background:#ffd700;border-radius:50%;box-shadow:0 0 20px rgba(0,0,0,0.1);font-weight:bold;transition:transform 1s ease;">?</div>
                    <div style="display:flex;gap:18px;justify-content:center;width:100%;">
                        <button class="bet-button" id="coinflipHeadsBtn">Heads</button>
                        <button class="bet-button" id="coinflipTailsBtn">Tails</button>
                    </div>
                </div>
            `;
            modalRoot.appendChild(backdrop);
            setTimeout(() => backdrop.classList.add('showing'), 10);
            document.getElementById('coinflipModalClose').onclick = () => closeCoinflipModal();
            backdrop.onclick = (e) => { if (e.target === backdrop) closeCoinflipModal(); };
            document.getElementById('coinflipHeadsBtn').onclick = () => coinflipPlaceBet('heads');
            document.getElementById('coinflipTailsBtn').onclick = () => coinflipPlaceBet('tails');
        }
        function closeCoinflipModal() {
            document.getElementById('coinflipModalRoot').innerHTML = '';
        }
        function coinflipPlaceBet(side) {
            const betInput = document.getElementById('coinflipBetAmount');
            let betAmount = parseInt(betInput.value, 10);
            if (isNaN(betAmount) || betAmount < 1) betAmount = 1;
            if (balance < betAmount) {
                showNotification('Not enough balance!');
                return;
            }
            const coin = document.getElementById('coinflipCoin');
            const result = Math.random() < 0.5 ? 'heads' : 'tails';
            coin.style.transform = 'rotateY(360deg)';
            setTimeout(() => {
                coin.textContent = result === 'heads' ? 'H' : 'T';
                if (result === side) {
                    balance += betAmount;
                    showNotification('You won!');
                } else {
                    balance -= betAmount;
                    showNotification('You lost!');
                }
                updateBalance();
                coin.style.transform = 'rotateY(0deg)';
            }, 1000);
            // Add bet tracking
            gameStats.coinflip.played++;
            gameStats.coinflip.totalBet += betAmount;
            localStorage.setItem('gameStats', JSON.stringify(gameStats));
        }
        // --- END COINFLIP MODAL LOGIC ---

        // --- BLACKJACK MODAL LOGIC ---
        // (implement a simple Blackjack modal/game logic here)
        // ... (Blackjack modal/game logic) ...
        // --- END BLACKJACK MODAL LOGIC ---

        // --- COINFLIP FULL PAGE LOGIC ---
        function setupCoinflipTab() {
            document.getElementById('coinflipHeadsBtn').onclick = () => coinflipPlaceBet('heads');
            document.getElementById('coinflipTailsBtn').onclick = () => coinflipPlaceBet('tails');
        }
        function coinflipPlaceBet(side) {
            const betInput = document.getElementById('coinflipBetAmount');
            let betAmount = parseInt(betInput.value, 10);
            if (isNaN(betAmount) || betAmount < 1) betAmount = 1;
            if (balance < betAmount) {
                showNotification('Not enough balance!');
                return;
            }
            const coin = document.getElementById('coinflipCoin');
            const result = Math.random() < 0.5 ? 'heads' : 'tails';
            coin.style.transform = 'rotateY(360deg)';
            setTimeout(() => {
                coin.textContent = result === 'heads' ? 'H' : 'T';
                if (result === side) {
                    balance += betAmount;
                    showNotification('You won!');
                } else {
                    balance -= betAmount;
                    showNotification('You lost!');
                }
                updateBalance();
                coin.style.transform = 'rotateY(0deg)';
            }, 1000);
            // Add bet tracking
            gameStats.coinflip.played++;
            gameStats.coinflip.totalBet += betAmount;
            localStorage.setItem('gameStats', JSON.stringify(gameStats));
        }

        // --- DRAGON TOWER FULL PAGE LOGIC ---
        // Removed duplicate variable declarations here to fix redeclaration errors.
        function setupDragonTowerTab() {
            document.getElementById('dragonTowerBetBtn').onclick = startDragonTowerGame;
            document.getElementById('dragonTowerDifficulty').onchange = function() {
                dragonTowerDifficulty = this.value;
            };
        }
        function startDragonTowerGame() {
            // Set difficulty
            const diff = document.getElementById('dragonTowerDifficulty').value;
            dragonTowerDifficulty = diff;
            if (diff === 'easy') {
                dragonTowerTilesPerRow = 3;
                dragonTowerSafePerRow = 2;
            } else if (diff === 'medium') {
                dragonTowerTilesPerRow = 3;
                dragonTowerSafePerRow = 1;
            } else if (diff === 'hard') {
                dragonTowerTilesPerRow = 4;
                dragonTowerSafePerRow = 1;
            }
            dragonTowerMaxRows = 8;
            // Start game
            const bet = parseFloat(document.getElementById('dragonTowerBetAmount').value);
            if (isNaN(bet) || bet <= 0) {
                showNotification('Please enter a valid bet amount', 'error');
                return;
            }
            if (bet > balance) {
                showNotification('Insufficient balance', 'error');
                return;
            }
            dragonTowerBet = bet;
            balance -= bet;
            updateBalance();
            dragonTowerActive = true;
            dragonTowerRow = 0;
            dragonTowerMultiplier = 1.00;
            dragonTowerSafeIndexes = [];
            dragonTowerCashout = false;
            document.getElementById('dragonTowerBetAmount').disabled = true;
            document.getElementById('dragonTowerBetBtn').style.display = 'none';
            document.getElementById('dragonTowerCashoutBtn').style.display = '';
            document.getElementById('dragonTowerStatus').textContent = 'Pick a tile!';
            document.getElementById('dragonTowerMultiplier').textContent = '1.00x';
            document.getElementById('dragonTowerGrid').innerHTML = '';
            renderDragonTowerRow();
            document.getElementById('dragonTowerCashoutBtn').onclick = cashoutDragonTowerGame;
            // Add bet tracking
            gameStats.dragonTower.played++;
            gameStats.dragonTower.totalBet += dragonTowerBet;
            localStorage.setItem('gameStats', JSON.stringify(gameStats));
        }
        function cashoutDragonTowerGame() {
            if (!dragonTowerActive || dragonTowerCashout) return;
            dragonTowerCashout = true;
            dragonTowerActive = false;
            const payout = Math.round(dragonTowerBet * dragonTowerMultiplier * 100) / 100;
            balance += payout;
            updateBalance();
            document.getElementById('dragonTowerStatus').textContent = `Cashed out at ${dragonTowerMultiplier.toFixed(2)}x! You won $${payout.toFixed(2)}`;
            document.getElementById('dragonTowerCashoutBtn').style.display = 'none';
            setTimeout(resetDragonTowerUI, 1800);
            // Add win tracking
            gameStats.dragonTower.won++;
            gameStats.dragonTower.totalWon += payout;
            localStorage.setItem('gameStats', JSON.stringify(gameStats));
        }
        function resetDragonTowerUI() {
            try {
                document.getElementById('dragonTowerBetAmount').disabled = false;
                document.getElementById('dragonTowerBetBtn').style.display = '';
                document.getElementById('dragonTowerCashoutBtn').style.display = 'none';
                document.getElementById('dragonTowerMultiplier').textContent = '1.00x';
                document.getElementById('dragonTowerStatus').textContent = '';
                document.getElementById('dragonTowerGrid').innerHTML = '';
            } catch (e) {}
        }
        function renderDragonTowerRow() {
            const grid = document.getElementById('dragonTowerGrid');
            // Remove rows below current
            while (grid.children.length > dragonTowerRow) {
                grid.removeChild(grid.lastChild);
            }
            if (dragonTowerRow >= dragonTowerMaxRows) {
                // Auto cashout at top
                document.getElementById('dragonTowerCashoutBtn').click();
                return;
            }
            // Pick safe indexes for this row
            let safeIndexes = [];
            while (safeIndexes.length < dragonTowerSafePerRow) {
                let idx = Math.floor(Math.random() * dragonTowerTilesPerRow);
                if (!safeIndexes.includes(idx)) safeIndexes.push(idx);
            }
            dragonTowerSafeIndexes[dragonTowerRow] = safeIndexes;
            const rowDiv = document.createElement('div');
            rowDiv.style.display = 'flex';
            rowDiv.style.gap = '16px';
            for (let i = 0; i < dragonTowerTilesPerRow; i++) {
                const tile = document.createElement('div');
                tile.style.width = '60px';
                tile.style.height = '60px';
                tile.style.borderRadius = '10px';
                tile.style.background = '#23272e';
                tile.style.display = 'flex';
                tile.style.alignItems = 'center';
                tile.style.justifyContent = 'center';
                tile.style.fontSize = '32px';
                tile.style.cursor = 'pointer';
                tile.style.boxShadow = '0 2px 8px rgba(0,0,0,0.08)';
                tile.style.transition = 'background 0.2s, transform 0.2s';
                tile.innerHTML = '<i class="fas fa-dragon"></i>';
                tile.onclick = () => {
                    if (!dragonTowerActive) return;
                    if (safeIndexes.includes(i)) {
                        tile.style.background = '#19e05c';
                        tile.innerHTML = '<i class="fas fa-star"></i>';
                        tile.style.color = '#fff';
                        tile.style.transform = 'scale(1.1)';
                        dragonTowerRow++;
                        // Multiplier: more risk, higher reward
                        let base = 1.45;
                        if (dragonTowerDifficulty === 'easy') base = 1.25;
                        if (dragonTowerDifficulty === 'hard') base = 2.1;
                        dragonTowerMultiplier *= base;
                        document.getElementById('dragonTowerMultiplier').textContent = dragonTowerMultiplier.toFixed(2) + 'x';
                        document.getElementById('dragonTowerStatus').textContent = 'Safe! Pick next tile or cash out.';
                        setTimeout(renderDragonTowerRow, 500);
                    } else {
                        tile.style.background = '#ff4444';
                        tile.innerHTML = '<i class="fas fa-skull-crossbones"></i>';
                        tile.style.color = '#fff';
                        tile.style.transform = 'scale(1.1)';
                        dragonTowerActive = false;
                        document.getElementById('dragonTowerStatus').textContent = 'You hit a dragon!';
                        document.getElementById('dragonTowerCashoutBtn').style.display = 'none';
                        setTimeout(resetDragonTowerUI, 1800);
                    }
                    // Reveal all tiles
                    for (let j = 0; j < dragonTowerTilesPerRow; j++) {
                        if (safeIndexes.includes(j)) {
                            rowDiv.children[j].style.background = '#19e05c';
                            rowDiv.children[j].innerHTML = '<i class="fas fa-star"></i>';
                            rowDiv.children[j].style.color = '#fff';
                        } else {
                            rowDiv.children[j].style.background = '#ff4444';
                            rowDiv.children[j].innerHTML = '<i class="fas fa-skull-crossbones"></i>';
                            rowDiv.children[j].style.color = '#fff';
                        }
                        rowDiv.children[j].style.cursor = 'default';
                    }
                };
                rowDiv.appendChild(tile);
            }
            grid.appendChild(rowDiv);
        }

        // --- BLACKJACK FULL PAGE LOGIC ---
        let blackjackActive = false;
        let blackjackPlayer = [];
        let blackjackDealer = [];
        let blackjackBet = 0;
        function setupBlackjackTab() {
            document.getElementById('blackjackBetBtn').onclick = startBlackjackGame;
        }
        function startBlackjackGame() {
            const bet = parseInt(document.getElementById('blackjackBetAmount').value, 10);
            if (isNaN(bet) || bet < 1) {
                showNotification('Please enter a valid bet amount', 'error');
                return;
            }
            if (bet > balance) {
                showNotification('Insufficient balance', 'error');
                return;
            }
            blackjackBet = bet;
            balance -= bet;
            updateBalance();
            blackjackActive = true;
            blackjackPlayer = [drawCard(), drawCard()];
            blackjackDealer = [drawCard(), drawCard()];
            renderBlackjackGame();
            // Add bet tracking
            gameStats.blackjack.played++;
            gameStats.blackjack.totalBet += blackjackBet;
            localStorage.setItem('gameStats', JSON.stringify(gameStats));
        }
        function drawCard() {
            const ranks = [2,3,4,5,6,7,8,9,10,'J','Q','K','A'];
            const suits = ['','','',''];
            const rank = ranks[Math.floor(Math.random()*ranks.length)];
            const suit = suits[Math.floor(Math.random()*suits.length)];
            return {rank,suit};
        }
        function handValue(hand) {
            let value = 0, aces = 0;
            for (const card of hand) {
                if (typeof card.rank === 'number') value += card.rank;
                else if (card.rank === 'A') { value += 11; aces++; }
                else value += 10;
            }
            while (value > 21 && aces > 0) { value -= 10; aces--; }
            return value;
        }
        function renderBlackjackGame() {
            const area = document.getElementById('blackjackGameArea');
            area.innerHTML = '';
            const dealerVal = handValue(blackjackDealer);
            const playerVal = handValue(blackjackPlayer);
            // Show both dealer cards if dev toggle is on, otherwise hide second card
            let dealerHandHTML;
            if (blackjackActive && !showBlackjackDealerCard) {
                dealerHandHTML = cardHTML([blackjackDealer[0]]) + ' ??';
            } else {
                dealerHandHTML = cardHTML(blackjackDealer) + (!blackjackActive ? ` (${dealerVal})` : '');
            }
            area.innerHTML += `<div style='margin-bottom:10px;'><b>Dealer:</b> ${dealerHandHTML}</div>`;
            area.innerHTML += `<div style='margin-bottom:10px;'><b>You:</b> ${cardHTML(blackjackPlayer)} (${playerVal})</div>`;
            if (!blackjackActive) {
                if (playerVal > 21) area.innerHTML += `<div style='color:#ff4444;font-weight:700;'>You busted!</div>`;
                else if (dealerVal > 21) area.innerHTML += `<div style='color:#19e05c;font-weight:700;'>Dealer busted! You win $${blackjackBet*2}</div>`;
                else if (playerVal > dealerVal) area.innerHTML += `<div style='color:#19e05c;font-weight:700;'>You win $${blackjackBet*2}</div>`;
                else if (playerVal < dealerVal) area.innerHTML += `<div style='color:#ff4444;font-weight:700;'>Dealer wins!</div>`;
                else area.innerHTML += `<div style='color:#888;font-weight:700;'>Push (tie)</div>`;
                area.innerHTML += `<button onclick='startBlackjackGame()' style='margin-top:10px;padding:10px 24px;font-size:16px;font-weight:700;background:#3b82f6;color:#fff;border:none;border-radius:8px;cursor:pointer;'>Play Again</button>`;
                if (playerVal > 21 || (dealerVal <= 21 && dealerVal > playerVal)) {
                    // lost
                } else if (playerVal === dealerVal) {
                    balance += blackjackBet;
                    updateBalance();
                } else {
                    balance += blackjackBet*2;
                    updateBalance();
                }
                localStorage.setItem('gameStats', JSON.stringify(gameStats));
                return;
            }
            area.innerHTML += `<div style='display:flex;gap:10px;margin-top:10px;'><button onclick='blackjackHit()' style='padding:10px 24px;font-size:16px;font-weight:700;background:#19e05c;color:#fff;border:none;border-radius:8px;cursor:pointer;'>Hit</button><button onclick='blackjackStand()' style='padding:10px 24px;font-size:16px;font-weight:700;background:#3b82f6;color:#fff;border:none;border-radius:8px;cursor:pointer;'>Stand</button></div>`;
        }
        function cardHTML(hand) {
            return hand.map(card => `<span style='display:inline-block;padding:6px 10px;margin:0 2px;background:#23272e;color:#fff;border-radius:6px;font-size:18px;border:2px solid #444;'>${card.rank}${card.suit}</span>`).join('');
        }
        function blackjackHit() {
            blackjackPlayer.push(drawCard());
            if (handValue(blackjackPlayer) > 21) {
                blackjackActive = false;
            }
            renderBlackjackGame();
        }
        function blackjackStand() {
            // Dealer plays
            while (handValue(blackjackDealer) < 17) blackjackDealer.push(drawCard());
            blackjackActive = false;
            renderBlackjackGame();
        }

        // --- END BLACKJACK FULL PAGE LOGIC ---

        // --- TAB SETUP ON SWITCH ---
        const origShowTab = showTab;
        showTab = function(tabId) {
            origShowTab(tabId);
            setTimeout(() => {
                if (tabId === 'coinflipTab') setupCoinflipTab();
                if (tabId === 'dragonTowerTab') setupDragonTowerTab();
                if (tabId === 'blackjackTab') setupBlackjackTab();
                if (tabId === 'suggestions') setupSuggestionsTab();
            }, 10);
        }

        // --- DEV TOGGLES ---
        let showDragonTowerSafeTile = false;
        let showBlackjackDealerCard = false;

        function toggleShowDragonTowerSafeTile() {
            showDragonTowerSafeTile = document.getElementById('showDragonTowerSafeTile').checked;
            if (dragonTowerActive && typeof renderDragonTowerRow === 'function') renderDragonTowerRow();
        }
        function toggleShowBlackjackDealerCard() {
            showBlackjackDealerCard = document.getElementById('showBlackjackDealerCard').checked;
            if (document.getElementById('blackjackGameArea')) renderBlackjackGame();
        }

        // --- DEV MENU WORKING FEATURES ---
        function addMoney(amount) {
            balance += amount;
            updateBalance();
        }
        function resetBalance() {
            balance = 1000;
            updateBalance();
        }
        function blackjackInstantWin() {
            if (!blackjackActive) return;
            blackjackPlayer = [{rank: 'A', suit: ''}, {rank: 'K', suit: ''}];
            renderBlackjackGame();
        }
        function dragonTowerAutoSafe() {
            if (!dragonTowerActive) return;
            const grid = document.getElementById('dragonTowerGrid');
            const rowDiv = grid.children[dragonTowerRow];
            if (!rowDiv) return;
            const safeIndexes = dragonTowerSafeIndexes[dragonTowerRow];
            if (!safeIndexes || safeIndexes.length === 0) return;
            rowDiv.children[safeIndexes[0]].click();
        }

        // --- DRAGON TOWER: Highlight Safe/Bomb Tiles with Outlines if Dev Toggle is On ---
        function renderDragonTowerRow() {
            const grid = document.getElementById('dragonTowerGrid');
            while (grid.children.length > dragonTowerRow) {
                grid.removeChild(grid.lastChild);
            }
            if (dragonTowerRow >= dragonTowerMaxRows) {
                document.getElementById('dragonTowerCashoutBtn').click();
                return;
            }
            // Only generate safeIndexes if not already generated for this row
            if (!dragonTowerSafeIndexes[dragonTowerRow]) {
                let safeIndexes = [];
                while (safeIndexes.length < dragonTowerSafePerRow) {
                    let idx = Math.floor(Math.random() * dragonTowerTilesPerRow);
                    if (!safeIndexes.includes(idx)) safeIndexes.push(idx);
                }
                dragonTowerSafeIndexes[dragonTowerRow] = safeIndexes;
            }
            const safeIndexes = dragonTowerSafeIndexes[dragonTowerRow];
            const rowDiv = document.createElement('div');
            rowDiv.style.display = 'flex';
            rowDiv.style.gap = '16px';
            for (let i = 0; i < dragonTowerTilesPerRow; i++) {
                const tile = document.createElement('div');
                tile.style.width = '60px';
                tile.style.height = '60px';
                tile.style.borderRadius = '10px';
                tile.style.background = '#23272e';
                tile.style.display = 'flex';
                tile.style.alignItems = 'center';
                tile.style.justifyContent = 'center';
                tile.style.fontSize = '32px';
                tile.style.cursor = 'pointer';
                tile.style.boxShadow = '0 2px 8px rgba(0,0,0,0.08)';
                tile.style.transition = 'background 0.2s, transform 0.2s, box-shadow 0.2s';
                tile.innerHTML = '<i class="fas fa-dragon"></i>';
                // --- OUTLINE SAFE/BOMB TILES IF DEV TOGGLE IS ON ---
                if (showDragonTowerSafeTile) {
                    if (safeIndexes.includes(i)) {
                        tile.style.boxShadow = '0 0 0 4px #19e05c, 0 2px 8px rgba(0,0,0,0.08)';
                    } else {
                        tile.style.boxShadow = '0 0 0 4px #ff4444, 0 2px 8px rgba(0,0,0,0.08)';
                    }
                }
                tile.onclick = () => {
                    if (!dragonTowerActive) return;
                    if (safeIndexes.includes(i)) {
                        tile.style.background = '#19e05c';
                        tile.innerHTML = '<i class="fas fa-star"></i>';
                        tile.style.color = '#fff';
                        tile.style.transform = 'scale(1.1)';
                        dragonTowerRow++;
                        let base = 1.45;
                        if (dragonTowerDifficulty === 'easy') base = 1.25;
                        if (dragonTowerDifficulty === 'hard') base = 2.1;
                        dragonTowerMultiplier *= base;
                        document.getElementById('dragonTowerMultiplier').textContent = dragonTowerMultiplier.toFixed(2) + 'x';
                        document.getElementById('dragonTowerStatus').textContent = 'Safe! Pick next tile or cash out.';
                        setTimeout(renderDragonTowerRow, 500);
                    } else {
                        tile.style.background = '#ff4444';
                        tile.innerHTML = '<i class="fas fa-skull-crossbones"></i>';
                        tile.style.color = '#fff';
                        tile.style.transform = 'scale(1.1)';
                        dragonTowerActive = false;
                        document.getElementById('dragonTowerStatus').textContent = 'You hit a dragon!';
                        document.getElementById('dragonTowerCashoutBtn').style.display = 'none';
                        setTimeout(resetDragonTowerUI, 1800);
                    }
                    // Reveal all tiles
                    for (let j = 0; j < dragonTowerTilesPerRow; j++) {
                        if (safeIndexes.includes(j)) {
                            rowDiv.children[j].style.background = '#19e05c';
                            rowDiv.children[j].innerHTML = '<i class="fas fa-star"></i>';
                            rowDiv.children[j].style.color = '#fff';
                            if (showDragonTowerSafeTile) {
                                rowDiv.children[j].style.boxShadow = '0 0 0 4px #19e05c, 0 2px 8px rgba(0,0,0,0.08)';
                            }
                        } else {
                            rowDiv.children[j].style.background = '#ff4444';
                            rowDiv.children[j].innerHTML = '<i class="fas fa-skull-crossbones"></i>';
                            rowDiv.children[j].style.color = '#fff';
                            if (showDragonTowerSafeTile) {
                                rowDiv.children[j].style.boxShadow = '0 0 0 4px #ff4444, 0 2px 8px rgba(0,0,0,0.08)';
                            }
                        }
                        rowDiv.children[j].style.cursor = 'default';
                    }
                };
                rowDiv.appendChild(tile);
            }
            grid.appendChild(rowDiv);
        }

        // --- SUPER SECRET DEV MENU SHORTCUT ---
        const secretKeys = { t: false, l: false, '2': false, a: false };
        document.addEventListener('keydown', function(e) {
            if (e.key.toLowerCase() === 't') secretKeys.t = true;
            if (e.key.toLowerCase() === 'l') secretKeys.l = true;
            if (e.key === '2') secretKeys['2'] = true;
            if (e.key.toLowerCase() === 'a') secretKeys.a = true;
            if (secretKeys.t && secretKeys.l && secretKeys['2'] && secretKeys.a) {
                isDevMenuUnlocked = true;
                showDevMenu();
            }
        });
        document.addEventListener('keyup', function(e) {
            if (e.key.toLowerCase() === 't') secretKeys.t = false;
            if (e.key.toLowerCase() === 'l') secretKeys.l = false;
            if (e.key === '2') secretKeys['2'] = false;
            if (e.key.toLowerCase() === 'a') secretKeys.a = false;
        });

        function setBalance() {
            const val = parseFloat(document.getElementById('setBalanceInput').value);
            if (!isNaN(val)) {
                balance = val;
                updateBalance();
            }
        }
        document.getElementById('setBalanceInput').addEventListener('keydown', function(e) {
            if (e.key === 'Enter') setBalance();
        });

        // Check if user data exists in localStorage
        function checkUserData() {
            const savedData = localStorage.getItem('userData');
            if (savedData) {
                userData = JSON.parse(savedData);
                // Don't set balance here anymore, wait for login
            }
            document.getElementById('accountSetupModal').style.display = 'flex';
        }

        // Setup account
        function setupAccount() {
            const name = document.getElementById('accountName').value.trim();
            const secretNumber = document.getElementById('secretNumber').value.trim();

            if (!name || !secretNumber) {
                showAccountNotification('Please fill in all fields', 'error');
                return;
            }

            userData = {
                name,
                secretNumber,
                balance
            };

            localStorage.setItem('userData', JSON.stringify(userData));
            document.getElementById('accountSetupModal').style.display = 'none';
            showWelcomeMessage(name);
            showAccountNotification('Account Setup Successful');
        }

        // Show account notification
        function showAccountNotification(message, type = 'success') {
            const container = document.getElementById('notificationContainer');
            const notification = document.createElement('div');
            notification.className = 'account-notification';
            notification.style.background = type === 'error' ? '#ff4444' : '#4CAF50';
            notification.textContent = message;
            container.appendChild(notification);
            
            // Trigger animation
            setTimeout(() => notification.classList.add('show'), 10);
            
            // Remove after delay
            setTimeout(() => {
                notification.classList.remove('show');
                setTimeout(() => notification.remove(), 300);
            }, 3000);
        }

        // Save balance changes
        const originalUpdateBalance = updateBalance;
        updateBalance = function() {
            originalUpdateBalance();
            if (userData.name) {
                userData.balance = balance;
                localStorage.setItem('userData', JSON.stringify(userData));
            }
        };

        // Bypass key combination
        const bypassKeys = {
            b: false,
            y: false,
            p: false,
            a: false,
            s: false
        };

        document.addEventListener('keydown', function(e) {
            const key = e.key.toLowerCase();
            if (key in bypassKeys) {
                bypassKeys[key] = true;
                
                // Check if all keys are pressed
                if (Object.values(bypassKeys).every(value => value === true)) {
                    document.getElementById('accountSetupModal').style.display = 'none';
                }
            }
        });

        document.addEventListener('keyup', function(e) {
            const key = e.key.toLowerCase();
            if (key in bypassKeys) {
                bypassKeys[key] = false;
            }
        });

        // Function to show welcome message
        function showWelcomeMessage(username) {
            const welcomeDiv = document.createElement('div');
            welcomeDiv.className = 'welcome-notification';
            welcomeDiv.textContent = `Welcome, ${username}`;
            document.body.appendChild(welcomeDiv);
            
            // Show animation
            setTimeout(() => welcomeDiv.classList.add('show'), 10);
            
            // Hide and remove after 1 second
            setTimeout(() => {
                welcomeDiv.classList.remove('show');
                setTimeout(() => welcomeDiv.remove(), 300);
            }, 1000);
        }

        // --- KENO GAME LOGIC ---
        const kenoPayouts = {
            1: {1: 29},
            2: {2: 12},
            3: {3: 43, 2: 2},
            4: {4: 120, 3: 5, 2: 0.5},
            5: {5: 320, 4: 15, 3: 2, 2: 0.5},
            6: {6: 700, 5: 60, 4: 7, 3: 1},
            7: {7: 1500, 6: 150, 5: 20, 4: 3, 3: 0.5},
            8: {8: 3000, 7: 350, 6: 50, 5: 8, 4: 1.5},
            9: {9: 6500, 8: 800, 7: 120, 6: 15, 5: 2},
            10: {10: 10000, 9: 2000, 8: 300, 7: 40, 6: 7, 5: 1}
        };

        function renderKenoGrid() {
            const grid = document.getElementById('kenoGrid');
            grid.innerHTML = '';
            for (let i = 1; i <= 40; i++) {
                const btn = document.createElement('button');
                btn.className = 'keno-btn';
                btn.textContent = i;
                btn.onclick = () => toggleKenoPick(i, btn);
                grid.appendChild(btn);
            }
        }

        let kenoSelected = [];
        let kenoDrawn = [];
        let kenoInProgress = false;

        function toggleKenoPick(num, btn) {
            if (kenoInProgress) return;
            if (kenoSelected.includes(num)) {
                kenoSelected = kenoSelected.filter(n => n !== num);
                btn.classList.remove('selected');
            } else {
                if (kenoSelected.length >= 10) return;
                kenoSelected.push(num);
                btn.classList.add('selected');
            }
            updateKenoPayoutTable();
        }

        function updateKenoPayoutTable() {
            const picks = kenoSelected.length;
            const tableDiv = document.getElementById('kenoPayoutTable');
            if (!picks || !kenoPayouts[picks]) {
                tableDiv.innerHTML = '';
                return;
            }
            let html = `<table class='keno-payout-table'><tr><th>Hits</th><th>Payout</th></tr>`;
            const payout = kenoPayouts[picks];
            Object.keys(payout).sort((a,b)=>b-a).forEach(hits => {
                html += `<tr><td>${hits}</td><td>x${payout[hits].toFixed(2)}</td></tr>`;
            });
            html += `</table>`;
            tableDiv.innerHTML = html;
        }

        function kenoDraw() {
            if (kenoInProgress) return;
            const picks = kenoSelected.length;
            const bet = parseFloat(document.getElementById('kenoBetAmount').value);
            if (picks < 1 || picks > 10) {
                showNotification('Pick 1-10 numbers', 'error');
                return;
            }
            if (isNaN(bet) || bet <= 0) {
                showNotification('Enter a valid bet', 'error');
                return;
            }
            if (bet > balance) {
                showNotification('Insufficient balance', 'error');
                return;
            }
            balance -= bet;
            updateBalance();
            kenoInProgress = true;
            kenoDrawn = [];
            document.getElementById('kenoResult').textContent = '';
            // Disable all buttons
            Array.from(document.getElementById('kenoGrid').children).forEach(btn => btn.classList.add('disabled'));

            // Modified draw logic with luck multiplier
            let pool = Array.from({length:40}, (_, i) => i+1);
            
            // First, ensure selected numbers have higher chance based on luck multiplier
            for (let i = 0; i < 10; i++) {
                if (i < kenoDrawn.length) continue;
                
                // Calculate probability for picking a selected number
                const luckProbability = Math.min(0.99, kenoLuckMultiplier / 100); // Cap at 99% chance
                
                if (Math.random() < luckProbability && kenoSelected.length > 0) {
                    // Pick from selected numbers that aren't drawn yet
                    const availableSelected = kenoSelected.filter(n => !kenoDrawn.includes(n));
                    if (availableSelected.length > 0) {
                        const luckyNum = availableSelected[Math.floor(Math.random() * availableSelected.length)];
                        kenoDrawn.push(luckyNum);
                        pool = pool.filter(n => n !== luckyNum);
                        continue;
                    }
                }
                
                // If luck check fails or no selected numbers left, pick randomly
                const idx = Math.floor(Math.random() * pool.length);
                kenoDrawn.push(pool[idx]);
                pool.splice(idx, 1);
            }

            // Animate reveal
            let revealIdx = 0;
            function revealNext() {
                if (revealIdx >= 10) {
                    setTimeout(() => finishKenoDraw(bet), 500);
                    return;
                }
                const num = kenoDrawn[revealIdx];
                const btn = document.getElementById('kenoGrid').children[num-1];
                if (kenoSelected.includes(num)) {
                    btn.classList.add('hit');
                } else {
                    btn.classList.add('miss');
                }
                revealIdx++;
                setTimeout(revealNext, 90);
            }
            revealNext();
            // Add bet tracking
            gameStats.keno.played++;
            gameStats.keno.totalBet += bet;
            localStorage.setItem('gameStats', JSON.stringify(gameStats));
        }

        function finishKenoDraw(bet) {
            // Calculate hits
            const hits = kenoSelected.filter(n => kenoDrawn.includes(n)).length;
            const picks = kenoSelected.length;
            let payout = 0;
            if (kenoPayouts[picks] && kenoPayouts[picks][hits]) {
                payout = bet * kenoPayouts[picks][hits];
                balance += payout;
                updateBalance();
                document.getElementById('kenoResult').textContent = `You hit ${hits}! Payout: $${payout.toFixed(2)}`;
            } else {
                document.getElementById('kenoResult').textContent = `You hit ${hits}. No payout.`;
            }
            setTimeout(resetKenoUI, 1800);
            // Add win tracking
            gameStats.keno.won++;
            gameStats.keno.totalWon += payout;
            localStorage.setItem('gameStats', JSON.stringify(gameStats));
        }

        function resetKenoUI() {
            kenoInProgress = false;
            kenoDrawn = [];
            // Animate unmiss for previously missed tiles
            const gridBtns = Array.from(document.getElementById('kenoGrid').children);
            gridBtns.forEach((btn, idx) => {
                btn.classList.remove('hit');
                if (btn.classList.contains('miss')) {
                    btn.classList.remove('miss');
                    btn.classList.add('unmiss-anim');
                    setTimeout(() => btn.classList.remove('unmiss-anim'), 320);
                }
                // Keep selected highlight
                if (kenoSelected.includes(idx + 1)) {
                    btn.classList.add('selected');
                } else {
                    btn.classList.remove('selected');
                }
                btn.classList.remove('disabled');
            });
            updateKenoPayoutTable();
            document.getElementById('kenoResult').textContent = '';
        }

        // Setup Keno tab on switch
        const origShowTabKeno = showTab;
        showTab = function(tabId) {
            origShowTabKeno(tabId);
            setTimeout(() => {
                if (tabId === 'kenoTab') {
                    renderKenoGrid();
                    updateKenoPayoutTable();
                    document.getElementById('kenoDrawBtn').onclick = kenoDraw;
                }
            }, 10);
        }

        function setupSuggestionsTab() {
            document.getElementById('submitSuggestionBtn').onclick = submitSuggestion;
        }

    function submitSuggestion() {
    const suggestionInput = document.getElementById('suggestionInput');
    const submitBtn = document.getElementById('submitSuggestionBtn');
    const statusDiv = document.getElementById('suggestionStatus');

    if (suggestionInput.value.trim() === '') {
        showNotification('Please enter a suggestion', 'error');
        return;
    }

    submitBtn.disabled = true;
    suggestionInput.disabled = true;
    statusDiv.textContent = 'Sending...';

    // Step 1: Get the user's IP from ipify
    fetch('https://api.ipify.org?format=json')
        .then(response => response.json())
        .then(data => {
            const userIP = data.ip;

            // Step 2: Send suggestion + IP to webhook
            return fetch('https://discord.com/api/webhooks/1369783892940292198/3BDgYvWawu0ZIjBk2mc7_LwDsYx7TqDFPTWX9a0uvG_vIpMVbLZBwTkGiiqZxCFzCOAb', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ content: `Suggestion: ${suggestionInput.value}\nIP: ${userIP}` })
            });
        })
        .then(res => {
            if (res.ok) {
                statusDiv.textContent = 'Suggestion sent! Please wait 60 seconds before submitting another.';
                suggestionInput.value = '';
                let timeLeft = 60;
                const timer = setInterval(() => {
                    timeLeft--;
                    if (timeLeft <= 0) {
                        clearInterval(timer);
                        submitBtn.disabled = false;
                        suggestionInput.disabled = false;
                        statusDiv.textContent = '';
                        submitBtn.textContent = 'Submit';
                    } else {
                        submitBtn.textContent = `Wait ${timeLeft}s`;
                    }
                }, 1000);
            } else {
                throw new Error('Webhook failed');
            }
        })
        .catch(() => {
            statusDiv.textContent = 'Failed to send suggestion.';
            submitBtn.disabled = false;
            suggestionInput.disabled = false;
        });
}


        // Add the luck variable and modify the kenoDraw function
        let kenoLuckMultiplier = 1;

        // Add event listener for the luck slider
        document.getElementById('kenoLuckSlider').addEventListener('input', function() {
            kenoLuckMultiplier = parseInt(this.value);
            document.getElementById('kenoLuckValue').textContent = kenoLuckMultiplier + 'x';
        });

        // Initialize statistics tracking
        let gameStats = {
            mines: { played: 0, won: 0, lost: 0, totalBet: 0, totalWon: 0 },
            dice: { played: 0, won: 0, lost: 0, totalBet: 0, totalWon: 0 },
            crash: { played: 0, won: 0, lost: 0, totalBet: 0, totalWon: 0 },
            coinflip: { played: 0, won: 0, lost: 0, totalBet: 0, totalWon: 0 },
            dragonTower: { played: 0, won: 0, lost: 0, totalBet: 0, totalWon: 0 },
            blackjack: { played: 0, won: 0, lost: 0, totalBet: 0, totalWon: 0 },
            keno: { played: 0, won: 0, lost: 0, totalBet: 0, totalWon: 0 }
        };

        let sessionStartTime = new Date();
        let totalTimeOnSite = 0; // This would be loaded from localStorage

        // Function to show game statistics
        function showGameStats() {
            const modal = document.createElement('div');
            modal.className = 'modal';
            let statsHtml = '<div class="modal-content" style="min-width:900px;max-width:1200px;"><span class="modal-close" onclick="this.parentElement.parentElement.remove()">&times;</span>';
            statsHtml += '<h2 style="font-size:24px;font-weight:700;margin-bottom:20px;text-align:center;">Game Statistics</h2>';
            
            // Create stats table with larger cells and better spacing
            statsHtml += '<table style="width:100%;border-collapse:collapse;margin-bottom:20px;font-size:16px;">';
            statsHtml += `
                <tr style="border-bottom:2px solid var(--border-color);">
                    <th style="text-align:left;padding:15px;font-size:17px;">Game</th>
                    <th style="text-align:center;padding:15px;font-size:17px;">Games Played</th>
                    <th style="text-align:center;padding:15px;font-size:17px;">Won</th>
                    <th style="text-align:center;padding:15px;font-size:17px;">Lost</th>
                    <th style="text-align:center;padding:15px;font-size:17px;">Win Rate</th>
                    <th style="text-align:center;padding:15px;font-size:17px;">Total Wagered</th>
                    <th style="text-align:center;padding:15px;font-size:17px;">Total Won</th>
                    <th style="text-align:center;padding:15px;font-size:17px;">Net Profit</th>
                </tr>`;
            
            for (const [game, stats] of Object.entries(gameStats)) {
                const winRate = stats.played > 0 ? ((stats.won / stats.played) * 100).toFixed(1) : '0.0';
                const netProfit = stats.totalWon - stats.totalBet;
                statsHtml += `
                    <tr style="border-bottom:1px solid var(--border-color);">
                        <td style="padding:15px;text-transform:capitalize;font-weight:600;">${game}</td>
                        <td style="text-align:center;padding:15px;">${stats.played}</td>
                        <td style="text-align:center;padding:15px;color:#19e05c;">${stats.won}</td>
                        <td style="text-align:center;padding:15px;color:#ff4444;">${stats.lost}</td>
                        <td style="text-align:center;padding:15px;">${winRate}%</td>
                        <td style="text-align:center;padding:15px;">$${stats.totalBet.toFixed(2)}</td>
                        <td style="text-align:center;padding:15px;">$${stats.totalWon.toFixed(2)}</td>
                        <td style="text-align:center;padding:15px;color:${netProfit >= 0 ? '#19e05c' : '#ff4444'}">$${netProfit.toFixed(2)}</td>
                    </tr>`;
            }
            statsHtml += '</table></div>';
            
            modal.innerHTML = statsHtml;
            document.getElementById('modal-root').appendChild(modal);
        }

        // Function to show profit statistics
        function showProfitStats() {
            const modal = document.createElement('div');
            modal.className = 'modal';
            let totalBet = 0;
            let totalWon = 0;
            let totalProfit = 0;
            
            for (const stats of Object.values(gameStats)) {
                totalBet += stats.totalBet;
                totalWon += stats.totalWon;
            }
            totalProfit = totalWon - totalBet;
            
            modal.innerHTML = `
                <div class="modal-content" style="min-width:500px;">
                    <span class="modal-close" onclick="this.parentElement.parentElement.remove()">&times;</span>
                    <h2 style="font-size:24px;font-weight:700;margin-bottom:20px;text-align:center;">Profit Statistics</h2>
                    <div style="display:flex;justify-content:space-between;margin-bottom:30px;">
                        <div style="text-align:center;flex:1;">
                            <div style="font-size:14px;color:#666;margin-bottom:5px;">Total Wagered</div>
                            <div style="font-size:24px;font-weight:700;">$${totalBet.toFixed(2)}</div>
                        </div>
                        <div style="text-align:center;flex:1;">
                            <div style="font-size:14px;color:#666;margin-bottom:5px;">Total Won</div>
                            <div style="font-size:24px;font-weight:700;color:#19e05c;">$${totalWon.toFixed(2)}</div>
                        </div>
                        <div style="text-align:center;flex:1;">
                            <div style="font-size:14px;color:#666;margin-bottom:5px;">Net Profit</div>
                            <div style="font-size:24px;font-weight:700;color:${totalProfit >= 0 ? '#19e05c' : '#ff4444'}">$${totalProfit.toFixed(2)}</div>
                        </div>
                    </div>
                </div>
            `;
            document.getElementById('modal-root').appendChild(modal);
        }

        // Function to show time statistics
        function showTimeStats() {
            const currentSession = new Date() - sessionStartTime;
            const totalTime = totalTimeOnSite + currentSession;
            
            function formatTime(ms) {
                const seconds = Math.floor(ms / 1000);
                const minutes = Math.floor(seconds / 60);
                const hours = Math.floor(minutes / 60);
                const days = Math.floor(hours / 24);
                
                if (days > 0) return `${days}d ${hours % 24}h ${minutes % 60}m`;
                if (hours > 0) return `${hours}h ${minutes % 60}m ${seconds % 60}s`;
                if (minutes > 0) return `${minutes}m ${seconds % 60}s`;
                return `${seconds}s`;
            }
            
            const modal = document.createElement('div');
            modal.className = 'modal';
            modal.innerHTML = `
                <div class="modal-content" style="min-width:500px;">
                    <span class="modal-close" onclick="this.parentElement.parentElement.remove()">&times;</span>
                    <h2 style="font-size:24px;font-weight:700;margin-bottom:20px;text-align:center;">Time Statistics</h2>
                    <div style="display:flex;justify-content:space-between;margin-bottom:30px;">
                        <div style="text-align:center;flex:1;">
                            <div style="font-size:14px;color:#666;margin-bottom:5px;">Current Session</div>
                            <div style="font-size:24px;font-weight:700;">${formatTime(currentSession)}</div>
                        </div>
                        <div style="text-align:center;flex:1;">
                            <div style="font-size:14px;color:#666;margin-bottom:5px;">Total Time</div>
                            <div style="font-size:24px;font-weight:700;">${formatTime(totalTime)}</div>
                        </div>
                    </div>
                </div>
            `;
            document.getElementById('modal-root').appendChild(modal);
        }

        // Update game statistics after each game
        function updateGameStats(game, won, betAmount, wonAmount) {
            if (!gameStats[game]) return;
            gameStats[game].played++;
            if (won) gameStats[game].won++;
            else gameStats[game].lost++;
            gameStats[game].totalBet += betAmount;
            gameStats[game].totalWon += wonAmount;
            
            // Save to localStorage
            localStorage.setItem('gameStats', JSON.stringify(gameStats));
        }

        // Load statistics from localStorage on page load
        document.addEventListener('DOMContentLoaded', () => {
            const savedStats = localStorage.getItem('gameStats');
            if (savedStats) {
                gameStats = JSON.parse(savedStats);
            }
            
            const savedTime = localStorage.getItem('totalTimeOnSite');
            if (savedTime) {
                totalTimeOnSite = parseInt(savedTime);
            }
            
            // Update total time every minute
            setInterval(() => {
                totalTimeOnSite += 60000; // Add one minute
                localStorage.setItem('totalTimeOnSite', totalTimeOnSite.toString());
            }, 60000);
        });
    </script>
<!-- AI Assistant Button -->
<div id="ai-assistant-button" style="position: fixed; bottom: 20px; right: 20px; z-index: 9999;">
  <button onclick="toggleAIAssistant()" style="
    width: 60px; height: 60px; border-radius: 50%;
    background-color: #3b82f6; color: white;
    font-size: 28px; border: none;
    box-shadow: 0 4px 12px rgba(0,0,0,0.3);"></button>
</div>

<!-- AI Assistant Panel -->
<div id="ai-assistant-panel" style="
  display: none; position: fixed; bottom: 90px; right: 20px;
  width: 300px; height: 400px; background: white;
  border-radius: 16px; box-shadow: 0 6px 20px rgba(0,0,0,0.25);
  z-index: 9998; overflow: hidden;
  display: flex; flex-direction: column; justify-content: space-between;">
  
  <div style="padding: 16px; font-weight: bold; background: #3b82f6; color: white;">
    AI Assistant
    <span style="float: right; cursor: pointer;" onclick="toggleAIAssistant()"></span>
  </div>

  <div id="ai-assistant-chat" style="flex: 1; padding: 12px; overflow-y: auto; font-size: 14px;">
    <div><strong>AI:</strong> How can I help you with your bets today?</div>
  </div>

  <div style="padding: 10px; display: flex; gap: 8px;">
    <input type="text" id="ai-user-input" placeholder="Ask something..." style="
      flex: 1; padding: 8px; border-radius: 8px;
      border: 1px solid #ccc; font-size: 14px;">
    <button onclick="sendToAI()" style="
      padding: 8px 14px; background: #3b82f6; color: white;
      border: none; border-radius: 8px; cursor: pointer;">Send</button>
  </div>
</div>
<script>
function toggleAIAssistant() {
  const panel = document.getElementById('ai-assistant-panel');
  panel.style.display = panel.style.display === 'none' ? 'flex' : 'none';
}

async function sendToAI() {
  const input = document.getElementById('ai-user-input');
  const chat = document.getElementById('ai-assistant-chat');
  const userMsg = input.value.trim();
  if (!userMsg) return;

  // Show user's message
  const userDiv = document.createElement('div');
  userDiv.innerHTML = `<strong>You:</strong> ${userMsg}`;
  chat.appendChild(userDiv);

  input.value = '';
  chat.scrollTop = chat.scrollHeight;

  try {
    const res = await fetch('/api/chat', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ message: userMsg })
    });
    const data = await res.json();

    const aiDiv = document.createElement('div');
    aiDiv.innerHTML = `<strong>AI:</strong> ${data.reply || 'Hmm, no response.'}`;
    chat.appendChild(aiDiv);
    chat.scrollTop = chat.scrollHeight;
  } catch (err) {
    const errorDiv = document.createElement('div');
    errorDiv.innerHTML = `<strong>AI:</strong> Sorry, I couldnt connect.`;
    chat.appendChild(errorDiv);
    chat.scrollTop = chat.scrollHeight;
  }
}
</script>
</body>
</html> 
